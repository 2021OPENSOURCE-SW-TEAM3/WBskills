import{c as t,a as e}from"../common/_commonjsHelpers-6a48b99e.js";import{r as n}from"../common/index.esm-afa3cd26.js";var r=t((function(t,r){!function(t){try{(function(){t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var i,o,s,a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n=n||Promise)((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function l(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=d[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,f(["["+i+"]  "+t.name+":"],n))}}(s=o=o||{})[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT",o.DEBUG,o.VERBOSE,o.INFO,o.WARN,o.ERROR,o.SILENT;var p=o.INFO,d=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),v=(Object.defineProperty(y.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),y.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,f([this,o.DEBUG],t)),this._logHandler.apply(this,f([this,o.DEBUG],t))},y.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,f([this,o.VERBOSE],t)),this._logHandler.apply(this,f([this,o.VERBOSE],t))},y.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,f([this,o.INFO],t)),this._logHandler.apply(this,f([this,o.INFO],t))},y.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,f([this,o.WARN],t)),this._logHandler.apply(this,f([this,o.WARN],t))},y.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,f([this,o.ERROR],t)),this._logHandler.apply(this,f([this,o.ERROR],t))},y);function y(t){this.name=t,this._logLevel=p,this._logHandler=l,this._userLogHandler=null}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,w=(r(b,g=Error),b);function b(t,e){var n=g.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,E.prototype.create),n}var E=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,e){return t.replace(T,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new w(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,N=(A.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},A.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},A.prototype.setServiceProps=function(t){return this.serviceProps=t,this},A);function A(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var S,k="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},D=D||{},R=k;function C(t){return"string"==typeof t}function O(t){return"number"==typeof t}function x(t,e){t=t.split("."),e=e||R;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function L(){}function P(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function _(t){return"array"==P(t)}function U(t){var e=P(t);return"array"==e||"object"==e&&"number"==typeof t.length}function q(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var M="closure_uid_"+(1e9*Math.random()>>>0),V=0;function F(t,e,n){return t.call.apply(t.bind,arguments)}function j(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function G(t,e,n){return(G=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:j).apply(null,arguments)}function B(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var z=Date.now||function(){return+new Date};function H(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function K(){this.j=this.j,this.i=this.i}K.prototype.j=!1,K.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[M]||(this[M]=++V))},K.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var W=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(C(t))return C(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},J=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=C(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Y(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function X(t){return/^[\s\xa0]*$/.test(t)}var $,Z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function tt(t,e){return-1!=t.indexOf(e)}function et(t,e){return t<e?-1:e<t?1:0}t:{var nt=R.navigator;if(nt){var rt=nt.userAgent;if(rt){$=rt;break t}}$=""}function it(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ot(t){var e,n={};for(e in t)n[e]=t[e];return n}var st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<st.length;o++)n=st[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ut(t){return ut[" "](t),t}ut[" "]=L;var ht,ct,ft=tt($,"Opera"),lt=tt($,"Trident")||tt($,"MSIE"),pt=tt($,"Edge"),dt=pt||lt,vt=tt($,"Gecko")&&!(tt($.toLowerCase(),"webkit")&&!tt($,"Edge"))&&!(tt($,"Trident")||tt($,"MSIE"))&&!tt($,"Edge"),yt=tt($.toLowerCase(),"webkit")&&!tt($,"Edge");function mt(){var t=R.document;return t?t.documentMode:void 0}t:{var gt="",wt=(ct=$,vt?/rv:([^\);]+)(\)|;)/.exec(ct):pt?/Edge\/([\d\.]+)/.exec(ct):lt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ct):yt?/WebKit\/(\S+)/.exec(ct):ft?/(?:Version)[ \/]?(\S+)/.exec(ct):void 0);if(wt&&(gt=wt?wt[1]:""),lt){var bt=mt();if(null!=bt&&bt>parseFloat(gt)){ht=String(bt);break t}}ht=gt}var Et,It={};function Tt(t){return function(e,n){var r=It;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=Z(String(ht)).split("."),r=Z(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=et(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||et(0==s[2].length,0==a[2].length)||et(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}()}(t)}var Nt=R.document;Et=Nt&&lt?mt()||("CSS1Compat"==Nt.compatMode?parseInt(ht,10):5):void 0;var At=!lt||9<=Number(Et),St=lt&&!Tt("9"),kt=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{R.addEventListener("test",L,e),R.removeEventListener("test",L,e)}catch(t){}return t}();function Dt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function Rt(t,e){if(Dt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(vt){t:{try{ut(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=C(t.pointerType)?t.pointerType:Ct[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Dt.prototype.b=function(){this.Ia=!1},H(Rt,Dt);var Ct={2:"touch",3:"pen",4:"mouse"};Rt.prototype.b=function(){Rt.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,St)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Ot="closure_listenable_"+(1e6*Math.random()|0),xt=0;function Lt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++xt,this.X=this.Z=!1}function Pt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function _t(t){this.src=t,this.a={},this.b=0}function Ut(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=W(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Pt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function qt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=qt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Lt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Mt="closure_lm_"+(1e6*Math.random()|0),Vt={};function Ft(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(_(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Jt(r),e&&e[Ot]?e.Aa(n,r,q(i)?!!i.capture:!!i,o):jt(e,n,r,!0,i,o)}(t,e,n,r,i);if(_(e)){for(var o=0;o<e.length;o++)Ft(t,e[o],n,r,i);return null}return n=Jt(n),t&&t[Ot]?t.za(e,n,q(r)?!!r.capture:!!r,i):jt(t,e,n,!1,r,i)}function jt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=q(i)?!!i.capture:!!i;if(s&&!At)return null;var a=Kt(t);if(a||(t[Mt]=a=new _t(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ht,e=At?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)kt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Bt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Gt(t){if(!O(t)&&t&&!t.X){var e=t.src;if(e&&e[Ot])Ut(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Bt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Kt(e))?(Ut(n,t),0==n.b&&(n.src=null,e[Mt]=null)):Pt(t)}}}function Bt(t){return t in Vt?Vt[t]:Vt[t]="on"+t}function zt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Gt(t),n.call(r,e)}function Ht(t,e){return!!t.X||zt(t,At?new Rt(e,this):e=new Rt(e||x("window.event"),this))}function Kt(t){return(t=t[Mt])instanceof _t?t:null}var Wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jt(t){return"function"==P(t)?t:(t[Wt]||(t[Wt]=function(e){return t.handleEvent(e)}),t[Wt])}function Yt(){K.call(this),this.c=new _t(this),(this.J=this).B=null}function Qt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ut(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}H(Yt,K),Yt.prototype[Ot]=!0,(S=Yt.prototype).addEventListener=function(t,e,n,r){Ft(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(_(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=q(i)?!!i.capture:!!i,r=Jt(r),e&&e[Ot]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=qt(s=e.a[n],r,i,o))&&(Pt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Kt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=qt(n,r,i,o)),(r=-1<e?n[e]:null)&&Gt(r))}(this,t,e,n,r)},S.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(C(t))t=new Dt(t,n);else if(t instanceof Dt)t.target=t.target||n;else{var i=t;at(t=new Dt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Qt(s,r,!0,t)&&i}if(i=Qt(s=t.a=n,r,!0,t)&&i,i=Qt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Qt(s=t.a=e[o],r,!1,t)&&i;return i},S.G=function(){if(Yt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Pt(n[r]);delete e.a[t],e.b--}}this.B=null},S.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Xt=R.JSON.stringify;function $t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Zt(){this.b=this.a=null}$t.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var te,ee=new $t((function(){return new ne}),(function(t){t.reset()}));function ne(){this.next=this.b=this.a=null}function re(t){R.setTimeout((function(){throw t}),0)}function ie(t,e){te||function(){var t=R.Promise.resolve(void 0);te=function(){t.then(ae)}}(),oe||(te(),oe=!0),se.add(t,e)}Zt.prototype.add=function(t,e){var n=ee.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ne.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var oe=!(ne.prototype.reset=function(){this.next=this.b=this.a=null}),se=new Zt;function ae(){for(var t;r=n=void 0,r=null,(n=se).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){re(t)}var e=ee;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;oe=!1}function ue(t,e){Yt.call(this),this.b=t||1,this.a=e||R,this.f=G(this.gb,this),this.g=z()}function he(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ce(t,e,n){if("function"==P(t))n&&(t=G(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=G(t.handleEvent,t)}return 2147483647<Number(e)?-1:R.setTimeout(t,e||0)}function fe(t,e,n){K.call(this),this.f=null!=n?G(t,n):t,this.c=e,this.b=G(this.$a,this),this.a=[]}function le(t){t.U=ce(t.b,t.c),t.f.apply(null,t.a)}function pe(t){K.call(this),this.b=t,this.a={}}H(ue,Yt),(S=ue.prototype).ba=!1,S.L=null,S.gb=function(){if(this.ba){var t=z()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(he(this),this.start()))}},S.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=z())},S.G=function(){ue.N.G.call(this),he(this),delete this.a},H(fe,K),(S=fe.prototype).ea=!1,S.U=null,S.Ta=function(t){this.a=arguments,this.U?this.ea=!0:le(this)},S.G=function(){fe.N.G.call(this),this.U&&(R.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},S.$a=function(){this.U=null,this.ea&&(this.ea=!1,le(this))},H(pe,K);var de=[];function ve(t,e,n,r){_(n)||(n&&(de[0]=n.toString()),n=de);for(var i=0;i<n.length;i++){var o=Ft(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ye(t){it(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Gt(t)}),t),t.a={}}function me(){}pe.prototype.G=function(){pe.N.G.call(this),ye(this)},pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ge=new Yt;function we(t){Dt.call(this,"serverreachability",t)}function be(t){ge.dispatchEvent(new we(ge,t))}function Ee(t){Dt.call(this,"statevent",t)}function Ie(t){ge.dispatchEvent(new Ee(ge,t))}function Te(t){Dt.call(this,"timingevent",t)}function Ne(t,e){if("function"!=P(t))throw Error("Fn must not be null and must be a function");return R.setTimeout((function(){t()}),e)}H(we,Dt),H(Ee,Dt),H(Te,Dt);var Ae={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Se={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ke(){}function De(t){var e;return(e=t.a)||(e=t.a={}),e}function Re(){}ke.prototype.a=null;var Ce,Oe={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function xe(){Dt.call(this,"d")}function Le(){Dt.call(this,"c")}function Pe(){}function _e(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new pe(this),this.O=Ue,t=dt?125:void 0,this.P=new ue(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}H(xe,Dt),H(Le,Dt),H(Pe,ke),Ce=new Pe;var Ue=45e3,qe={},Me={};function Ve(t,e,n){t.F=1,t.f=fn(rn(e)),t.l=n,t.H=!0,je(t,null)}function Fe(t,e,n,r){t.F=1,t.f=fn(rn(e)),t.l=null,t.H=n,je(t,r)}function je(t,e){t.v=z(),ze(t),t.D=rn(t.f),cn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new fe(G(t.Ja,t,t.a),t.J)),ve(t.I,t.a,"readystatechange",t.cb),e=t.h?ot(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),be(1)}function Ge(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Be(t,n);if(i==Me){4==e&&(t.c=4,Ie(14),r=!1);break}if(i==qe){t.c=4,Ie(15),r=!1;break}Ye(t,i)}4==e&&0==n.length&&(t.c=1,Ie(16),r=!1),t.b=t.b&&r,r||(Je(t),We(t))}function Be(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Me:(n=Number(e.substring(n,r)),isNaN(n)?qe:(r+=1)+n>e.length?Me:(e=e.substr(r,n),t.A=r+n,e))}function ze(t){t.R=z()+t.O,He(t,t.O)}function He(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Ne(G(t.ab,t),e)}function Ke(t){t.i&&(R.clearTimeout(t.i),t.i=null)}function We(t){t.g.Ca()||t.m||t.g.na(t)}function Je(t){Ke(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,he(t.P),ye(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ye(t,e){try{t.g.Fa(t,e),be(4)}catch(t){}}function Qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(U(t)||C(t))J(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(U(t)||C(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(C(t))return t.split("");if(U(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function $e(t,e){tn(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ze(t))}function Ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];tn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)tn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function tn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=_e.prototype).setTimeout=function(t){this.O=t},S.cb=function(t){t=t.target;var e=this.B;e&&3==rr(t)?e.Ta():this.Ja(t)},S.Ja=function(t){try{if(t==this.a)t:{var e=rr(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!dt&&!this.a.aa())){this.m||4!=e||7==n||be(8==n||r<=0?3:2),Ke(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=ir(this.a,"X-HTTP-Initial-Response");if(s&&!X(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,Ie(12),Je(this),We(this);break t}this.s=!0,Ye(this,a)}this.H?(Ge(this,e,o),dt&&this.b&&3==e&&(ve(this.I,this.P,"tick",this.bb),this.P.start())):Ye(this,o),4==e&&Je(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Ie(12)):(this.c=0,Ie(13)),Je(this),We(this)}}}catch(t){}},S.bb=function(){if(this.a){var t=rr(this.a),e=this.a.aa();this.A<e.length&&(Ke(this),Ge(this,t,e),this.b&&4!=t&&ze(this))}},S.cancel=function(){this.m=!0,Je(this)},S.ab=function(){this.i=null;var t=z();0<=t-this.R?(2!=this.F&&(be(3),Ie(17)),Je(this),this.c=2,We(this)):He(this,this.R-t)},(S=Xe.prototype).C=function(){Ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.K=function(){return Ze(this),this.a.concat()},S.get=function(t,e){return tn(this.b,t)?this.b[t]:e},S.set=function(t,e){tn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var en=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function nn(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof nn?(this.h=void 0!==e?e:t.h,on(this,t.f),this.j=t.j,sn(this,t.b),an(this,t.i),this.a=t.a,un(this,An(t.c)),this.g=t.g):t&&(n=String(t).match(en))?(this.h=!!e,on(this,n[1]||"",!0),this.j=ln(n[2]||""),sn(this,n[3]||"",!0),an(this,n[4]),this.a=ln(n[5]||"",!0),un(this,n[6]||"",!0),this.g=ln(n[7]||"")):(this.h=!!e,this.c=new bn(null,this.h))}function rn(t){return new nn(t)}function on(t,e,n){t.f=n?ln(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function sn(t,e,n){t.b=n?ln(e,!0):e}function an(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function un(t,e,n){e instanceof bn?(t.c=e,function(t,e){e&&!t.f&&(En(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(In(this,e),Nn(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=pn(e,gn)),t.c=new bn(e,t.h))}function hn(t,e,n){t.c.set(e,n)}function cn(t,e,n){_(n)||(n=[String(n)]),Nn(t.c,e,n)}function fn(t){return hn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^z()).toString(36)),t}function ln(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function pn(t,e,n){return C(t)?(t=encodeURI(t).replace(e,dn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function dn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}nn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(pn(e,vn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(pn(e,vn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(pn(n,"/"==n.charAt(0)?mn:yn,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",pn(n,wn)),t.join("")},nn.prototype.resolve=function(t){var e=rn(this),n=!!t.f;n?on(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?sn(e,t.b):n=null!=t.i;var r=t.a;if(n)an(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(tt(i,"./")||tt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?un(e,An(t.c)):n=!!t.g,n&&(e.g=t.g),e};var vn=/[#\/\?@]/g,yn=/[#\?:]/g,mn=/[#\?]/g,gn=/[#\?@]/g,wn=/#/g;function bn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function En(t){t.a||(t.a=new Xe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function In(t,e){En(t),e=Sn(t,e),tn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e(t.a,e))}function Tn(t,e){return En(t),e=Sn(t,e),tn(t.a.b,e)}function Nn(t,e,n){In(t,e),0<n.length&&(t.c=null,t.a.set(Sn(t,e),Q(n)),t.b+=n.length)}function An(t){var e=new bn;return e.c=t.c,t.a&&(e.a=new Xe(t.a),e.b=t.b),e}function Sn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function kn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Dn(t){var e=t.a.F.a;if(null!=e)Ie(4),e?(Ie(10),yr(t.a,t,!1)):(Ie(11),yr(t.a,t,!0));else{t.b=new _e(t,void 0,void 0),t.b.h=t.h,e=Er(e=t.a,e.Y()?t.f:null,t.i),Ie(4),cn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&hn(e,n,r),Fe(t.b,e,!1,t.f)}}function Rn(){this.a=this.b=null}function Cn(){this.a=new Xe}function On(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[M]||(t[M]=++V)):e.charAt(0)+t}function xn(t,e){this.b=t,this.a=e}function Ln(t){this.g=t||Pn,t=R.PerformanceNavigationTiming?0<(t=R.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(R.ka&&R.ka.Da&&R.ka.Da()&&R.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Cn),this.b=null,this.c=[]}(S=bn.prototype).add=function(t,e){En(this),this.c=null,t=Sn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(t,e){En(this),this.a.forEach((function(n,r){J(n,(function(n){t.call(e,n,r,this)}),this)}),this)},S.K=function(){En(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.C=function(t){En(this);var e=[];if(C(t))Tn(this,t)&&(e=Y(e,this.a.get(Sn(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Y(e,t[n])}return e},S.set=function(t,e){return En(this),this.c=null,Tn(this,t=Sn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},H((function(){}),(function(){})),(S=kn.prototype).M=null,S.$=function(t){return this.a.$(t)},S.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},S.Ca=function(){return!1},S.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=ir(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=ir(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void wr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,wr(e,2)}else 1==this.M&&(this.g?Ie(6):"11111"==e?(Ie(5),this.g=!0,(!lt||10<=Number(Et))&&(this.c=200,this.b.cancel(),Ie(11),yr(this.a,this,!0))):(Ie(7),this.g=!1))},S.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Dn(this)):1==this.M&&(this.g?(Ie(11),yr(this.a,this,!0)):(Ie(10),yr(this.a,this,!1)));else{0==this.M?Ie(8):1==this.M&&Ie(9);var t=this.a;t.m=this.c,wr(t,2)}},S.Y=function(){return this.a.Y()},S.ma=function(){return this.a.ma()},Cn.prototype.add=function(t){this.a.set(On(t),t)},Cn.prototype.C=function(){return this.a.C()};var Pn=10;function _n(t,e){!t.a&&(tt(e,"spdy")||tt(e,"quic")||tt(e,"h2"))&&(t.f=t.g,t.a=new Cn,t.b&&(Vn(t,t.b),t.b=null))}function Un(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function qn(t){return t.b?1:t.a?t.a.a.c:0}function Mn(t,e){return t.b?t.b==e:!!t.a&&(e=On(e),tn(t.a.a.b,e))}function Vn(t,e){t.a?t.a.add(e):t.b=e}function Fn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=On(e),n=tn(t.a.a.b,n)),n&&$e(t.a.a,On(e)))}function jn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Q(t.c);var e=t.c;return J(t.a.C(),(function(t){e=e.concat(t.j)})),e}function Gn(){}function Bn(){this.a=new Gn}function zn(t,e,n){var r=n||"";try{Qe(t,(function(t,n){var i=t;q(t)&&(i=Xt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Hn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Ln.prototype.cancel=function(){this.c=jn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(J(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Gn.prototype.stringify=function(t){return R.JSON.stringify(t,void 0)},Gn.prototype.parse=function(t){return R.JSON.parse(t,void 0)};var Kn=R.JSON.parse;function Wn(t){Yt.call(this),this.headers=new Xe,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Jn,this.D=this.F=!1}H(Wn,Yt);var Jn="",Yn=/^https?$/i,Qn=["POST","PUT"];function Xn(t){return"content-type"==t.toLowerCase()}function $n(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Zn(t),er(t)}function Zn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function tr(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=rr(t)||2!=t.T()))if(t.l&&4==rr(t))ce(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==rr(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(en)[1]||null;if(!o&&R.self&&R.self.location){var s=R.self.location.protocol;o=s.substr(0,s.length-1)}i=!Yn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<rr(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Zn(t)}}finally{er(t)}}}function er(t,e){if(t.a){nr(t);var n=t.a,r=t.s[0]?L:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function nr(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(R.clearTimeout(t.m),t.m=null)}function rr(t){return t.a?t.a.readyState:0}function ir(t,e){return t.a?t.a.getResponseHeader(e):null}function or(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return it(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),C(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return hn(t,e,n),t}function sr(t){this.f=[],this.F=new Rn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!x("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=x("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=x("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=x("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=x("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Ln(t&&t.concurrentRequestLimit),this.ja=new Bn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function ar(t){if(ur(t),3==t.u){var e=t.P++,n=rn(t.B);hn(n,"SID",t.H),hn(n,"RID",e),hn(n,"TYPE","terminate"),lr(t,n),(e=new _e(t,e,void 0)).F=2,e.f=fn(rn(n)),n=!1,R.navigator&&R.navigator.sendBeacon&&(n=R.navigator.sendBeacon(e.f.toString(),"")),!n&&R.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=z(),ze(e)}br(t)}function ur(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(R.clearTimeout(t.l),t.l=null),mr(t),t.b.cancel(),t.h&&(O(t.h)&&R.clearTimeout(t.h),t.h=null)}function hr(t,e){t.f.push(new xn(t.Qa++,e)),3==t.u&&cr(t)}function cr(t){Un(t.b)||t.h||(t.h=!0,ie(t.Ha,t),t.A=0)}function fr(t,e){var n;n=e?e.W:t.P++;var r=rn(t.B);hn(r,"SID",t.H),hn(r,"RID",n),hn(r,"AID",t.O),lr(t,r),t.g&&t.i&&or(r,t.g,t.i),n=new _e(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=pr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Vn(t.b,n),Ve(n,r,e)}function lr(t,e){t.c&&Qe({},(function(t,n){hn(e,n,t)}))}function pr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?G(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{zn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function dr(t){t.a||t.l||(t.S=1,ie(t.Ga,t),t.v=0)}function vr(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=Ne(G(t.Ga,t),gr(t,t.v)),t.v++,0))}function yr(t,e,n){var r=e.l;r&&_n(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Er(t,null,t.ha),cr(t)}function mr(t){null!=t.s&&(R.clearTimeout(t.s),t.s=null)}function gr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function wr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=G(t.eb,t);n||(n=new nn("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||on(n,"https"),fn(n)),function(t,e){var n=new me;if(R.Image){var r=new Image;r.onload=B(Hn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=B(Hn,n,r,"TestLoadImage: error",!1,e),r.onabort=B(Hn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=B(Hn,n,r,"TestLoadImage: timeout",!1,e),R.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ie(2);t.u=0,t.c&&t.c.ta(e),br(t),ur(t)}function br(t){t.u=0,t.m=-1,t.c&&(0==jn(t.b).length&&0==t.f.length||(t.b.c.length=0,Q(t.f),t.f.length=0),t.c.sa())}function Er(t,e,n){var r=function(t){return t instanceof nn?rn(t):new nn(t,void 0)}(n);if(""!=r.b)e&&sn(r,e+"."+r.b),an(r,r.i);else{var i,o=R.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new nn(null,void 0);return t&&on(i,t),e&&sn(i,e),n&&an(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&it(t.V,(function(t,e){hn(r,e,t)})),e=t.j,n=t.I,e&&n&&hn(r,e,n),hn(r,"VER",t.wa),lr(t,r),r}function Ir(){}function Tr(){if(lt&&!(10<=Number(Et)))throw Error("Environmental error: no available transport.")}function Nr(t,e){Yt.call(this),this.a=new sr(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!X(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!X(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new kr(this)}function Ar(t){xe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Sr(){Le.call(this),this.status=1}function kr(t){this.a=t}(S=Wn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?De(this.H):De(Ce),this.a.onreadystatechange=G(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void $n(this,t)}t=n||"";var i=new Xe(this.headers);r&&Qe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Xn,n=t.length,r=C(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:C(t)?t.charAt(e):t[e]}(i.K()),n=R.FormData&&t instanceof R.FormData,0<=W(Qn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{nr(this),0<this.o&&((this.D=function(t){return lt&&Tt(9)&&O(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=G(this.Ba,this)):this.m=ce(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){$n(this,t)}},S.Ba=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),er(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),er(this,!0)),Wn.N.G.call(this)},S.Ea=function(){this.j||(this.w||this.l||this.g?tr(this):this.Za())},S.Za=function(){tr(this)},S.T=function(){try{return 2<rr(this)?this.a.status:-1}catch(t){return-1}},S.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Kn(e)}},S.ya=function(){return this.h},S.Xa=function(){return C(this.f)?this.f:String(this.f)},(S=sr.prototype).wa=8,S.u=1,S.Ca=function(){return 0==this.u},S.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new _e(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?at(r=ot(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&C(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=pr(this,n,e),hn(i=rn(this.B),"RID",t),hn(i,"CVER",22),this.o&&this.j&&hn(i,"X-HTTP-Session-Id",this.j),lr(this,i),this.g&&r&&or(i,this.g,r),Vn(this.b,n),this.W?(hn(i,"$req",e),hn(i,"SID","null"),n.S=!0,Ve(n,i,null)):Ve(n,i,e),this.u=2}}else 3==this.u&&(t?fr(this,t):0==this.f.length||Un(this.b)||fr(this))},S.Ga=function(){this.l=null,this.a=new _e(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=rn(this.pa);hn(t,"RID","rpc"),hn(t,"SID",this.H),hn(t,"CI",this.ia?"0":"1"),hn(t,"AID",this.O),lr(this,t),hn(t,"TYPE","xmlhttp"),this.g&&this.i&&or(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Fe(this.a,t,!0,this.ga)},S.Fa=function(t,e){if(0!=this.u&&(this.a==t||Mn(this.b,t)))if(this.m=t.o,!t.s&&Mn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(_(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;mr(this),this.a.cancel(),this.a=null}vr(this),Ie(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Ne(G(this.Ya,this),6e3));if(qn(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else wr(this,11)}else if(!t.s&&this.a!=t||mr(this),!X(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&O(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=ir(r,"X-Client-Wire-Protocol"))&&_n(this.b,i),this.j&&(r=ir(r,"X-HTTP-Session-Id")))&&(this.I=r,hn(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Er(this,this.Y()?this.ga:null,this.ha),r.s?(Fn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ke(r),ze(r)),this.a=r):dr(this),0<this.f.length&&cr(this)}else"stop"!=r[0]&&"close"!=r[0]||wr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?wr(this,7):ar(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},S.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,vr(this),Ie(19))},S.na=function(t){var e=null;if(this.a==t){mr(this),this.a=null;var n=2}else{if(!Mn(this.b,t))return;e=t.j,Fn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=z()-t.v,ge.dispatchEvent(new Te(ge,t.l?t.l.length:0,e,this.A)),cr(this)):dr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(qn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)||(t.h=Ne(G(t.Ha,t,e),gr(t,t.A)),t.A++,0)))}(this,t)||2==n&&vr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:wr(this,5);break;case 4:wr(this,10);break;case 3:wr(this,6);break;default:wr(this,2)}}},S.eb=function(t){Ie(t?2:1)},S.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Wn(this.Ka)).F=this.R,t},S.ma=function(){return!!this.c&&!0},S.Y=function(){return this.R},(S=Ir.prototype).va=function(){},S.ua=function(){},S.ta=function(){},S.sa=function(){},S.Sa=function(){},Tr.prototype.a=function(t,e){return new Nr(t,e)},H(Nr,Yt),(S=Nr.prototype).addEventListener=function(t,e,n,r){Nr.N.addEventListener.call(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){Nr.N.removeEventListener.call(this,t,e,n,r)},S.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Ie(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new kn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=or(e,t.g,t.i)),(t=t.w).i=n,e=Er(t.a,null,t.i),Ie(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Dn(t)):(cn(e,"MODE","init"),!t.a.o&&t.a.j&&cn(e,"X-HTTP-Session-Id",t.a.j),t.b=new _e(t,void 0,void 0),t.b.h=t.h,Fe(t.b,e,!1,null),t.M=0)},S.close=function(){ar(this.a)},S.Wa=function(t){if(C(t)){var e={};e.__data__=t,hr(this.a,e)}else this.h?((e={}).__data__=Xt(t),hr(this.a,e)):hr(this.a,t)},S.G=function(){this.a.c=null,delete this.f,ar(this.a),delete this.a,Nr.N.G.call(this)},H(Ar,xe),H(Sr,Le),H(kr,Ir),kr.prototype.va=function(){this.a.dispatchEvent("a")},kr.prototype.ua=function(t){this.a.dispatchEvent(new Ar(t))},kr.prototype.ta=function(t){this.a.dispatchEvent(new Sr(t))},kr.prototype.sa=function(){this.a.dispatchEvent("b")};var Dr=B((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),Tr);function Rr(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}Tr.prototype.createWebChannel=Tr.prototype.a,Nr.prototype.send=Nr.prototype.Wa,Nr.prototype.open=Nr.prototype.Va,Nr.prototype.close=Nr.prototype.close,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Se.COMPLETE="complete",(Re.EventType=Oe).OPEN="a",Oe.CLOSE="b",Oe.ERROR="c",Oe.MESSAGE="d",Yt.prototype.listen=Yt.prototype.za,Wn.prototype.listenOnce=Wn.prototype.Aa,Wn.prototype.getLastError=Wn.prototype.Xa,Wn.prototype.getLastErrorCode=Wn.prototype.ya,Wn.prototype.getStatus=Wn.prototype.T,Wn.prototype.getResponseJson=Wn.prototype.Ua,Wn.prototype.getResponseText=Wn.prototype.aa,Wn.prototype.send=Wn.prototype.ca;var Cr,Or={createWebChannelTransport:Dr,ErrorCode:Ae,EventType:Se,WebChannel:Re,XhrIo:Wn},xr=Or.createWebChannelTransport,Lr=Or.ErrorCode,Pr=Or.EventType,_r=Or.WebChannel,Ur=Or.XhrIo,qr=t.SDK_VERSION,Mr=(Qr.prototype.t=function(){return null!=this.uid},Qr.prototype.i=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Qr.prototype.isEqual=function(t){return t.uid===this.uid},Qr.UNAUTHENTICATED=new Qr(null),Qr.u=new Qr("google-credentials-uid"),Qr.s=new Qr("first-party-uid"),Qr),Vr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fr=(r(Yr,Cr=Error),Yr),jr=(Jr.prototype.getToken=function(){return Promise.resolve(null)},Jr.prototype.l=function(){},Jr.prototype.v=function(t){Au(!this.h,"Can only call setChangeListener() once."),(this.h=t)(Mr.UNAUTHENTICATED)},Jr.prototype.m=function(){Au(null!==this.h,"removeChangeListener() when no listener registered"),this.h=null},Jr),Gr=(Wr.prototype.getToken=function(){var t=this;Au(null!=this.g,"getToken cannot be called after listener removed.");var e=this._,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t._!==e)throw new Fr(Vr.ABORTED,"getToken aborted due to token change.");return n?(Au("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new Rr(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},Wr.prototype.l=function(){this.forceRefresh=!0},Wr.prototype.v=function(t){Au(!this.h,"Can only call setChangeListener() once."),this.h=t,this.p&&t(this.currentUser)},Wr.prototype.m=function(){Au(null!=this.g,"removeChangeListener() called twice"),Au(null!==this.h,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.g),this.g=null,this.h=null},Wr.prototype.I=function(){var t=this.auth&&this.auth.getUid();return Au(null===t||"string"==typeof t,"Received invalid UID: "+t),new Mr(t)},Wr),Br=(Object.defineProperty(Kr.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.D},e=this.T.auth.R([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Kr),zr=(Hr.prototype.getToken=function(){return Promise.resolve(new Br(this.T,this.D))},Hr.prototype.v=function(t){t(Mr.s)},Hr.prototype.m=function(){},Hr.prototype.l=function(){},Hr);function Hr(t,e){this.T=t,this.D=e}function Kr(t,e){this.T=t,this.D=e,this.type="FirstParty",this.user=Mr.s}function Wr(t){var e=this;this.g=null,this.currentUser=Mr.UNAUTHENTICATED,this.p=!1,this._=0,this.h=null,this.forceRefresh=!1,this.g=function(){e._++,e.currentUser=e.I(),e.p=!0,e.h&&e.h(e.currentUser)},this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.g):(this.g(null),t.get().then((function(t){e.auth=t,e.g&&e.auth.addAuthTokenListener(e.g)}),(function(){})))}function Jr(){this.h=null}function Yr(t,e){var n=Cr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Qr(t){this.uid=t}function Xr(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Fr(Vr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function $r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Zr(t,e){return void 0!==t?t:e}function ti(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function ei(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ni(t){for(var e in Au(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ri(t,e){if(0!==e.length)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+bi(e.length,"argument")+".")}function ii(t,e,n){if(e.length!==n)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function oi(t,e,n){if(e.length<n)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function si(t,e,n,r){if(e.length<n||e.length>r)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+bi(e.length,"argument")+".")}function ai(t,e,n,r){li(t,e,wi(n)+" argument",r)}function ui(t,e,n,r){void 0!==r&&ai(t,e,n,r)}function hi(t,e,n,r){li(t,e,n+" option",r)}function ci(t,e,n,r){void 0!==r&&hi(t,e,n,r)}function fi(t,e,n,r,i){void 0!==r&&function(t,e,n,r){for(var o=[],s=0,a=i;s<a.length;s++){var u=a[s];if(u===r)return;o.push(di(u))}var h=di(r);throw new Fr(Vr.INVALID_ARGUMENT,"Invalid value "+h+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r)}function li(t,e,n,r){if(!("object"===e?pi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=di(r);throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function pi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function di(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Nu("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function vi(t,e,n){if(void 0===n)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+wi(e)+" argument, but it was undefined.")}function yi(t,e,n){ei(e,(function(e,r){if(n.indexOf(e)<0)throw new Fr(Vr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function mi(t,e,n,r){var i=di(r);return new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires its "+wi(n)+" argument to be a "+e+", but it was: "+i)}function gi(t,e,n){if(n<=0)throw new Fr(Vr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+wi(e)+" argument to be a positive number, but it was: "+n+".")}function wi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function bi(t,e){return t+" "+e+(1===t?"":"s")}var Ei=(Ii.fromBase64String=function(t){return new Ii(vu.C().atob(t))},Ii.fromUint8Array=function(t){return new Ii(Ti(t))},Ii.prototype.toBase64=function(){return vu.C().btoa(this.A)},Ii.prototype.toUint8Array=function(){return Ni(this.A)},Ii.prototype.P=function(){return 2*this.A.length},Ii.prototype.isEqual=function(t){return this.A===t.A},Ii.k=new Ii(""),Ii);function Ii(t){this.A=t}function Ti(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}function Ni(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function Ai(){if("undefined"==typeof Uint8Array)throw new Fr(Vr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Si(){if(!vu.C().N)throw new Fr(Vr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ki,Di,Ri=(to.fromBase64String=function(t){ii("Blob.fromBase64String",arguments,1),ai("Blob.fromBase64String","string",1,t),Si();try{return new to(vu.C().atob(t))}catch(t){throw new Fr(Vr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},to.fromUint8Array=function(t){if(ii("Blob.fromUint8Array",arguments,1),Ai(),!(t instanceof Uint8Array))throw mi("Blob.fromUint8Array","Uint8Array",1,t);return new to(Ti(t))},to.prototype.toBase64=function(){return ii("Blob.toBase64",arguments,0),Si(),vu.C().btoa(this.A)},to.prototype.toUint8Array=function(){return ii("Blob.toUint8Array",arguments,0),Ai(),Ni(this.A)},to.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},to.prototype.isEqual=function(t){return this.A===t.A},to.prototype.O=function(){return 2*this.A.length},to.prototype.F=function(t){return Du(this.A,t.A)},to),Ci=Xr(Ri,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Oi=(Object.defineProperty(Zi.prototype,"latitude",{get:function(){return this.V},enumerable:!0,configurable:!0}),Object.defineProperty(Zi.prototype,"longitude",{get:function(){return this.U},enumerable:!0,configurable:!0}),Zi.prototype.isEqual=function(t){return this.V===t.V&&this.U===t.U},Zi.prototype.F=function(t){return Du(this.V,t.V)||Du(this.U,t.U)},Zi),xi=($i.now=function(){return $i.fromMillis(Date.now())},$i.fromDate=function(t){return $i.fromMillis(t.getTime())},$i.fromMillis=function(t){var e=Math.floor(t/1e3);return new $i(e,1e6*(t-1e3*e))},$i.prototype.toDate=function(){return new Date(this.toMillis())},$i.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},$i.prototype.F=function(t){return this.seconds===t.seconds?Du(this.nanoseconds,t.nanoseconds):Du(this.seconds,t.seconds)},$i.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},$i.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},$i.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},$i),Li=(Xi.j=function(t){var e=Math.floor(t/1e6);return new Xi(new xi(e,t%1e6*1e3))},Xi.L=function(t){return new Xi(t)},Xi.q=function(){return Xi.MIN},Xi.prototype.B=function(t){return this.timestamp.F(t.timestamp)},Xi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Xi.prototype.M=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Xi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Xi.prototype.G=function(){return this.timestamp},Xi.MIN=new Xi(new xi(0,0)),Xi),Pi=(Object.defineProperty(Qi.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Qi.prototype.isEqual=function(t){return 0===Qi.W(this,t)},Qi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Qi?t.forEach((function(t){e.push(t)})):e.push(t),this.K(e)},Qi.prototype.limit=function(){return this.offset+this.length},Qi.prototype.H=function(t){return t=void 0===t?1:t,Au(this.length>=t,"Can't call popFirst() with less segments"),this.K(this.segments,this.offset+t,this.length-t)},Qi.prototype.J=function(){return Au(!this.Y(),"Can't call popLast() on empty path"),this.K(this.segments,this.offset,this.length-1)},Qi.prototype.X=function(){return Au(!this.Y(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Qi.prototype.$=function(){return this.get(this.length-1)},Qi.prototype.get=function(t){return Au(t<this.length,"Index out of range"),this.segments[this.offset+t]},Qi.prototype.Y=function(){return 0===this.length},Qi.prototype.Z=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Qi.prototype.tt=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Qi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Qi.prototype.nt=function(){return this.segments.slice(this.offset,this.limit())},Qi.W=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Qi),_i=(r(Yi,Di=Pi),Yi.prototype.K=function(t,e,n){return new Yi(t,e,n)},Yi.prototype.it=function(){return this.nt().join("/")},Yi.prototype.toString=function(){return this.it()},Yi.et=function(t){if(0<=t.indexOf("//"))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Yi(t.split("/").filter((function(t){return 0<t.length})))},Yi.rt=new Yi([]),Yi),Ui=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qi=(r(Ji,ki=Pi),Ji.prototype.K=function(t,e,n){return new Ji(t,e,n)},Ji.ut=function(t){return Ui.test(t)},Ji.prototype.it=function(){return this.nt().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Ji.ut(t)||(t="`"+t+"`"),t})).join(".")},Ji.prototype.toString=function(){return this.it()},Ji.prototype.st=function(){return 1===this.length&&"__name__"===this.get(0)},Ji.ot=function(){return new Ji(["__name__"])},Ji.ht=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Fr(Vr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Fr(Vr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Fr(Vr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Ji(e)},Ji.rt=new Ji([]),Ji),Mi=(Wi.prototype.at=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Wi.prototype.isEqual=function(t){return null!==t&&0===_i.W(this.path,t.path)},Wi.prototype.toString=function(){return this.path.toString()},Wi.W=function(t,e){return _i.W(t.path,e.path)},Wi.ct=function(t){return t.length%2==0},Wi.ft=function(t){return new Wi(new _i(t.slice()))},Wi.lt=function(t){return new Wi(_i.et(t))},Wi.EMPTY=new Wi(new _i([])),Wi),Vi=(Ki.prototype.dt=function(t,e){return new Ki(this.W,this.root.dt(t,e,this.W).copy(null,null,ji.vt,null,null))},Ki.prototype.remove=function(t){return new Ki(this.W,this.root.remove(t,this.W).copy(null,null,ji.vt,null,null))},Ki.prototype.get=function(t){for(var e=this.root;!e.Y();){var n=this.W(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ki.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.Y();){var r=this.W(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ki.prototype.Y=function(){return this.root.Y()},Object.defineProperty(Ki.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Ki.prototype.wt=function(){return this.root.wt()},Ki.prototype.gt=function(){return this.root.gt()},Ki.prototype.bt=function(t){return this.root.bt(t)},Ki.prototype.forEach=function(t){this.bt((function(e,n){return t(e,n),!1}))},Ki.prototype.toString=function(){var t=[];return this.bt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},Ki.prototype.pt=function(t){return this.root.pt(t)},Ki.prototype.yt=function(){return new Fi(this.root,null,this.W,!1)},Ki.prototype._t=function(t){return new Fi(this.root,t,this.W,!1)},Ki.prototype.It=function(){return new Fi(this.root,null,this.W,!0)},Ki.prototype.Tt=function(t){return new Fi(this.root,t,this.W,!0)},Ki),Fi=(Hi.prototype.Rt=function(){Au(0<this.Dt.length,"getNext() called on iterator when hasNext() is false.");var t=this.Dt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.Y();)this.Dt.push(t),t=t.right;else for(t=t.right;!t.Y();)this.Dt.push(t),t=t.left;return e},Hi.prototype.St=function(){return 0<this.Dt.length},Hi.prototype.At=function(){if(0===this.Dt.length)return null;var t=this.Dt[this.Dt.length-1];return{key:t.key,value:t.value}},Hi),ji=(zi.prototype.copy=function(t,e,n,r,i){return new zi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},zi.prototype.Y=function(){return!1},zi.prototype.bt=function(t){return this.left.bt(t)||t(this.key,this.value)||this.right.bt(t)},zi.prototype.pt=function(t){return this.right.pt(t)||t(this.key,this.value)||this.left.pt(t)},zi.prototype.min=function(){return this.left.Y()?this:this.left.min()},zi.prototype.wt=function(){return this.min().key},zi.prototype.gt=function(){return this.right.Y()?this.key:this.right.gt()},zi.prototype.dt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.dt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.dt(t,e,n))).Ct()},zi.prototype.Pt=function(){if(this.left.Y())return zi.EMPTY;var t=this;return t.left.kt()||t.left.left.kt()||(t=t.Nt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Ct()},zi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.Y()||r.left.kt()||r.left.left.kt()||(r=r.Nt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.kt()&&(r=r.Ot()),r.right.Y()||r.right.kt()||r.right.left.kt()||(r=r.Ft()),0===e(t,r.key)){if(r.right.Y())return zi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ct()},zi.prototype.kt=function(){return this.color},zi.prototype.Ct=function(){var t=this;return t.right.kt()&&!t.left.kt()&&(t=t.Vt()),t.left.kt()&&t.left.left.kt()&&(t=t.Ot()),t.left.kt()&&t.right.kt()&&(t=t.Ut()),t},zi.prototype.Nt=function(){var t=this.Ut();return t.right.left.kt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Ot())).Vt()).Ut()),t},zi.prototype.Ft=function(){var t=this.Ut();return t.left.left.kt()&&(t=(t=t.Ot()).Ut()),t},zi.prototype.Vt=function(){var t=this.copy(null,null,zi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},zi.prototype.Ot=function(){var t=this.copy(null,null,zi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},zi.prototype.Ut=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},zi.prototype.xt=function(){var t=this.jt();return Math.pow(2,t)<=this.size+1},zi.prototype.jt=function(){if(this.kt()&&this.left.kt())throw Nu("Red node has red child("+this.key+","+this.value+")");if(this.right.kt())throw Nu("Right child of ("+this.key+","+this.value+") is red");var t=this.left.jt();if(t!==this.right.jt())throw Nu("Black depths differ");return t+(this.kt()?0:1)},zi.EMPTY=null,zi.RED=!0,zi.vt=!1,zi),Gi=(Object.defineProperty(Bi.prototype,"key",{get:function(){throw Nu("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Bi.prototype,"value",{get:function(){throw Nu("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Bi.prototype,"color",{get:function(){throw Nu("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Bi.prototype,"left",{get:function(){throw Nu("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Bi.prototype,"right",{get:function(){throw Nu("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Bi.prototype.copy=function(t,e,n,r,i){return this},Bi.prototype.dt=function(t,e,n){return new ji(t,e)},Bi.prototype.remove=function(t,e){return this},Bi.prototype.Y=function(){return!0},Bi.prototype.bt=function(t){return!1},Bi.prototype.pt=function(t){return!1},Bi.prototype.wt=function(){return null},Bi.prototype.gt=function(){return null},Bi.prototype.kt=function(){return!1},Bi.prototype.xt=function(){return!0},Bi.prototype.jt=function(){return 0},Bi);function Bi(){this.size=0}function zi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:zi.RED,this.left=null!=r?r:zi.EMPTY,this.right=null!=i?i:zi.EMPTY,this.size=this.left.size+1+this.right.size}function Hi(t,e,n,r){this.Et=r,this.Dt=[];for(var i=1;!t.Y();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Dt.push(t);break}this.Dt.push(t),t=this.Et?t.right:t.left}}function Ki(t,e){this.W=t,this.root=e||ji.EMPTY}function Wi(t){this.path=t,Au(Wi.ct(t),"Invalid DocumentKey with an odd number of segments: "+t.nt().join("/"))}function Ji(){return null!==ki&&ki.apply(this,arguments)||this}function Yi(){return null!==Di&&Di.apply(this,arguments)||this}function Qi(t,e,n){void 0===e?e=0:e>t.length&&Nu("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Nu("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function Xi(t){this.timestamp=t}function $i(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Fr(Vr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Fr(Vr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fr(Vr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Fr(Vr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Zi(t,e){if(ii("GeoPoint",arguments,2),ai("GeoPoint","number",1,t),ai("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Fr(Vr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Fr(Vr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.V=t,this.U=e}function to(t){Si(),this.A=t}ji.EMPTY=new Gi;var eo=(lo.Lt=function(t){var e=new lo(t.W);return t.forEach((function(t){e=e.add(t)})),e},lo.prototype.has=function(t){return null!==this.data.get(t)},lo.prototype.first=function(){return this.data.wt()},lo.prototype.last=function(){return this.data.gt()},Object.defineProperty(lo.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),lo.prototype.indexOf=function(t){return this.data.indexOf(t)},lo.prototype.forEach=function(t){this.data.bt((function(e,n){return t(e),!1}))},lo.prototype.qt=function(t,e){for(var n=this.data._t(t[0]);n.St();){var r=n.Rt();if(0<=this.W(r.key,t[1]))return;e(r.key)}},lo.prototype.Bt=function(t,e){var n;for(n=void 0!==e?this.data._t(e):this.data.yt();n.St();)if(!t(n.Rt().key))return},lo.prototype.Mt=function(t){var e=this.data._t(t);return e.St()?e.Rt().key:null},lo.prototype.yt=function(){return new no(this.data.yt())},lo.prototype._t=function(t){return new no(this.data._t(t))},lo.prototype.add=function(t){return this.copy(this.data.remove(t).dt(t,!0))},lo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},lo.prototype.Y=function(){return this.data.Y()},lo.prototype.Qt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},lo.prototype.isEqual=function(t){if(!(t instanceof lo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.yt(),n=t.data.yt();e.St();){var r=e.Rt().key,i=n.Rt().key;if(0!==this.W(r,i))return!1}return!0},lo.prototype.nt=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},lo.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},lo.prototype.copy=function(t){var e=new lo(this.W);return e.data=t,e},lo),no=(fo.prototype.Rt=function(){return this.Gt.Rt().key},fo.prototype.St=function(){return this.Gt.St()},fo),ro=(co.prototype.Wt=function(t,e){return new ys(e,t)},co.prototype.zt=function(t,e){return e},co.prototype.Kt=function(t){return null},co.prototype.isEqual=function(t){return t instanceof co},co.instance=new co,co),io=(ho.prototype.Wt=function(t,e){return this.apply(t)},ho.prototype.zt=function(t,e){return this.apply(t)},ho.prototype.apply=function(t){for(var e=po(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Is(e)},ho.prototype.Kt=function(t){return null},ho.prototype.isEqual=function(t){return t instanceof ho&&Ru(t.elements,this.elements)},ho),oo=(uo.prototype.Wt=function(t,e){return this.apply(t)},uo.prototype.zt=function(t,e){return this.apply(t)},uo.prototype.apply=function(t){for(var e=po(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Is(e)},uo.prototype.Kt=function(t){return null},uo.prototype.isEqual=function(t){return t instanceof uo&&Ru(t.elements,this.elements)},uo),so=(ao.prototype.Wt=function(t,e){var n=this.Kt(t);if(n instanceof ls&&this.Ht instanceof ls){var r=n.Jt+this.Ht.Jt;return new ls(r)}return r=n.Jt+this.Ht.Jt,new ps(r)},ao.prototype.zt=function(t,e){return Au(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},ao.prototype.Kt=function(t){return t instanceof qo?t:new ls(0)},ao.prototype.isEqual=function(t){return t instanceof ao&&this.Ht.isEqual(t.Ht)},ao);function ao(t){this.Ht=t}function uo(t){this.elements=t}function ho(t){this.elements=t}function co(){}function fo(t){this.Gt=t}function lo(t){this.W=t,this.data=new Vi(this.W)}function po(t){return t instanceof Is?t.Jt.slice():[]}function vo(t,e){this.version=t,this.transformResults=e}var yo,mo,go,wo,bo,Eo,Io,To,No=(Xo.Yt=function(t){return new Xo(t)},Xo.Xt=function(t){var e=new eo(qi.W);return t.forEach((function(t){return e=e.add(t)})),new Xo(e)},Xo.prototype.$t=function(t){var e=!1;return this.fields.forEach((function(n){n.Z(t)&&(e=!0)})),e},Xo.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Xo),Ao=(Qo.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Qo),So=(Yo.exists=function(t){return new Yo(void 0,t)},Yo.updateTime=function(t){return new Yo(t)},Object.defineProperty(Yo.prototype,"Zt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Yo.prototype.tn=function(t){return void 0!==this.updateTime?t instanceof Ns&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ns:(Au(this.Zt,"Precondition should be empty"),!0)},Yo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,!((null!=e?!n||!e.isEqual(n):e!==n)||this.exists!==t.exists);var e,n},Yo.NONE=new Yo,Yo),ko=(Jo.prototype.nn=function(t){null!=t&&Au(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Jo.in=function(t){return t instanceof Ns?t.version:Li.MIN},Jo),Do=(r(Wo,To=ko),Wo.prototype.zt=function(t,e){this.nn(t),Au(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ns(this.key,n,{hasCommittedMutations:!0},this.value)},Wo.prototype.Wt=function(t,e,n){if(this.nn(t),!this.en.tn(t))return t;var r=ko.in(t);return new Ns(this.key,r,{rn:!0},this.value)},Wo.prototype.un=function(t){return null},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.en.isEqual(t.en)},Wo),Ro=(r(Ko,Io=ko),Ko.prototype.zt=function(t,e){if(this.nn(t),Au(null==e.transformResults,"Transform results received by PatchMutation."),!this.en.tn(t))return new Ss(this.key,e.version);var n=this.on(t);return new Ns(this.key,e.version,{hasCommittedMutations:!0},n)},Ko.prototype.Wt=function(t,e,n){if(this.nn(t),!this.en.tn(t))return t;var r=ko.in(t),i=this.on(t);return new Ns(this.key,r,{rn:!0},i)},Ko.prototype.un=function(t){return null},Ko.prototype.isEqual=function(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.sn.isEqual(t.sn)&&this.en.isEqual(t.en)},Ko.prototype.on=function(t){var e;return e=t instanceof Ns?t.data():bs.EMPTY,this.hn(e)},Ko.prototype.hn=function(t){var e=this,n=t.cn();return this.sn.fields.forEach((function(t){if(!t.Y()){var r=e.data.field(t);null!==r?n.set(t,r):n.delete(t)}})),n.an()},Ko),Co=(r(Ho,Eo=ko),Ho.prototype.zt=function(t,e){if(this.nn(t),Au(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.en.tn(t))return new Ss(this.key,e.version);var n=this.fn(t),r=this.ln(t,e.transformResults),i=e.version,o=this.dn(n.data(),r);return new Ns(this.key,i,{hasCommittedMutations:!0},o)},Ho.prototype.Wt=function(t,e,n){if(this.nn(t),!this.en.tn(t))return t;var r=this.fn(t),i=this.vn(n,t,e),o=this.dn(r.data(),i);return new Ns(this.key,r.version,{rn:!0},o)},Ho.prototype.un=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ns?t.field(i.field):void 0,s=i.transform.Kt(o||null);null!=s&&(e=null==e?bs.wn().set(i.field,s):e.set(i.field,s))}return e?e.an():null},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&Ru(this.fieldTransforms,t.fieldTransforms)&&this.en.isEqual(t.en)},Ho.prototype.fn=function(t){return Au(t instanceof Ns,"Unknown MaybeDocument type "+t),Au(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Ho.prototype.ln=function(t,e){var n=[];Au(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ns&&(s=t.field(i.field)),n.push(o.zt(s,e[r]))}return n},Ho.prototype.vn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Ns&&(u=e.field(s.field)),null===u&&n instanceof Ns&&(u=n.field(s.field)),r.push(a.Wt(u,t))}return r},Ho.prototype.dn=function(t,e){Au(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.cn(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.an()},Ho),Oo=(r(zo,bo=ko),zo.prototype.zt=function(t,e){return this.nn(t),Au(null==e.transformResults,"Transform results received by DeleteMutation."),new As(this.key,e.version,{hasCommittedMutations:!0})},zo.prototype.Wt=function(t,e,n){return this.nn(t),this.en.tn(t)?(t&&Au(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new As(this.key,Li.q())):t},zo.prototype.un=function(t){return null},zo.prototype.isEqual=function(t){return t instanceof zo&&this.key.isEqual(t.key)&&this.en.isEqual(t.en)},zo),xo=(r(Bo,wo=ko),Bo.prototype.zt=function(t,e){Nu("VerifyMutation should only be used in Transactions.")},Bo.prototype.Wt=function(t,e,n){Nu("VerifyMutation should only be used in Transactions.")},Bo.prototype.un=function(t){Nu("VerifyMutation should only be used in Transactions.")},Bo.prototype.isEqual=function(t){return t instanceof Bo&&this.key.isEqual(t.key)&&this.en.isEqual(t.en)},Bo),Lo=(Go.gn=function(t,e){switch(t.serverTimestamps){case"estimate":return new Go(1,e);case"previous":return new Go(2,e);case"none":case void 0:return new Go(0,e);default:return Nu("fromSnapshotOptions() called with invalid options.")}},Go),Po=(jo.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},jo.prototype.bn=function(t){return Au(this.pn!==t.pn,"Default compareTo should not be used for values of same type."),Du(this.pn,t.pn)},jo),_o=(r(Fo,go=Po),Fo.prototype.value=function(t){return null},Fo.prototype.isEqual=function(t){return t instanceof Fo},Fo.prototype.B=function(t){return t instanceof Fo?0:this.bn(t)},Fo.prototype.P=function(){return 4},Fo.yn=new Fo,Fo),Uo=(r(Vo,mo=Po),Vo.prototype.value=function(t){return this.Jt},Vo.prototype.isEqual=function(t){return t instanceof Vo&&this.Jt===t.Jt},Vo.prototype.B=function(t){return t instanceof Vo?Du(this.Jt,t.Jt):this.bn(t)},Vo.prototype.P=function(){return 4},Vo.of=function(t){return t?Vo._n:Vo.In},Vo._n=new Vo(!0),Vo.In=new Vo(!1),Vo),qo=(r(Mo,yo=Po),Mo.prototype.value=function(t){return this.Jt},Mo.prototype.B=function(t){return t instanceof Mo?(e=this.Jt)<(n=t.Jt)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.bn(t);var e,n},Mo.prototype.P=function(){return 8},Mo);function Mo(t){var e=yo.call(this)||this;return e.Jt=t,e.pn=2,e}function Vo(t){var e=mo.call(this)||this;return e.Jt=t,e.pn=1,e}function Fo(){var t=go.call(this)||this;return t.pn=0,t.Jt=null,t}function jo(){}function Go(t,e){this.mn=t,this.timestampsInSnapshots=e}function Bo(t,e){var n=wo.call(this)||this;return n.key=t,n.en=e,n.type=4,n}function zo(t,e){var n=bo.call(this)||this;return n.key=t,n.en=e,n.type=3,n}function Ho(t,e){var n=Eo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=2,n.en=So.exists(!0),n}function Ko(t,e,n,r){var i=Io.call(this)||this;return i.key=t,i.data=e,i.sn=n,i.en=r,i.type=1,i}function Wo(t,e,n){var r=To.call(this)||this;return r.key=t,r.value=e,r.en=n,r.type=0,r}function Jo(){}function Yo(t,e){this.updateTime=t,this.exists=e,Au(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}function Qo(t,e){this.field=t,this.transform=e}function Xo(t){this.fields=t}function $o(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Zo,ts,es,ns,rs,is,os,ss,as,us,hs,cs,fs,ls=(r(js,fs=qo),js.prototype.isEqual=function(t){return t instanceof js&&$o(this.Jt,t.Jt)},js),ps=(r(Fs,cs=qo),Fs.prototype.isEqual=function(t){return t instanceof Fs&&$o(this.Jt,t.Jt)},Fs.Tn=new Fs(NaN),Fs.POSITIVE_INFINITY=new Fs(1/0),Fs.NEGATIVE_INFINITY=new Fs(-1/0),Fs),ds=(r(Vs,hs=Po),Vs.prototype.value=function(t){return this.Jt},Vs.prototype.isEqual=function(t){return t instanceof Vs&&this.Jt===t.Jt},Vs.prototype.B=function(t){return t instanceof Vs?Du(this.Jt,t.Jt):this.bn(t)},Vs.prototype.P=function(){return 2*this.Jt.length},Vs),vs=(r(Ms,us=Po),Ms.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Jt:this.Jt.toDate()},Ms.prototype.isEqual=function(t){return t instanceof Ms&&this.Jt.isEqual(t.Jt)},Ms.prototype.B=function(t){return t instanceof Ms?this.Jt.F(t.Jt):t instanceof ys?-1:this.bn(t)},Ms.prototype.P=function(){return 16},Ms),ys=(r(qs,as=Po),qs.prototype.value=function(t){return t&&1===t.mn?new vs(this.En).value(t):t&&2===t.mn&&this.previousValue?this.previousValue.value(t):null},qs.prototype.isEqual=function(t){return t instanceof qs&&this.En.isEqual(t.En)},qs.prototype.B=function(t){return t instanceof qs?this.En.F(t.En):t instanceof vs?1:this.bn(t)},qs.prototype.toString=function(){return"<ServerTimestamp localTime="+this.En.toString()+">"},qs.prototype.P=function(){return 16+(this.previousValue?this.previousValue.P():0)},qs),ms=(r(Us,ss=Po),Us.prototype.value=function(t){return this.Jt},Us.prototype.isEqual=function(t){return t instanceof Us&&this.Jt.isEqual(t.Jt)},Us.prototype.B=function(t){return t instanceof Us?this.Jt.F(t.Jt):this.bn(t)},Us.prototype.P=function(){return this.Jt.O()},Us),gs=(r(_s,os=Po),_s.prototype.value=function(t){return this.key},_s.prototype.isEqual=function(t){return t instanceof _s&&this.key.isEqual(t.key)&&this.Dn.isEqual(t.Dn)},_s.prototype.B=function(t){if(t instanceof _s){var e=this.Dn.B(t.Dn);return 0!==e?e:Mi.W(this.key,t.key)}return this.bn(t)},_s.prototype.P=function(){return this.Dn.projectId.length+this.Dn.database.length+this.key.toString().length},_s),ws=(r(Ps,is=Po),Ps.prototype.value=function(t){return this.Jt},Ps.prototype.isEqual=function(t){return t instanceof Ps&&this.Jt.isEqual(t.Jt)},Ps.prototype.B=function(t){return t instanceof Ps?this.Jt.F(t.Jt):this.bn(t)},Ps.prototype.P=function(){return 16},Ps),bs=(r(Ls,rs=Po),Ls.wn=function(){return new Es(Ls.EMPTY.Jt)},Ls.prototype.value=function(t){var e={};return this.Jt.bt((function(n,r){e[n]=r.value(t)})),e},Ls.prototype.forEach=function(t){this.Jt.bt(t)},Ls.prototype.isEqual=function(t){if(t instanceof Ls){for(var e=this.Jt.yt(),n=t.Jt.yt();e.St()&&n.St();){var r=e.Rt(),i=n.Rt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.St()&&!n.St()}return!1},Ls.prototype.B=function(t){if(t instanceof Ls){for(var e=this.Jt.yt(),n=t.Jt.yt();e.St()&&n.St();){var r=e.Rt(),i=n.Rt(),o=Du(r.key,i.key)||r.value.B(i.value);if(o)return o}return Du(e.St(),n.St())}return this.bn(t)},Ls.prototype.contains=function(t){return null!==this.field(t)},Ls.prototype.field=function(t){Au(!t.Y(),"Can't get field of empty path");var e=this;return t.forEach((function(t){e=e instanceof Ls?e.Jt.get(t):null})),e},Ls.prototype.sn=function(){var t=new eo(qi.W);return this.Jt.forEach((function(e,n){var r=new qi([e]);if(n instanceof Ls){var i=n.sn().fields;i.Y()?t=t.add(r):i.forEach((function(e){t=t.add(r.child(e))}))}else t=t.add(r)})),No.Yt(t)},Ls.prototype.P=function(){var t=0;return this.Jt.bt((function(e,n){t+=e.length+n.P()})),t},Ls.prototype.toString=function(){return this.Jt.toString()},Ls.prototype.cn=function(){return new Es(this.Jt)},Ls.EMPTY=new Ls(new Vi(Du)),Ls),Es=(xs.prototype.set=function(t,e){Au(!t.Y(),"Cannot set field for empty path on ObjectValue");var n=t.X();if(1===t.length)this.Jt=this.Jt.dt(n,e);else{var r=this.Jt.get(n),i=(r instanceof bs?r:bs.EMPTY).cn().set(t.H(),e).an();this.Jt=this.Jt.dt(n,i)}return this},xs.prototype.delete=function(t){Au(!t.Y(),"Cannot delete field for empty path on ObjectValue");var e=t.X();if(1===t.length)this.Jt=this.Jt.remove(e);else{var n=this.Jt.get(e);if(n instanceof bs){var r=n.cn().delete(t.H()).an();this.Jt=this.Jt.dt(t.X(),r)}}return this},xs.prototype.an=function(){return new bs(this.Jt)},xs),Is=(r(Os,ns=Po),Os.prototype.value=function(t){return this.Jt.map((function(e){return e.value(t)}))},Os.prototype.contains=function(t){for(var e=0,n=this.Jt;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Os.prototype.forEach=function(t){this.Jt.forEach(t)},Os.prototype.isEqual=function(t){if(t instanceof Os){if(this.Jt.length!==t.Jt.length)return!1;for(var e=0;e<this.Jt.length;e++)if(!this.Jt[e].isEqual(t.Jt[e]))return!1;return!0}return!1},Os.prototype.B=function(t){if(t instanceof Os){for(var e=Math.min(this.Jt.length,t.Jt.length),n=0;n<e;n++){var r=this.Jt[n].B(t.Jt[n]);if(r)return r}return Du(this.Jt.length,t.Jt.length)}return this.bn(t)},Os.prototype.P=function(){return this.Jt.reduce((function(t,e){return t+e.P()}),0)},Os.prototype.toString=function(){return"["+this.Jt.map((function(t){return t.toString()})).join(",")+"]"},Os),Ts=(Cs.Rn=function(t,e){return Mi.W(t.key,e.key)},Cs),Ns=(r(Rs,es=Ts),Rs.prototype.field=function(t){if(this.Sn)return this.Sn.field(t);this.An||(this.An=new Map);var e=t.it(),n=this.An.get(e);if(void 0===n){var r=this.Cn(t);n=void 0===r?null:this.converter(r),this.An.set(e,n)}return n},Rs.prototype.data=function(){var t=this;if(!this.Sn){var e=bs.wn();ei(this.proto.fields||{},(function(n,r){e.set(new qi([n]),t.converter(r))})),this.Sn=e.an(),this.An=void 0}return this.Sn},Rs.prototype.value=function(){return this.data().value()},Rs.prototype.isEqual=function(t){return t instanceof Rs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.rn===t.rn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Rs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.rn+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Rs.prototype,"hasPendingWrites",{get:function(){return this.rn||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Rs.prototype.Cn=function(t){Au(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.X()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Rs.Pn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.B(i):Nu("Trying to compare documents on fields that don't exist")},Rs),As=(r(Ds,ts=Ts),Ds.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ds.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ds.prototype.isEqual=function(t){return t instanceof Ds&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ds),Ss=(r(ks,Zo=Ts),ks.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ks.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),ks.prototype.isEqual=function(t){return t instanceof ks&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ks);function ks(){return null!==Zo&&Zo.apply(this,arguments)||this}function Ds(t,e,n){var r=ts.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Rs(t,e,n,r,i,o){var s=es.call(this,t,e)||this;return s.Sn=r,s.proto=i,s.converter=o,Au(void 0!==s.Sn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.rn=!!n.rn,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Cs(t,e){this.key=t,this.version=e}function Os(t){var e=ns.call(this)||this;return e.Jt=t,e.pn=8,e}function xs(t){this.Jt=t}function Ls(t){var e=rs.call(this)||this;return e.Jt=t,e.pn=9,e}function Ps(t){var e=is.call(this)||this;return e.Jt=t,e.pn=7,e}function _s(t,e){var n=os.call(this)||this;return n.Dn=t,n.key=e,n.pn=6,n}function Us(t){var e=ss.call(this)||this;return e.Jt=t,e.pn=5,e}function qs(t,e){var n=as.call(this)||this;return n.En=t,n.previousValue=e,n.pn=3,n}function Ms(t){var e=us.call(this)||this;return e.Jt=t,e.pn=3,e}function Vs(t){var e=hs.call(this)||this;return e.Jt=t,e.pn=4,e}function Fs(){return null!==cs&&cs.apply(this,arguments)||this}function js(){return null!==fs&&fs.apply(this,arguments)||this}function Gs(t){return null==t}function Bs(t){return-0===t&&1/t==-1/0}function zs(t){return"number"==typeof t&&Number.isInteger(t)&&!Bs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Hs,Ks,Ws,Js,Ys,Qs,Xs,$s,Zs=(Da.prototype.canonicalId=function(){if(null===this.kn){var t=this.path.it();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Gs(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.kn=t}return this.kn},Da.prototype.toString=function(){var t=this.path.it();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Gs(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Da.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Da.prototype.Nn=function(){return Mi.ct(this.path)&&null===this.collectionGroup&&0===this.filters.length},Da),ta=(ka.jn=function(t){return new ka(t)},Object.defineProperty(ka.prototype,"orderBy",{get:function(){if(null===this.Vn){var t=this.Ln(),e=this.qn();if(null!==t&&null===e)t.st()?this.Vn=[fa]:this.Vn=[new ca(t),fa];else{Au(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Vn=[]),r=0,i=this.On;r<i.length;r++){var o=i[r];this.Vn.push(o),o.field.st()&&(n=!0)}if(!n){var s=0<this.On.length?this.On[this.On.length-1].dir:ua.ASCENDING;this.Vn.push(s===ua.ASCENDING?fa:la)}}}return this.Vn},enumerable:!0,configurable:!0}),ka.prototype.Bn=function(t){Au(null==this.Ln()||!(t instanceof na)||!t.Mn()||t.field.isEqual(this.Ln()),"Query must only have one inequality field."),Au(!this.Nn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new ka(this.path,this.collectionGroup,this.On.slice(),e,this.limit,this.Fn,this.startAt,this.endAt)},ka.prototype.Qn=function(t){Au(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.On.concat([t]);return new ka(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Fn,this.startAt,this.endAt)},ka.prototype.Gn=function(t){return new ka(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},ka.prototype.Wn=function(t){return new ka(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},ka.prototype.zn=function(t){return new ka(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),this.limit,this.Fn,t,this.endAt)},ka.prototype.Kn=function(t){return new ka(this.path,this.collectionGroup,this.On.slice(),this.filters.slice(),this.limit,this.Fn,this.startAt,t)},ka.prototype.Hn=function(t){return new ka(t,null,this.On.slice(),this.filters.slice(),this.limit,this.Fn,this.startAt,this.endAt)},ka.prototype.Jn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.On.length||1===this.On.length&&this.On[0].field.st())},ka.prototype.canonicalId=function(){return this.Yn().canonicalId()+"|lt:"+this.Fn},ka.prototype.toString=function(){return"Query(target="+this.Yn().toString()+"; limitType="+this.Fn+")"},ka.prototype.isEqual=function(t){return this.Yn().isEqual(t.Yn())&&this.Fn===t.Fn},ka.prototype.Xn=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.st()}return Au(n,"orderBy used that doesn't compare on key field"),0},ka.prototype.matches=function(t){return this.$n(t)&&this.Zn(t)&&this.ti(t)&&this.ni(t)},ka.prototype.ii=function(){return!Gs(this.limit)&&"F"===this.Fn},ka.prototype.ei=function(){return!Gs(this.limit)&&"L"===this.Fn},ka.prototype.qn=function(){return 0<this.On.length?this.On[0].field:null},ka.prototype.Ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof na&&n.Mn())return n.field}return null},ka.prototype.ri=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof na&&0<=t.indexOf(r.op))return r.op}return null},ka.prototype.Nn=function(){return this.Yn().Nn()},ka.prototype.ui=function(){return null!==this.collectionGroup},ka.prototype.Yn=function(){if(!this.Un)if("F"===this.Fn)this.Un=new Zs(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===ua.DESCENDING?ua.ASCENDING:ua.DESCENDING;t.push(new ca(r.field,i))}var o=this.endAt?new ha(this.endAt.position,!this.endAt.before):null,s=this.startAt?new ha(this.startAt.position,!this.startAt.before):null;this.Un=new Zs(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Un},ka.prototype.$n=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.at(this.collectionGroup)&&this.path.Z(e):Mi.ct(this.path)?this.path.isEqual(e):this.path.tt(e)},ka.prototype.Zn=function(t){for(var e=0,n=this.On;e<n.length;e++){var r=n[e];if(!r.field.st()&&null===t.field(r.field))return!1}return!0},ka.prototype.ti=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},ka.prototype.ni=function(t){return!(this.startAt&&!this.startAt.si(this.orderBy,t)||this.endAt&&this.endAt.si(this.orderBy,t))},ka.prototype.xn=function(t){Au(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},ka),ea=(Sa.et=function(t){switch(t){case"<":return Sa.LESS_THAN;case"<=":return Sa.LESS_THAN_OR_EQUAL;case"==":return Sa.EQUAL;case">=":return Sa.GREATER_THAN_OR_EQUAL;case">":return Sa.GREATER_THAN;case"array-contains":return Sa.ARRAY_CONTAINS;case"in":return Sa.IN;case"array-contains-any":return Sa.ARRAY_CONTAINS_ANY;default:return Nu("Unknown FieldFilter operator: "+t)}},Sa.prototype.toString=function(){return this.name},Sa.prototype.isEqual=function(t){return this.name===t.name},Sa.LESS_THAN=new Sa("<"),Sa.LESS_THAN_OR_EQUAL=new Sa("<="),Sa.EQUAL=new Sa("=="),Sa.GREATER_THAN=new Sa(">"),Sa.GREATER_THAN_OR_EQUAL=new Sa(">="),Sa.ARRAY_CONTAINS=new Sa("array-contains"),Sa.IN=new Sa("in"),Sa.ARRAY_CONTAINS_ANY=new Sa("array-contains-any"),Sa),na=(r(Aa,$s=function(){}),Aa.create=function(t,e,n){if(t.st())return e===ea.IN?(Au(n instanceof Is,"Comparing on key with IN, but filter value not an ArrayValue"),Au(n.Jt.every((function(t){return t instanceof gs})),"Comparing on key with IN, but an array value was not a RefValue"),new ia(t,n)):(Au(n instanceof gs,"Comparing on key, but filter value not a RefValue"),Au(e!==ea.ARRAY_CONTAINS&&e!==ea.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new ra(t,e,n));if(n.isEqual(_o.yn)){if(e!==ea.EQUAL)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Aa(t,e,n)}if(n.isEqual(ps.Tn)){if(e!==ea.EQUAL)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Aa(t,e,n)}return e===ea.ARRAY_CONTAINS?new oa(t,n):e===ea.IN?(Au(n instanceof Is,"IN filter has invalid value: "+n.toString()),new sa(t,n)):e===ea.ARRAY_CONTAINS_ANY?(Au(n instanceof Is,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new aa(t,n)):new Aa(t,e,n)},Aa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.pn===e.pn&&this.oi(e.B(this.value))},Aa.prototype.oi=function(t){switch(this.op){case ea.LESS_THAN:return t<0;case ea.LESS_THAN_OR_EQUAL:return t<=0;case ea.EQUAL:return 0===t;case ea.GREATER_THAN:return 0<t;case ea.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Nu("Unknown FieldFilter operator: "+this.op)}},Aa.prototype.Mn=function(){return 0<=[ea.LESS_THAN,ea.LESS_THAN_OR_EQUAL,ea.GREATER_THAN,ea.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Aa.prototype.canonicalId=function(){return this.field.it()+this.op.toString()+this.value.toString()},Aa.prototype.isEqual=function(t){return t instanceof Aa&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Aa.prototype.toString=function(){return this.field.it()+" "+this.op+" "+this.value.value()},Aa),ra=(r(Na,Xs=na),Na.prototype.matches=function(t){var e=this.value,n=Mi.W(t.key,e.key);return this.oi(n)},Na),ia=(r(Ta,Qs=na),Ta.prototype.matches=function(t){return this.value.Jt.some((function(e){return t.key.isEqual(e.key)}))},Ta),oa=(r(Ia,Ys=na),Ia.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Is&&e.contains(this.value)},Ia),sa=(r(Ea,Js=na),Ea.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Ea),aa=(r(ba,Ws=na),ba.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Is&&n.Jt.some((function(t){return e.value.contains(t)}))},ba),ua=(wa.prototype.toString=function(){return this.name},wa.ASCENDING=new wa("asc"),wa.DESCENDING=new wa("desc"),wa),ha=(ga.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},ga.prototype.si=function(t,e){Au(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.st())Au(o instanceof gs,"Bound has a non-key value where the key path is being used."),n=Mi.W(o.key,e.key);else{var s=e.field(i.field);Au(null!==s,"Field should exist since document matched the orderBy already."),n=o.B(s)}if(i.dir===ua.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},ga.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},ga),ca=(ma.prototype.compare=function(t,e){var n=this.hi?Ns.Rn(t,e):Ns.Pn(this.field,t,e);switch(this.dir){case ua.ASCENDING:return n;case ua.DESCENDING:return-1*n;default:return Nu("Unknown direction: "+this.dir)}},ma.prototype.canonicalId=function(){return this.field.it()+this.dir.toString()},ma.prototype.toString=function(){return this.field.it()+" ("+this.dir+")"},ma.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},ma),fa=new ca(qi.ot(),ua.ASCENDING),la=new ca(qi.ot(),ua.DESCENDING),pa=(ya.prototype.fi=function(t){return new ya(this.target,this.targetId,this.ci,t,this.ai,this.lastLimboFreeSnapshotVersion,this.resumeToken)},ya.prototype.li=function(t,e){return new ya(this.target,this.targetId,this.ci,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},ya.prototype.di=function(t){return new ya(this.target,this.targetId,this.ci,this.sequenceNumber,this.ai,t,this.resumeToken)},ya.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.ci===t.ci&&this.sequenceNumber===t.sequenceNumber&&this.ai.isEqual(t.ai)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},ya),da=(va.prototype.isEqual=function(t){return t&&t.count===this.count},va);function va(t){this.count=t}function ya(t,e,n,r,i,o,s){void 0===i&&(i=Li.MIN),void 0===o&&(o=Li.MIN),void 0===s&&(s=Ei.k),this.target=t,this.targetId=e,this.ci=n,this.sequenceNumber=r,this.ai=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function ma(t,e){this.field=t,void 0===e&&(e=ua.ASCENDING),this.dir=e,this.hi=t.st()}function ga(t,e){this.position=t,this.before=e}function wa(t){this.name=t}function ba(t,e){var n=Ws.call(this,t,ea.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function Ea(t,e){var n=Js.call(this,t,ea.IN,e)||this;return n.value=e,n}function Ia(t,e){return Ys.call(this,t,ea.ARRAY_CONTAINS,e)||this}function Ta(t,e){var n=Qs.call(this,t,ea.IN,e)||this;return n.value=e,n}function Na(){return null!==Xs&&Xs.apply(this,arguments)||this}function Aa(t,e,n){var r=$s.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Sa(t){this.name=t}function ka(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.On=n,this.filters=r,this.limit=i,this.Fn=o,this.startAt=s,this.endAt=a,this.Vn=null,this.Un=null,this.startAt&&this.xn(this.startAt),this.endAt&&this.xn(this.endAt)}function Da(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.kn=null}function Ra(t){switch(t){case Vr.OK:return Nu("Treated status OK as error");case Vr.CANCELLED:case Vr.UNKNOWN:case Vr.DEADLINE_EXCEEDED:case Vr.RESOURCE_EXHAUSTED:case Vr.INTERNAL:case Vr.UNAVAILABLE:case Vr.UNAUTHENTICATED:return!1;case Vr.INVALID_ARGUMENT:case Vr.NOT_FOUND:case Vr.ALREADY_EXISTS:case Vr.PERMISSION_DENIED:case Vr.FAILED_PRECONDITION:case Vr.ABORTED:case Vr.OUT_OF_RANGE:case Vr.UNIMPLEMENTED:case Vr.DATA_LOSS:return!0;default:return Nu("Unknown status code: "+t)}}function Ca(t){if(void 0===t)return Iu("GRPC error has no .code"),Vr.UNKNOWN;switch(t){case Hs.OK:return Vr.OK;case Hs.CANCELLED:return Vr.CANCELLED;case Hs.UNKNOWN:return Vr.UNKNOWN;case Hs.DEADLINE_EXCEEDED:return Vr.DEADLINE_EXCEEDED;case Hs.RESOURCE_EXHAUSTED:return Vr.RESOURCE_EXHAUSTED;case Hs.INTERNAL:return Vr.INTERNAL;case Hs.UNAVAILABLE:return Vr.UNAVAILABLE;case Hs.UNAUTHENTICATED:return Vr.UNAUTHENTICATED;case Hs.INVALID_ARGUMENT:return Vr.INVALID_ARGUMENT;case Hs.NOT_FOUND:return Vr.NOT_FOUND;case Hs.ALREADY_EXISTS:return Vr.ALREADY_EXISTS;case Hs.PERMISSION_DENIED:return Vr.PERMISSION_DENIED;case Hs.FAILED_PRECONDITION:return Vr.FAILED_PRECONDITION;case Hs.ABORTED:return Vr.ABORTED;case Hs.OUT_OF_RANGE:return Vr.OUT_OF_RANGE;case Hs.UNIMPLEMENTED:return Vr.UNIMPLEMENTED;case Hs.DATA_LOSS:return Vr.DATA_LOSS;default:return Nu("Unknown status code: "+t)}}(Ks=Hs=Hs||{})[Ks.OK=0]="OK",Ks[Ks.CANCELLED=1]="CANCELLED",Ks[Ks.UNKNOWN=2]="UNKNOWN",Ks[Ks.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ks[Ks.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ks[Ks.NOT_FOUND=5]="NOT_FOUND",Ks[Ks.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ks[Ks.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ks[Ks.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ks[Ks.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ks[Ks.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ks[Ks.ABORTED=10]="ABORTED",Ks[Ks.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ks[Ks.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ks[Ks.INTERNAL=13]="INTERNAL",Ks[Ks.UNAVAILABLE=14]="UNAVAILABLE",Ks[Ks.DATA_LOSS=15]="DATA_LOSS";var Oa=new Vi(Mi.W);function xa(){return Oa}function La(){return xa()}var Pa=new Vi(Mi.W);function _a(){return Pa}var Ua=new Vi(Mi.W);function qa(){return Ua}var Ma=new eo(Mi.W);function Va(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ma,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Fa=new eo(Du);function ja(){return Fa}function Ga(t,e,n,r){this.Fi=t,this.removedTargetIds=e,this.key=n,this.Vi=r}function Ba(t,e){this.targetId=t,this.Ui=e}function za(t,e,n,r){void 0===n&&(n=Ei.k),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Ha=(iu.mi=function(t){return new iu(t.W)},iu.prototype.has=function(t){return null!=this.vi.get(t)},iu.prototype.get=function(t){return this.vi.get(t)},iu.prototype.first=function(){return this.wi.wt()},iu.prototype.last=function(){return this.wi.gt()},iu.prototype.Y=function(){return this.wi.Y()},iu.prototype.indexOf=function(t){var e=this.vi.get(t);return e?this.wi.indexOf(e):-1},Object.defineProperty(iu.prototype,"size",{get:function(){return this.wi.size},enumerable:!0,configurable:!0}),iu.prototype.forEach=function(t){this.wi.bt((function(e,n){return t(e),!1}))},iu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.vi.dt(t.key,t),e.wi.dt(t,null))},iu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.vi.remove(t),this.wi.remove(e)):this},iu.prototype.isEqual=function(t){if(!(t instanceof iu))return!1;if(this.size!==t.size)return!1;for(var e=this.wi.yt(),n=t.wi.yt();e.St();){var r=e.Rt().key,i=n.Rt().key;if(!r.isEqual(i))return!1}return!0},iu.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},iu.prototype.copy=function(t,e){var n=new iu;return n.W=this.W,n.vi=t,n.wi=e,n},iu),Ka=(ru.prototype.track=function(t){var e=t.doc.key,n=this.gi.get(e);n?0!==t.type&&3===n.type?this.gi=this.gi.dt(e,t):3===t.type&&1!==n.type?this.gi=this.gi.dt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.gi=this.gi.dt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.gi=this.gi.dt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.gi=this.gi.remove(e):1===t.type&&2===n.type?this.gi=this.gi.dt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.gi=this.gi.dt(e,{type:2,doc:t.doc}):Nu("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.gi=this.gi.dt(e,t)},ru.prototype.bi=function(){var t=[];return this.gi.bt((function(e,n){t.push(n)})),t},ru),Wa=(nu.Ti=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new nu(t,e,Ha.mi(e),i,n,r,!0,!1)},Object.defineProperty(nu.prototype,"hasPendingWrites",{get:function(){return!this.yi.Y()},enumerable:!0,configurable:!0}),nu.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this._i===t._i&&this.yi.isEqual(t.yi)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.pi.isEqual(t.pi)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},nu),Ja=(eu.Ai=function(t,e){var n,r=((n={})[t]=Ya.Ci(t,e),n);return new eu(Li.MIN,r,ja(),xa(),Va())},eu),Ya=(tu.Ci=function(t,e){return new tu(Ei.k,e,Va(),Va(),Va())},tu),Qa=(Object.defineProperty(Za.prototype,"Pi",{get:function(){return this.qi},enumerable:!0,configurable:!0}),Object.defineProperty(Za.prototype,"resumeToken",{get:function(){return this.Li},enumerable:!0,configurable:!0}),Object.defineProperty(Za.prototype,"Mi",{get:function(){return 0!==this.xi},enumerable:!0,configurable:!0}),Object.defineProperty(Za.prototype,"Qi",{get:function(){return this.Bi},enumerable:!0,configurable:!0}),Za.prototype.Gi=function(t){0<t.P()&&(this.Bi=!0,this.Li=t)},Za.prototype.Wi=function(){var t=Va(),e=Va(),n=Va();return this.ji.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Nu("Encountered invalid change type: "+i)}})),new Ya(this.Li,this.qi,t,e,n)},Za.prototype.zi=function(){this.Bi=!1,this.ji=su()},Za.prototype.Ki=function(t,e){this.Bi=!0,this.ji=this.ji.dt(t,e)},Za.prototype.Hi=function(t){this.Bi=!0,this.ji=this.ji.remove(t)},Za.prototype.Ji=function(){this.xi+=1},Za.prototype.Yi=function(){this.xi-=1},Za.prototype.Xi=function(){this.Bi=!0,this.qi=!0},Za),Xa=($a.prototype.ee=function(t){for(var e=0,n=t.Fi;e<n.length;e++){var r=n[e];t.Vi instanceof Ns?this.re(r,t.Vi):t.Vi instanceof As&&this.ue(r,t.key,t.Vi)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.ue(r,t.key,t.Vi)},$a.prototype.se=function(t){var e=this;this.oe(t,(function(n){var r=e.he(n);switch(t.state){case 0:e.ce(n)&&r.Gi(t.resumeToken);break;case 1:r.Yi(),r.Mi||r.zi(),r.Gi(t.resumeToken);break;case 2:r.Yi(),r.Mi||e.removeTarget(n),Au(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:e.ce(n)&&(r.Xi(),r.Gi(t.resumeToken));break;case 4:e.ce(n)&&(e.ae(n),r.Gi(t.resumeToken));break;default:Nu("Unknown target watch change state: "+t.state)}}))},$a.prototype.oe=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):ti(this.Zi,e)},$a.prototype.fe=function(t){var e=t.targetId,n=t.Ui.count,r=this.le(e);if(r){var i=r.target;if(i.Nn())if(0===n){var o=new Mi(i.path);this.ue(e,o,new As(o,Li.q()))}else Au(1===n,"Single document existence filter with count: "+n);else this.de(e)!==n&&(this.ae(e),this.ie=this.ie.add(e))}},$a.prototype.ve=function(t){var e=this,n={};ti(this.Zi,(function(r,i){var o=e.le(r);if(o){if(i.Pi&&o.target.Nn()){var s=new Mi(o.target.path);null!==e.te.get(s)||e.we(r,s)||e.ue(r,s,new As(s,t))}i.Qi&&(n[r]=i.Wi(),i.zi())}}));var r=Va();this.ne.forEach((function(t,n){var i=!0;n.Bt((function(t){var n=e.le(t);return!n||2===n.ci||(i=!1)})),i&&(r=r.add(t))}));var i=new Ja(t,n,this.ie,this.te,r);return this.te=xa(),this.ne=ou(),this.ie=new eo(Du),i},$a.prototype.re=function(t,e){if(this.ce(t)){var n=this.we(t,e.key)?2:0;this.he(t).Ki(e.key,n),this.te=this.te.dt(e.key,e),this.ne=this.ne.dt(e.key,this.me(e.key).add(t))}},$a.prototype.ue=function(t,e,n){if(this.ce(t)){var r=this.he(t);this.we(t,e)?r.Ki(e,1):r.Hi(e),this.ne=this.ne.dt(e,this.me(e).delete(t)),n&&(this.te=this.te.dt(e,n))}},$a.prototype.removeTarget=function(t){delete this.Zi[t]},$a.prototype.de=function(t){var e=this.he(t).Wi();return this.$i.ge(t).size+e.ki.size-e.Oi.size},$a.prototype.Ji=function(t){this.he(t).Ji()},$a.prototype.he=function(t){return this.Zi[t]||(this.Zi[t]=new Qa),this.Zi[t]},$a.prototype.me=function(t){var e=this.ne.get(t);return e||(e=new eo(Du),this.ne=this.ne.dt(t,e)),e},$a.prototype.ce=function(t){var e=null!==this.le(t);return e||Eu("WatchChangeAggregator","Detected inactive target",t),e},$a.prototype.le=function(t){var e=this.Zi[t];return e&&e.Mi?null:this.$i.be(t)},$a.prototype.ae=function(t){var e=this;Au(!this.Zi[t].Mi,"Should only reset active targets"),this.Zi[t]=new Qa,this.$i.ge(t).forEach((function(n){e.ue(t,n,null)}))},$a.prototype.we=function(t,e){return this.$i.ge(t).has(e)},$a);function $a(t){this.$i=t,this.Zi={},this.te=xa(),this.ne=ou(),this.ie=new eo(Du)}function Za(){this.xi=0,this.ji=su(),this.Li=Ei.k,this.qi=!1,this.Bi=!0}function tu(t,e,n,r,i){this.resumeToken=t,this.Pi=e,this.ki=n,this.Ni=r,this.Oi=i}function eu(t,e,n,r,i){this.ai=t,this.Ei=e,this.Di=n,this.Ri=r,this.Si=i}function nu(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.pi=n,this.docChanges=r,this.yi=i,this.fromCache=o,this._i=s,this.Ii=a}function ru(){this.gi=new Vi(Mi.W)}function iu(t){this.W=t?function(e,n){return t(e,n)||Mi.W(e.key,n.key)}:function(t,e){return Mi.W(t.key,e.key)},this.vi=_a(),this.wi=new Vi(this.W)}function ou(){return new Vi(Mi.W)}function su(){return new Vi(Mi.W)}var au,uu,hu=((au={})[ua.ASCENDING.name]="ASCENDING",au[ua.DESCENDING.name]="DESCENDING",au),cu=((uu={})[ea.LESS_THAN.name]="LESS_THAN",uu[ea.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",uu[ea.GREATER_THAN.name]="GREATER_THAN",uu[ea.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",uu[ea.EQUAL.name]="EQUAL",uu[ea.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",uu[ea.IN.name]="IN",uu[ea.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",uu),fu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lu(t,e){Au(!Gs(t),e+" is missing")}function pu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Nu("can't parse "+t)}var du=(gu.prototype.pe=function(t){var e=void 0===t.code?Vr.UNKNOWN:Ca(t.code);return new Fr(e,t.message||"")},gu.prototype.ye=function(t){return this.options._e||Gs(t)?t:{value:t}},gu.prototype.Ie=function(t){var e;return Gs(e="object"==typeof t?t.value:t)?null:e},gu.prototype.G=function(t){return this.options._e?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},gu.prototype.L=function(t){if("string"==typeof t)return this.Te(t);Au(!!t,"Cannot deserialize null or undefined timestamp.");var e=pu(t.seconds||"0"),n=t.nanos||0;return new xi(e,n)},gu.prototype.Te=function(t){var e=0,n=fu.exec(t);if(Au(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new xi(o,e)},gu.prototype.Ee=function(t){return this.options._e?t.toBase64():t.toUint8Array()},gu.prototype.De=function(t){return this.options._e?(Au(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ei.fromBase64String(t||"")):(Au(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ei.fromUint8Array(t||new Uint8Array))},gu.prototype.Re=function(t){return"string"==typeof t?(Au(this.options._e,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ri.fromBase64String(t)):(Au(!this.options._e,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ri.fromUint8Array(t))},gu.prototype.toVersion=function(t){return this.G(t.G())},gu.prototype.fromVersion=function(t){return Au(!!t,"Trying to deserialize version that isn't set"),Li.L(this.L(t))},gu.prototype.Se=function(t,e){return this.Ae(t).child("documents").child(e).it()},gu.prototype.Ce=function(t){var e=_i.et(t);return Au(this.Pe(e),"Tried to deserialize invalid key "+e.toString()),e},gu.prototype.ke=function(t){return this.Se(this.Dn,t.path)},gu.prototype.Ne=function(t){var e=this.Ce(t);return Au(e.get(1)===this.Dn.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.Dn.projectId),Au(!e.get(3)&&!this.Dn.database||e.get(3)===this.Dn.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.Dn.database),new Mi(this.Oe(e))},gu.prototype.Fe=function(t){return this.Se(this.Dn,t)},gu.prototype.Ve=function(t){var e=this.Ce(t);return 4===e.length?_i.rt:this.Oe(e)},Object.defineProperty(gu.prototype,"Ue",{get:function(){return new _i(["projects",this.Dn.projectId,"databases",this.Dn.database]).it()},enumerable:!0,configurable:!0}),gu.prototype.Ae=function(t){return new _i(["projects",t.projectId,"databases",t.database])},gu.prototype.Oe=function(t){return Au(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.H(5)},gu.prototype.Pe=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},gu.prototype.xe=function(t){if(t instanceof _o)return{nullValue:"NULL_VALUE"};if(t instanceof Uo)return{booleanValue:t.value()};if(t instanceof ls)return{integerValue:""+t.value()};if(t instanceof ps){var e=t.value();if(this.options._e){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"};if(Bs(e))return{doubleValue:"-0"}}return{doubleValue:t.value()}}return t instanceof ds?{stringValue:t.value()}:t instanceof bs?{mapValue:this.je(t)}:t instanceof Is?{arrayValue:this.Le(t)}:t instanceof vs?{timestampValue:this.G(t.Jt)}:t instanceof ws?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ms?{bytesValue:this.Ee(t.value())}:t instanceof gs?{referenceValue:this.Se(t.Dn,t.key.path)}:Nu("Unknown FieldValue "+JSON.stringify(t))},gu.prototype.qe=function(t){var e=this;if("nullValue"in t)return _o.yn;if("booleanValue"in t)return Uo.of(t.booleanValue);if("integerValue"in t)return new ls(pu(t.integerValue));if("doubleValue"in t){if(this.options._e){if("NaN"===t.doubleValue)return ps.Tn;if("Infinity"===t.doubleValue)return ps.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return ps.NEGATIVE_INFINITY;if("-0"===t.doubleValue)return new ps(-0)}return new ps(t.doubleValue)}if("stringValue"in t)return new ds(t.stringValue);if("mapValue"in t)return this.Be(t.mapValue.fields||{});if("arrayValue"in t){lu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Is(n.map((function(t){return e.qe(t)})))}if("timestampValue"in t)return lu(t.timestampValue,"timestampValue"),new vs(this.L(t.timestampValue));if("geoPointValue"in t){lu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new ws(new Oi(r,i))}if("bytesValue"in t){lu(t.bytesValue,"bytesValue");var o=this.Re(t.bytesValue);return new ms(o)}if("referenceValue"in t){lu(t.referenceValue,"referenceValue");var s=this.Ce(t.referenceValue),a=new Lu(s.get(1),s.get(3)),u=new Mi(this.Oe(s));return new gs(a,u)}return Nu("Unknown Value proto "+JSON.stringify(t))},gu.prototype.Me=function(t,e){return{name:this.ke(t),fields:this.Qe(e)}},gu.prototype.Ge=function(t){return Au(!t.rn,"Can't serialize documents with mutations."),{name:this.ke(t.key),fields:this.Qe(t.data()),updateTime:this.G(t.version.G())}},gu.prototype.We=function(t,e){var n=this,r=this.Ne(t.name),i=this.fromVersion(t.updateTime);return new Ns(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.qe(t)}))},gu.prototype.Qe=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.xe(r)})),n},gu.prototype.Be=function(t){var e=this,n=t,r=bs.wn();return ei(n,(function(t,n){r.set(new qi([t]),e.qe(n))})),r.an()},gu.prototype.je=function(t){return{fields:this.Qe(t)}},gu.prototype.Le=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.xe(t))})),{values:n}},gu.prototype.ze=function(t){var e=this;Au(!!t.found,"Tried to deserialize a found document from a missing document."),lu(t.found.name,"doc.found.name"),lu(t.found.updateTime,"doc.found.updateTime");var n=this.Ne(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ns(n,r,{},void 0,t.found,(function(t){return e.qe(t)}))},gu.prototype.Ke=function(t){Au(!!t.missing,"Tried to deserialize a missing document from a found document."),Au(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.Ne(t.missing),n=this.fromVersion(t.readTime);return new As(e,n)},gu.prototype.He=function(t){return"found"in t?this.ze(t):"missing"in t?this.Ke(t):Nu("invalid batch get response: "+JSON.stringify(t))},gu.prototype.Je=function(t){switch(t){case 1:return"ADD";case 3:return"CURRENT";case 0:return"NO_CHANGE";case 2:return"REMOVE";case 4:return"RESET";default:return Nu("Unknown WatchTargetChangeState: "+t)}},gu.prototype.Ye=function(t){if(t instanceof Ba)return{filter:{count:t.Ui.count,targetId:t.targetId}};if(t instanceof Ga){if(t.Vi instanceof Ns){var e=t.Vi;return{documentChange:{document:{name:this.ke(e.key),fields:this.Qe(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.Fi,removedTargetIds:t.removedTargetIds}}}if(t.Vi instanceof As)return e=t.Vi,{documentDelete:{document:this.ke(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.Vi)return{documentRemove:{document:this.ke(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof za){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Hs.OK;switch(t){case Vr.OK:return Hs.OK;case Vr.CANCELLED:return Hs.CANCELLED;case Vr.UNKNOWN:return Hs.UNKNOWN;case Vr.DEADLINE_EXCEEDED:return Hs.DEADLINE_EXCEEDED;case Vr.RESOURCE_EXHAUSTED:return Hs.RESOURCE_EXHAUSTED;case Vr.INTERNAL:return Hs.INTERNAL;case Vr.UNAVAILABLE:return Hs.UNAVAILABLE;case Vr.UNAUTHENTICATED:return Hs.UNAUTHENTICATED;case Vr.INVALID_ARGUMENT:return Hs.INVALID_ARGUMENT;case Vr.NOT_FOUND:return Hs.NOT_FOUND;case Vr.ALREADY_EXISTS:return Hs.ALREADY_EXISTS;case Vr.PERMISSION_DENIED:return Hs.PERMISSION_DENIED;case Vr.FAILED_PRECONDITION:return Hs.FAILED_PRECONDITION;case Vr.ABORTED:return Hs.ABORTED;case Vr.OUT_OF_RANGE:return Hs.OUT_OF_RANGE;case Vr.UNIMPLEMENTED:return Hs.UNIMPLEMENTED;case Vr.DATA_LOSS:return Hs.DATA_LOSS;default:return Nu("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Je(t.state),targetIds:t.targetIds,resumeToken:this.Ee(t.resumeToken),cause:n}}}return Nu("Unrecognized watch change: "+JSON.stringify(t))},gu.prototype.Xe=function(t){var e,n=this;if("targetChange"in t){lu(t.targetChange,"targetChange");var r=this.$e(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.De(t.targetChange.resumeToken),s=t.targetChange.cause;e=new za(r,i,o,s&&this.pe(s)||null)}else if("documentChange"in t){lu(t.documentChange,"documentChange");var a=t.documentChange;lu(a.document,"documentChange.name"),lu(a.document.name,"documentChange.document.name"),lu(a.document.updateTime,"documentChange.document.updateTime");var u=this.Ne(a.document.name),h=this.fromVersion(a.document.updateTime),c=new Ns(u,h,{},void 0,a.document,(function(t){return n.qe(t)})),f=a.targetIds||[],l=a.removedTargetIds||[];e=new Ga(f,l,c.key,c)}else if("documentDelete"in t){lu(t.documentDelete,"documentDelete");var p=t.documentDelete;lu(p.document,"documentDelete.document"),u=this.Ne(p.document),h=p.readTime?this.fromVersion(p.readTime):Li.q(),c=new As(u,h),e=new Ga([],l=p.removedTargetIds||[],c.key,c)}else if("documentRemove"in t){lu(t.documentRemove,"documentRemove");var d=t.documentRemove;lu(d.document,"documentRemove"),u=this.Ne(d.document),e=new Ga([],l=d.removedTargetIds||[],u,null)}else{if(!("filter"in t))return Nu("Unknown change type "+JSON.stringify(t));lu(t.filter,"filter");var v=t.filter;lu(v.targetId,"filter.targetId");var y=v.count||0,m=new da(y);e=new Ba(v.targetId,m)}return e},gu.prototype.$e=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Nu("Got unexpected TargetChange.state: "+t)},gu.prototype.Ze=function(t){if(!("targetChange"in t))return Li.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Li.MIN:e.readTime?this.fromVersion(e.readTime):Li.MIN},gu.prototype.tr=function(t){var e,n=this;if(t instanceof Do)e={update:this.Me(t.key,t.value)};else if(t instanceof Oo)e={delete:this.ke(t.key)};else if(t instanceof Ro)e={update:this.Me(t.key,t.data),updateMask:this.nr(t.sn)};else if(t instanceof Co)e={transform:{document:this.ke(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.ir(t)}))}};else{if(!(t instanceof xo))return Nu("Unknown mutation type "+t.type);e={verify:this.ke(t.key)}}return t.en.Zt||(e.currentDocument=this.er(t.en)),e},gu.prototype.rr=function(t){var e=this,n=t.currentDocument?this.ur(t.currentDocument):So.NONE;if(t.update){lu(t.update.name,"name");var r=this.Ne(t.update.name),i=this.Be(t.update.fields||{});if(t.updateMask){var o=this.sr(t.updateMask);return new Ro(r,i,o,n)}return new Do(r,i,n)}if(t.delete)return r=this.Ne(t.delete),new Oo(r,n);if(t.transform){r=this.Ne(t.transform.document);var s=t.transform.fieldTransforms.map((function(t){return e.or(t)}));return Au(!0===n.exists,'Transforms only support precondition "exists == true"'),new Co(r,s)}return t.verify?(r=this.Ne(t.verify),new xo(r,n)):Nu("unknown mutation proto: "+JSON.stringify(t))},gu.prototype.er=function(t){return Au(!t.Zt,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Nu("Unknown precondition")},gu.prototype.ur=function(t){return void 0!==t.updateTime?So.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?So.exists(t.exists):So.NONE},gu.prototype.hr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Li.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map((function(t){return n.qe(t)}))),new vo(r,i)},gu.prototype.cr=function(t,e){var n=this;return t&&0<t.length?(Au(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.hr(t,e)}))):[]},gu.prototype.ir=function(t){var e=this,n=t.transform;if(n instanceof ro)return{fieldPath:t.field.it(),setToServerValue:"REQUEST_TIME"};if(n instanceof io)return{fieldPath:t.field.it(),appendMissingElements:{values:n.elements.map((function(t){return e.xe(t)}))}};if(n instanceof oo)return{fieldPath:t.field.it(),removeAllFromArray:{values:n.elements.map((function(t){return e.xe(t)}))}};if(n instanceof so)return{fieldPath:t.field.it(),increment:this.xe(n.Ht)};throw Nu("Unknown transform: "+t.transform)},gu.prototype.or=function(t){var e=this,n=null;if("setToServerValue"in t)Au("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=ro.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new io(r.map((function(t){return e.qe(t)})))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new oo(r.map((function(t){return e.qe(t)})));else if("increment"in t){var i=this.qe(t.increment);Au(i instanceof qo,"NUMERIC_ADD transform requires a NumberValue"),n=new so(i)}else Nu("Unknown transform proto: "+JSON.stringify(t));var o=qi.ht(t.fieldPath);return new Ao(o,n)},gu.prototype.ar=function(t){return{documents:[this.Fe(t.path)]}},gu.prototype.lr=function(t){var e=t.documents.length;Au(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return ta.jn(this.Ve(n)).Yn()},gu.prototype.dr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Au(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.Fe(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Au(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.Fe(n.J()),e.structuredQuery.from=[{collectionId:n.$()}]);var r=this.vr(t.filters);r&&(e.structuredQuery.where=r);var i=this.wr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ye(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.mr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.mr(t.endAt)),e},gu.prototype.gr=function(t){var e=this.Ve(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Au(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.br(n.where));var a=[];n.orderBy&&(a=this.pr(n.orderBy));var u=null;n.limit&&(u=this.Ie(n.limit));var h=null;n.startAt&&(h=this.yr(n.startAt));var c=null;return n.endAt&&(c=this.yr(n.endAt)),new ta(e,i,a,s,u,"F",h,c).Yn()},gu.prototype._r=function(t){var e=this.Ir(t.ci);return null==e?null:{"goog-listen-tags":e}},gu.prototype.Ir=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nu("Unrecognized query purpose: "+t)}},gu.prototype.Yn=function(t){var e,n=t.target;return(e=n.Nn()?{documents:this.ar(n)}:{query:this.dr(n)}).targetId=t.targetId,0<t.resumeToken.P()&&(e.resumeToken=this.Ee(t.resumeToken)),e},gu.prototype.vr=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof na?e.Tr(t):Nu("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},gu.prototype.br=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Er(t)]:void 0!==t.fieldFilter?[this.Dr(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.br(t)})).reduce((function(t,e){return t.concat(e)})):Nu("Unknown filter: "+JSON.stringify(t)):[]},gu.prototype.wr=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.Rr(t)}))},gu.prototype.pr=function(t){var e=this;return t.map((function(t){return e.Sr(t)}))},gu.prototype.mr=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.xe(t)}))}},gu.prototype.yr=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.qe(t)}));return new ha(r,n)},gu.prototype.Ar=function(t){return hu[t.name]},gu.prototype.Cr=function(t){switch(t){case"ASCENDING":return ua.ASCENDING;case"DESCENDING":return ua.DESCENDING;default:return}},gu.prototype.Pr=function(t){return cu[t.name]},gu.prototype.kr=function(t){switch(t){case"EQUAL":return ea.EQUAL;case"GREATER_THAN":return ea.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ea.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ea.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ea.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ea.ARRAY_CONTAINS;case"IN":return ea.IN;case"ARRAY_CONTAINS_ANY":return ea.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Nu("Unspecified operator");default:return Nu("Unknown operator")}},gu.prototype.Nr=function(t){return{fieldPath:t.it()}},gu.prototype.Or=function(t){return qi.ht(t.fieldPath)},gu.prototype.Rr=function(t){return{field:this.Nr(t.field),direction:this.Ar(t.dir)}},gu.prototype.Sr=function(t){return new ca(this.Or(t.field),this.Cr(t.direction))},gu.prototype.Dr=function(t){return na.create(this.Or(t.fieldFilter.field),this.kr(t.fieldFilter.op),this.qe(t.fieldFilter.value))},gu.prototype.Tr=function(t){if(t.op===ea.EQUAL){if(t.value.isEqual(ps.Tn))return{unaryFilter:{field:this.Nr(t.field),op:"IS_NAN"}};if(t.value.isEqual(_o.yn))return{unaryFilter:{field:this.Nr(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.Nr(t.field),op:this.Pr(t.op),value:this.xe(t.value)}}},gu.prototype.Er=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.Or(t.unaryFilter.field);return na.create(e,ea.EQUAL,ps.Tn);case"IS_NULL":var n=this.Or(t.unaryFilter.field);return na.create(n,ea.EQUAL,_o.yn);case"OPERATOR_UNSPECIFIED":return Nu("Unspecified filter");default:return Nu("Unknown filter")}},gu.prototype.nr=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.it())})),{fieldPaths:e}},gu.prototype.sr=function(t){var e=(t.fieldPaths||[]).map((function(t){return qi.ht(t)}));return No.Xt(e)},gu),vu=(mu.Fr=function(t){mu.platform&&Nu("Platform already defined"),mu.platform=t},mu.C=function(){return mu.platform||Nu("Platform not set"),mu.platform},mu),yu=new v("@firebase/firestore");function mu(){}function gu(t,e){this.Dn=t,this.options=e}function wu(){return yu.logLevel===o.DEBUG?0:yu.logLevel===o.SILENT?2:1}function bu(t){switch(t){case 0:yu.logLevel=o.DEBUG;break;case 1:yu.logLevel=o.ERROR;break;case 2:yu.logLevel=o.SILENT;break;default:yu.error("Firestore ("+qr+"): Invalid value passed to `setLogLevel`")}}function Eu(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(yu.logLevel<=o.DEBUG){var i=n.map(Tu);yu.debug.apply(yu,c(["Firestore ("+qr+") ["+t+"]: "+e],i))}}function Iu(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(yu.logLevel<=o.ERROR){var r=e.map(Tu);yu.error.apply(yu,c(["Firestore ("+qr+"): "+t],r))}}function Tu(t){if("string"==typeof t)return t;var e=vu.C();try{return e.Vr(t)}catch(e){return t}}function Nu(t){var e="FIRESTORE ("+qr+") INTERNAL ASSERTION FAILED: "+t;throw Iu(e),new Error(e)}function Au(t,e){t||Nu(e)}var Su=(ku.Ur=function(){for(var t="";t.length<20;)vu.C().randomBytes(40).forEach((function(e){t.length<20&&e<=247&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(e%62))}));return Au(20===t.length,"Invalid auto ID: "+t),t},ku);function ku(){}function Du(t,e){return t<e?-1:e<t?1:0}function Ru(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Cu(t){return t+"\0"}function Ou(t,e,n,r,i){this.Dn=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function xu(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}var Lu=(Object.defineProperty(Qu.prototype,"xr",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Qu.prototype.isEqual=function(t){return t instanceof Qu&&t.projectId===this.projectId&&t.database===this.database},Qu.prototype.B=function(t){return Du(this.projectId,t.projectId)||Du(this.database,t.database)},Qu),Pu=(Yu.prototype.zt=function(t,e,n){e&&Au(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.jr;Au(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.zt(e,s)}}return e},Yu.prototype.Wt=function(t,e){e&&Au(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.Wt(e,e,this.En));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.Wt(e,i,this.En))}return e},Yu.prototype.Lr=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.Wt(r.key,t.get(r.key));i&&(n=n.dt(r.key,i))})),n},Yu.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Va())},Yu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ru(this.mutations,t.mutations)&&Ru(this.baseMutations,t.baseMutations)},Yu),_u=(Ju.from=function(t,e,n,r){Au(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=qa(),o=t.mutations,s=0;s<o.length;s++)i=i.dt(o[s].key,n[s].version);return new Ju(t,e,n,r,i)},Ju),Uu=(Wu.prototype.get=function(t){var e=this.Mr(t),n=this.Qr[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},Wu.prototype.has=function(t){return void 0!==this.get(t)},Wu.prototype.set=function(t,e){var n=this.Mr(t),r=this.Qr[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Qr[n]=[[t,e]]},Wu.prototype.delete=function(t){var e=this.Mr(t),n=this.Qr[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Qr[e]:n.splice(r,1),!0;return!1},Wu.prototype.forEach=function(t){ei(this.Qr,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},Wu.prototype.Y=function(){return ni(this.Qr)},Wu),qu=(Ku.zr=function(t,e){for(var n=Va(),r=Va(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Ku(t,e.fromCache,n,r)},Ku),Mu=(Hu.prototype.Hr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Hu.prototype.next=function(){var t=++this.previousValue;return this.Jr&&this.Jr(t),t},Hu.Xr=-1,Hu),Vu=(zu.eu=function(t,e,n,r,i){var o=new zu(t,e,Date.now()+n,r,i);return o.start(n),o},zu.prototype.start=function(t){var e=this;this.ru=setTimeout((function(){return e.uu()}),t)},zu.prototype.su=function(){return this.uu()},zu.prototype.cancel=function(t){null!==this.ru&&(this.clearTimeout(),this.iu.reject(new Fr(Vr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},zu.prototype.uu=function(){var t=this;this.$r.ou((function(){return null!==t.ru?(t.clearTimeout(),t.op().then((function(e){return t.iu.resolve(e)}))):Promise.resolve()}))},zu.prototype.clearTimeout=function(){null!==this.ru&&(this.nu(this),clearTimeout(this.ru),this.ru=null)},zu),Fu=(Object.defineProperty(Bu.prototype,"vu",{get:function(){return this.cu},enumerable:!0,configurable:!0}),Bu.prototype.ou=function(t){this.enqueue(t)},Bu.prototype.wu=function(t){this.mu(),this.gu(t)},Bu.prototype.bu=function(t){return this.mu(),this.gu(t)},Bu.prototype.pu=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return this.mu(),this.cu?[3,2]:(this.cu=!0,[4,this.bu(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},Bu.prototype.enqueue=function(t){return this.mu(),this.cu?new Promise((function(t){})):this.gu(t)},Bu.prototype.gu=function(t){var e=this,n=this.hu.then((function(){return e.lu=!0,t().catch((function(t){e.fu=t,e.lu=!1;var n=t.stack||t.message||"";throw Iu("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.lu=!1,t}))}));return this.hu=n},Bu.prototype.yu=function(t,e,n){var r=this;this.mu(),Au(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.du.indexOf(t)&&(e=0);var i=Vu.eu(this,t,e,n,(function(t){return r._u(t)}));return this.au.push(i),i},Bu.prototype.mu=function(){this.fu&&Nu("AsyncQueue is already failed: "+(this.fu.stack||this.fu.message))},Bu.prototype.Iu=function(){Au(this.lu,"verifyOpInProgress() called when no op in progress on this queue.")},Bu.prototype.Tu=function(){return u(this,void 0,void 0,(function(){var t;return h(this,(function(e){switch(e.label){case 0:return[4,t=this.hu];case 1:e.sent(),e.label=2;case 2:if(t!==this.hu)return[3,0];e.label=3;case 3:return[2]}}))}))},Bu.prototype.Eu=function(t){for(var e=0,n=this.au;e<n.length;e++)if(n[e].Zr===t)return!0;return!1},Bu.prototype.Du=function(t){var e=this;return this.Tu().then((function(){Au("all"===t||e.Eu(t),"Attempted to drain to missing operation "+t),e.au.sort((function(t,e){return t.tu-e.tu}));for(var n=0,r=e.au;n<r.length;n++){var i=r[n];if(i.su(),"all"!==t&&i.Zr===t)break}return e.Tu()}))},Bu.prototype.Ru=function(t){this.du.push(t)},Bu.prototype._u=function(t){var e=this.au.indexOf(t);Au(0<=e,"Delayed operation not found."),this.au.splice(e,1)},Bu),ju=(Gu.prototype.catch=function(t){return this.next(void 0,t)},Gu.prototype.next=function(t,e){var n=this;return this.Pu&&Nu("Called next() or catch() twice for PersistencePromise"),this.Pu=!0,this.Cu?this.error?this.ku(e,this.error):this.Nu(t,this.result):new Gu((function(r,i){n.Su=function(e){n.Nu(t,e).next(r,i)},n.Au=function(t){n.ku(e,t).next(r,i)}}))},Gu.prototype.Ou=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},Gu.prototype.Fu=function(t){try{var e=t();return e instanceof Gu?e:Gu.resolve(e)}catch(t){return Gu.reject(t)}},Gu.prototype.Nu=function(t,e){return t?this.Fu((function(){return t(e)})):Gu.resolve(e)},Gu.prototype.ku=function(t,e){return t?this.Fu((function(){return t(e)})):Gu.reject(e)},Gu.resolve=function(t){return new Gu((function(e,n){e(t)}))},Gu.reject=function(t){return new Gu((function(e,n){n(t)}))},Gu.Vu=function(t){return new Gu((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},Gu.Uu=function(t){for(var e=Gu.resolve(!1),n=function(t){e=e.next((function(e){return e?Gu.resolve(e):t()}))},r=0,i=t;r<i.length;r++)n(i[r]);return e},Gu.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.Vu(r)},Gu);function Gu(t){var e=this;this.Su=null,this.Au=null,this.result=void 0,this.error=void 0,this.Cu=!1,this.Pu=!1,t((function(t){e.Cu=!0,e.result=t,e.Su&&e.Su(t)}),(function(t){e.Cu=!0,e.error=t,e.Au&&e.Au(t)}))}function Bu(){this.hu=Promise.resolve(),this.cu=!1,this.au=[],this.fu=null,this.lu=!1,this.du=[]}function zu(t,e,n,r,i){this.$r=t,this.Zr=e,this.tu=n,this.op=r,this.nu=i,this.iu=new xu,this.then=this.iu.promise.then.bind(this.iu.promise),this.catch=this.iu.promise.catch.bind(this.iu.promise),this.iu.promise.catch((function(t){}))}function Hu(t,e){var n=this;this.previousValue=t,e&&(e.Kr=function(t){return n.Hr(t)},this.Jr=function(t){return e.Yr(t)})}function Ku(t,e,n,r){this.targetId=t,this.fromCache=e,this.Gr=n,this.Wr=r}function Wu(t){this.Mr=t,this.Qr={}}function Ju(t,e,n,r,i){this.batch=t,this.qr=e,this.jr=n,this.streamToken=r,this.Br=i}function Yu(t,e,n,r){this.batchId=t,this.En=e,this.baseMutations=n,Au(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function Qu(t,e){this.projectId=t,this.database=e||"(default)"}function Xu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Du(n,i);return 0===s?Du(r,o):s}var $u=(dh.prototype.Lu=function(){return++this.ju},dh.prototype.qu=function(t){var e=[t,this.Lu()];if(this.buffer.size<this.xu)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Xu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(dh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),dh),Zu={Bu:!1,Mu:0,Qu:0,Gu:0},th=(ph.Hu=function(t){return new ph(t,ph.Ju,ph.Yu)},ph.Xu=-1,ph.$u=1048576,ph.ts=new ph(ph.Zu=41943040,ph.Ju=10,ph.Yu=1e3),ph.DISABLED=new ph(ph.Xu,0,0),ph),eh=(lh.prototype.start=function(t){Au(null===this.rs,"Cannot start an already started LruScheduler"),this.ns.params.Wu!==th.Xu&&this.us(t)},lh.prototype.stop=function(){this.rs&&(this.rs.cancel(),this.rs=null)},Object.defineProperty(lh.prototype,"ss",{get:function(){return null!==this.rs},enumerable:!0,configurable:!0}),lh.prototype.us=function(t){var e=this;Au(null===this.rs,"Cannot schedule GC while a task is pending");var n=this.es?3e5:6e4;Eu("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.rs=this.$r.yu("lru_garbage_collection",n,(function(){return e.rs=null,e.es=!0,t.os(e.ns).then((function(){return e.us(t)})).catch(vh)}))},lh),nh=(fh.prototype.cs=function(t,e){return this.hs.as(t).next((function(t){return Math.floor(e/100*t)}))},fh.prototype.fs=function(t,e){var n=this;if(0===e)return ju.resolve(Mu.Xr);var r=new $u(e);return this.hs.oe(t,(function(t){return r.qu(t.sequenceNumber)})).next((function(){return n.hs.ls(t,(function(t){return r.qu(t)}))})).next((function(){return r.maxValue}))},fh.prototype.ds=function(t,e,n){return this.hs.ds(t,e,n)},fh.prototype.vs=function(t,e){return this.hs.vs(t,e)},fh.prototype.ws=function(t,e){var n=this;return this.params.Wu===th.Xu?(Eu("LruGarbageCollector","Garbage collection skipped; disabled"),ju.resolve(Zu)):this.ms(t).next((function(r){return r<n.params.Wu?(Eu("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Wu),Zu):n.gs(t,e)}))},fh.prototype.ms=function(t){return this.hs.ms(t)},fh.prototype.gs=function(t,e){var n,r,i,o,s,a,u,h=this,c=Date.now();return this.cs(t,this.params.zu).next((function(e){return r=e>h.params.Ku?(Eu("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Ku+" from "+e),h.params.Ku):e,o=Date.now(),h.fs(t,r)})).next((function(r){return n=r,s=Date.now(),h.ds(t,n,e)})).next((function(e){return i=e,a=Date.now(),h.vs(t,n)})).next((function(t){return u=Date.now(),wu()<=0&&Eu("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-c)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-c)+"ms"),ju.resolve({Bu:!0,Mu:r,Qu:i,Gu:t})}))},fh),rh=(ch.prototype.Y=function(){return this.bs.Y()},ch.prototype._s=function(t,e){var n=new ih(t,e);this.bs=this.bs.add(n),this.ps=this.ps.add(n)},ch.prototype.Is=function(t,e){var n=this;t.forEach((function(t){return n._s(t,e)}))},ch.prototype.Ts=function(t,e){this.Es(new ih(t,e))},ch.prototype.Ds=function(t,e){var n=this;t.forEach((function(t){return n.Ts(t,e)}))},ch.prototype.Rs=function(t){var e=this,n=Mi.EMPTY,r=new ih(n,t),i=new ih(n,t+1),o=[];return this.ps.qt([r,i],(function(t){e.Es(t),o.push(t.key)})),o},ch.prototype.Ss=function(){var t=this;this.bs.forEach((function(e){return t.Es(e)}))},ch.prototype.Es=function(t){this.bs=this.bs.delete(t),this.ps=this.ps.delete(t)},ch.prototype.As=function(t){var e=Mi.EMPTY,n=new ih(e,t),r=new ih(e,t+1),i=Va();return this.ps.qt([n,r],(function(t){i=i.add(t.key)})),i},ch.prototype.Cs=function(t){var e=new ih(t,0),n=this.bs.Mt(e);return null!==n&&t.isEqual(n.key)},ch),ih=(hh.Rn=function(t,e){return Mi.W(t.key,e.key)||Du(t.Ps,e.Ps)},hh.ys=function(t,e){return Du(t.Ps,e.Ps)||Mi.W(t.key,e.key)},hh),oh=(Object.defineProperty(uh.prototype,"readTime",{get:function(){return Au(void 0!==this.Os,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.Os},set:function(t){Au(void 0===this.Os||this.Os.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.Os=t},enumerable:!0,configurable:!0}),uh.prototype.Fs=function(t,e){this.Vs(),this.readTime=e,this.ks.set(t.key,t)},uh.prototype.Us=function(t,e){this.Vs(),e&&(this.readTime=e),this.ks.set(t,null)},uh.prototype.xs=function(t,e){this.Vs();var n=this.ks.get(e);return void 0!==n?ju.resolve(n):this.js(t,e)},uh.prototype.getEntries=function(t,e){return this.Ls(t,e)},uh.prototype.apply=function(t){return this.Vs(),this.Ns=!0,this.qs(t)},uh.prototype.Vs=function(){Au(!this.Ns,"Changes have already been applied.")},uh),sh=(ah.prototype.start=function(){return this.eo()},ah.prototype.ro=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i=this;return h(this,(function(o){switch(o.label){case 0:return e=this.Hs,n=this.to,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var o;return i.Hs.uo(r).next((function(s){return o=s,e=i.persistence.Js(t),n=new Ph(i.Ys,e,i.persistence.no()),e.uo(r)})).next((function(t){for(var e=[],i=[],s=Va(),a=0,u=o;a<u.length;a++){var h=u[a];e.push(h.batchId);for(var c=0,f=h.mutations;c<f.length;c++){var l=f[c];s=s.add(l.key)}}for(var p=0,d=t;p<d.length;p++){h=d[p],i.push(h.batchId);for(var v=0,y=h.mutations;v<y.length;v++)l=y[v],s=s.add(l.key)}return n.so(r,s).next((function(t){return{oo:t,ho:e,co:i}}))}))}))];case 1:return r=o.sent(),this.Hs=e,this.to=n,this.Bs.io(this.to),[2,r]}}))}))},ah.prototype.ao=function(t){var e,n=this,r=xi.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Va());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.to.so(o,i).next((function(i){e=i;for(var s=[],a=0,u=t;a<u.length;a++){var h=u[a],c=h.un(e.get(h.key));null!=c&&s.push(new Ro(h.key,c,c.sn(),So.exists(!0)))}return n.Hs.fo(o,r,s,t)}))})).then((function(t){var n=t.Lr(e);return{batchId:t.batchId,ks:n}}))},ah.prototype.lo=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(n){return e.Hs.do(n,t).next((function(t){return t?e.to.so(n,t):ju.resolve(null)}))}))},ah.prototype.vo=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.Ys.wo({mo:!0});return e.Hs.vo(n,t.batch,t.streamToken).next((function(){return e.bo(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.Hs.po(n)})).next((function(){return e.to.so(n,r)}))}))},ah.prototype.yo=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.Hs._o(n,t).next((function(t){return Au(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.Hs.Io(n,t)})).next((function(){return e.Hs.po(n)})).next((function(){return e.to.so(n,r)}))}))},ah.prototype.To=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.Hs.To(e)}))},ah.prototype.Eo=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",(function(e){return t.Hs.Eo(e)}))},ah.prototype.Do=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",(function(n){return e.Hs.Do(n,t)}))},ah.prototype.Ro=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.$s.Ro(e)}))},ah.prototype.So=function(t){var e=this,n=t.ai,r=this.Qs;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(i){var o=e.Ys.wo({mo:!0});r=e.Qs;var s=[];ti(t.Ei,(function(t,o){var a=r.get(t);if(a){s.push(e.$s.Ao(i,o.Oi,t).next((function(){return e.$s.Co(i,o.ki,t)})));var u=o.resumeToken;if(0<u.P()){var h=a.li(u,n).fi(i.Po);r=r.dt(t,h),ah.ko(a,h,o)&&s.push(e.$s.No(i,h))}}}));var a=xa(),u=Va();if(t.Ri.forEach((function(t,e){u=u.add(t)})),s.push(o.getEntries(i,u).next((function(r){t.Ri.forEach((function(u,h){var c=r.get(u);h instanceof As&&h.version.isEqual(Li.MIN)?(o.Us(u,n),a=a.dt(u,h)):null==c||0<h.version.B(c.version)||0===h.version.B(c.version)&&c.hasPendingWrites?(Au(!Li.MIN.isEqual(n),"Cannot add a document when the remote version is zero"),o.Fs(h,n),a=a.dt(u,h)):Eu("LocalStore","Ignoring outdated watch update for ",u,". Current version:",c.version," Watch version:",h.version),t.Si.has(u)&&s.push(e.persistence.Ks.Oo(i,u))}))}))),!n.isEqual(Li.MIN)){var h=e.$s.Ro(i).next((function(t){return Au(0<=n.B(t),"Watch stream reverted to previous snapshot?? "+n+" < "+t),e.$s.Fo(i,i.Po,n)}));s.push(h)}return ju.Vu(s).next((function(){return o.apply(i)})).next((function(){return e.to.Vo(i,a)}))})).then((function(t){return e.Qs=r,t}))},ah.ko=function(t,e,n){return Au(0<e.resumeToken.P(),"Attempted to persist target data with no resume token"),0===t.resumeToken.P()||e.ai.M()-t.ai.M()>=this.Uo||0<n.ki.size+n.Ni.size+n.Oi.size},ah.prototype.xo=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.Ms.Is(i.Gr,o),this.Ms.Ds(i.Wr,o),!i.fromCache){var s=this.Qs.get(o);Au(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.ai,u=s.di(a);this.Qs=this.Qs.dt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(n){return ju.forEach(t,(function(t){return ju.forEach(t.Wr,(function(t){return e.persistence.Ks.Ts(n,t)}))}))}))},ah.prototype.jo=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.Hs.Lo(n,t)}))},ah.prototype.qo=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.to.Bo(n,t)}))},ah.prototype.Mo=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.$s.Qo(n,t).next((function(i){return i?(r=i,ju.resolve(r)):e.$s.Go(n).next((function(i){return r=new pa(t,i,0,n.Po),e.$s.Wo(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.Qs.get(n.targetId)&&(e.Qs=e.Qs.dt(n.targetId,n),e.Gs.set(t,n.targetId)),n}))},ah.prototype.Qo=function(t,e){var n=this.Gs.get(e);return void 0!==n?ju.resolve(this.Qs.get(n)):this.$s.Qo(t,e)},ah.prototype.zo=function(t,e){var n=this,r=this.Qs.get(t);Au(null!==r,"Tried to release nonexistent target: "+t);var i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,(function(i){var o=n.Ms.Rs(t);return e?ju.resolve():ju.forEach(o,(function(t){return n.persistence.Ks.Ts(i,t)})).next((function(){n.persistence.Ks.removeTarget(i,r)}))})).then((function(){n.Qs=n.Qs.remove(t),n.Gs.delete(r.target)}))},ah.prototype.Ko=function(t,e){var n=this,r=Li.MIN,i=Va();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.Qo(o,t.Yn()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.$s.Ho(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.Bs.Jo(o,t,e?r:Li.MIN,e?i:Va())})).next((function(t){return{documents:t,Yo:i}}))}))},ah.prototype.Xo=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",(function(n){return e.$s.Ho(n,t)}))},ah.prototype.$o=function(){return this.persistence.$o()},ah.prototype.Zo=function(t){this.Hs.th(t)},ah.prototype.nh=function(t){this.persistence.nh(t)},ah.prototype.bo=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=ju.resolve();return o.forEach((function(r){s=s.next((function(){return n.xs(t,r)})).next((function(t){var o=t,s=e.Br.get(r);Au(null!==s,"ackVersions should contain every doc in the write."),(!o||o.version.B(s)<0)&&((o=i.zt(r,o,e))?n.Fs(o,e.qr):Au(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),s.next((function(){return r.Hs.Io(t,i)}))},ah.prototype.os=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.ws(n,e.Qs)}))},ah.prototype.ih=function(t){var e=this,n=this.Qs.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly",(function(n){return e.$s.be(n,t).next((function(t){return t?t.target:null}))}))},ah.prototype.eh=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(e){return t.Ys.eh(e,t.Ws)})).then((function(e){var n=e.rh,r=e.readTime;return t.Ws=r,n}))},ah.prototype.eo=function(){return u(this,void 0,void 0,(function(){var t,e=this;return h(this,(function(n){switch(n.label){case 0:return[4,(t=this).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e.Ys.uh(t)}))];case 1:return t.Ws=n.sent(),[2]}}))}))},ah.Uo=3e8,ah);function ah(t,e,n){this.persistence=t,this.Bs=e,this.Ms=new rh,this.Qs=new Vi(Du),this.Gs=new Uu((function(t){return t.canonicalId()})),this.Ws=Li.MIN,Au(t.ss,"LocalStore was passed an unstarted persistence implementation"),this.persistence.Ks.zs(this.Ms),this.Hs=t.Js(n),this.Ys=t.Xs(),this.$s=t.Zs(),this.to=new Ph(this.Ys,this.Hs,this.persistence.no()),this.Bs.io(this.to)}function uh(){this.ks=new Uu((function(t){return t.toString()})),this.Ns=!1}function hh(t,e){this.key=t,this.Ps=e}function ch(){this.bs=new eo(ih.Rn),this.ps=new eo(ih.ys)}function fh(t,e){this.hs=t,this.params=e}function lh(t,e){this.ns=t,this.$r=e,this.es=!1,this.rs=null}function ph(t,e,n){this.Wu=t,this.zu=e,this.Ku=n}function dh(t){this.xu=t,this.buffer=new eo(Xu),this.ju=0}function vh(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){if(t.code!==Vr.FAILED_PRECONDITION||t.message!==xh)throw t;return Eu("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function yh(t,e){return Au(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),"firestore_clients_"+t+"_"+e}function mh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function gh(t,e){return"firestore_targets_"+t+"_"+e}var wh=(Ch.sh=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Fr(r.error.code,r.error.message)),i?new Ch(t,e,r.state,o):(Iu("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Ch.prototype.oh=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Ch),bh=(Rh.sh=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Fr(n.error.code,n.error.message)),r?new Rh(t,n.state,i):(Iu("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Rh.prototype.oh=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Rh),Eh=(Dh.sh=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ja(),o=0;r&&o<n.activeTargetIds.length;++o)r=zs(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Dh(t,i):(Iu("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Dh),Ih=(kh.sh=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new kh(e.clientId,e.onlineState):(Iu("SharedClientState","Failed to parse online state: "+t),null)},kh),Th=(Sh.prototype.hh=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Sh.prototype.ah=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Sh.prototype.oh=function(){var t={activeTargetIds:this.activeTargetIds.nt(),updateTimeMs:Date.now()};return JSON.stringify(t)},Sh),Nh=(Ah.ph=function(t){return!(!t.window||null==t.window.localStorage)},Ah.prototype.start=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,f,l=this;return h(this,(function(h){switch(h.label){case 0:return Au(!this.ss,"WebStorageSharedClientState already started"),Au(null!==this.dh,"syncEngine property must be set before calling start()"),Au(null!==this.vh,"onlineStateHandler property must be set before calling start()"),[4,this.dh.$o()];case 1:for(t=h.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.lh&&(i=this.getItem(yh(this.persistenceKey,r)))&&(o=Eh.sh(r,i))&&(this.wh[o.clientId]=o);for(this.Rh(),(s=this.storage.getItem(this.Dh))&&(a=this.Sh(s))&&this.Ah(a),u=0,c=this.bh;u<c.length;u++)f=c[u],this.gh(f);return this.bh=[],this.platform.window.addEventListener("unload",(function(){return l.shutdown()})),this.ss=!0,[2]}}))}))},Ah.prototype.Yr=function(t){this.setItem(this._h,JSON.stringify(t))},Ah.prototype.Ch=function(){var t=ja();return ei(this.wh,(function(e,n){t=t.Qt(n.activeTargetIds)})),t},Ah.prototype.Ph=function(t){for(var e in this.wh)if(this.wh.hasOwnProperty(e)&&this.wh[e].activeTargetIds.has(t))return!0;return!1},Ah.prototype.kh=function(t){this.Nh(t,"pending")},Ah.prototype.Oh=function(t,e,n){this.Nh(t,e,n),this.Fh(t)},Ah.prototype.Vh=function(t){var e="not-current";if(this.Ph(t)){var n=this.storage.getItem(gh(this.persistenceKey,t));if(n){var r=bh.sh(t,n);r&&(e=r.state)}}return this.Uh.hh(t),this.Rh(),e},Ah.prototype.xh=function(t){this.Uh.ah(t),this.Rh()},Ah.prototype.jh=function(t){return this.Uh.activeTargetIds.has(t)},Ah.prototype.Lh=function(t){this.removeItem(gh(this.persistenceKey,t))},Ah.prototype.qh=function(t,e,n){this.Bh(t,e,n)},Ah.prototype.ro=function(t,e,n){var r=this;e.forEach((function(t){r.Fh(t)})),this.currentUser=t,n.forEach((function(t){r.kh(t)}))},Ah.prototype.Mh=function(t){this.Qh(t)},Ah.prototype.shutdown=function(){this.ss&&(this.platform.window.removeEventListener("storage",this.mh),this.removeItem(this.yh),this.ss=!1)},Ah.prototype.getItem=function(t){var e=this.storage.getItem(t);return Eu("SharedClientState","READ",t,e),e},Ah.prototype.setItem=function(t,e){Eu("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Ah.prototype.removeItem=function(t){Eu("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Ah.prototype.gh=function(t){var e=this;if(t.storageArea===this.storage){if(Eu("SharedClientState","EVENT",t.key,t.newValue),t.key===this.yh)return void Iu("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fh.ou((function(){return u(e,void 0,void 0,(function(){var e,n,r,i,o,s;return h(this,(function(a){if(!this.ss)return this.bh.push(t),[2];if(null===t.key)return[2];if(this.Ih.test(t.key)){if(null==t.newValue)return n=this.Gh(t.key),[2,this.Wh(n,null)];if(e=this.zh(t.key,t.newValue))return[2,this.Wh(e.clientId,e)]}else if(this.Th.test(t.key)){if(null!==t.newValue&&(r=this.Kh(t.key,t.newValue)))return[2,this.Hh(r)]}else if(this.Eh.test(t.key)){if(null!==t.newValue&&(i=this.Jh(t.key,t.newValue)))return[2,this.Yh(i)]}else if(t.key===this.Dh){if(null!==t.newValue&&(o=this.Sh(t.newValue)))return[2,this.Ah(o)]}else t.key===this._h&&(Au(!!this.Kr,"Missing sequenceNumberHandler"),(s=function(t){var e=Mu.Xr;if(null!=t)try{var n=JSON.parse(t);Au("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Iu("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Mu.Xr&&this.Kr(s));return[2]}))}))}))}},Object.defineProperty(Ah.prototype,"Uh",{get:function(){return this.wh[this.lh]},enumerable:!0,configurable:!0}),Ah.prototype.Rh=function(){this.setItem(this.yh,this.Uh.oh())},Ah.prototype.Nh=function(t,e,n){var r=new wh(this.currentUser,t,e,n),i=mh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.oh())},Ah.prototype.Fh=function(t){var e=mh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Ah.prototype.Qh=function(t){var e={clientId:this.lh,onlineState:t};this.storage.setItem(this.Dh,JSON.stringify(e))},Ah.prototype.Bh=function(t,e,n){var r=gh(this.persistenceKey,t),i=new bh(t,e,n);this.setItem(r,i.oh())},Ah.prototype.Gh=function(t){var e=this.Ih.exec(t);return e?e[1]:null},Ah.prototype.zh=function(t,e){var n=this.Gh(t);return Au(null!==n,"Cannot parse client state key '"+t+"'"),Eh.sh(n,e)},Ah.prototype.Kh=function(t,e){var n=this.Th.exec(t);Au(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return wh.sh(new Mr(i),r,e)},Ah.prototype.Jh=function(t,e){var n=this.Eh.exec(t);Au(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return bh.sh(r,e)},Ah.prototype.Sh=function(t){return Ih.sh(t)},Ah.prototype.Hh=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){return t.user.uid!==this.currentUser.uid?(Eu("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.dh.Xh(t.batchId,t.state,t.error)]}))}))},Ah.prototype.Yh=function(t){return this.dh.$h(t.targetId,t.state,t.error)},Ah.prototype.Wh=function(t,e){var n=this,r=this.Ch();e?this.wh[t]=e:delete this.wh[t];var i=this.Ch(),o=[],s=[];return i.forEach((function(t){return u(n,void 0,void 0,(function(){return h(this,(function(e){return r.has(t)||o.push(t),[2]}))}))})),r.forEach((function(t){return u(n,void 0,void 0,(function(){return h(this,(function(e){return i.has(t)||s.push(t),[2]}))}))})),this.dh.Zh(o,s)},Ah.prototype.Ah=function(t){this.wh[t.clientId]&&this.vh(t.onlineState)},Ah);function Ah(t,e,n,r,i){if(this.fh=t,this.platform=e,this.persistenceKey=n,this.lh=r,this.dh=null,this.vh=null,this.Kr=null,this.wh={},this.mh=this.gh.bind(this),this.ss=!1,this.bh=[],!Ah.ph(this.platform))throw new Fr(Vr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.yh=yh(this.persistenceKey,this.lh),this._h="firestore_sequence_number_"+this.persistenceKey,this.wh[this.lh]=new Th,this.Ih=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Th=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Eh=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Dh="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.mh)}function Sh(){this.activeTargetIds=ja()}function kh(t,e){this.clientId=t,this.onlineState=e}function Dh(t,e){this.clientId=t,this.activeTargetIds=e}function Rh(t,e,n){this.targetId=t,this.state=e,Au(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function Ch(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Au(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var Oh=(Vh.prototype.kh=function(t){},Vh.prototype.Oh=function(t,e,n){},Vh.prototype.Vh=function(t){return this.tc.hh(t),this.nc[t]||"not-current"},Vh.prototype.qh=function(t,e,n){this.nc[t]=e},Vh.prototype.xh=function(t){this.tc.ah(t)},Vh.prototype.jh=function(t){return this.tc.activeTargetIds.has(t)},Vh.prototype.Lh=function(t){delete this.nc[t]},Vh.prototype.Ch=function(){return this.tc.activeTargetIds},Vh.prototype.Ph=function(t){return this.tc.activeTargetIds.has(t)},Vh.prototype.start=function(){return this.tc=new Th,Promise.resolve()},Vh.prototype.ro=function(t,e,n){},Vh.prototype.Mh=function(t){},Vh.prototype.shutdown=function(){},Vh.prototype.Yr=function(t){},Vh),xh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lh=(Mh.prototype.ec=function(t){this.ic.push(t)},Mh.prototype.rc=function(){this.ic.forEach((function(t){return t()}))},Mh),Ph=(qh.prototype.Bo=function(t,e){var n=this;return this.Hs.oc(t,e).next((function(r){return n.hc(t,e,r)}))},qh.prototype.hc=function(t,e,n){return this.uc.xs(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Wt(e,t);return t}))},qh.prototype.cc=function(t,e,n){var r=La();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].Wt(t,e);r=r.dt(t,e)})),r},qh.prototype.so=function(t,e){var n=this;return this.uc.getEntries(t,e).next((function(e){return n.Vo(t,e)}))},qh.prototype.Vo=function(t,e){var n=this;return this.Hs.ac(t,e).next((function(r){var i=n.cc(t,e,r),o=xa();return i.forEach((function(t,e){e=e||new As(t,Li.q()),o=o.dt(t,e)})),o}))},qh.prototype.Jo=function(t,e,n){return e.Nn()?this.fc(t,e.path):e.ui()?this.lc(t,e,n):this.dc(t,e,n)},qh.prototype.fc=function(t,e){return this.Bo(t,new Mi(e)).next((function(t){var e=_a();return t instanceof Ns&&(e=e.dt(t.key,t)),e}))},qh.prototype.lc=function(t,e,n){var r=this;Au(e.path.Y(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=_a();return this.sc.vc(t,i).next((function(s){return ju.forEach(s,(function(s){var a=e.Hn(s.child(i));return r.dc(t,a,n).next((function(t){t.forEach((function(t,e){o=o.dt(t,e)}))}))})).next((function(){return o}))}))},qh.prototype.dc=function(t,e,n){var r,i,o=this;return this.uc.Jo(t,e,n).next((function(n){return r=n,o.Hs.wc(t,e)})).next((function(e){return i=e,o.mc(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],h=u.key,c=r.get(h),f=u.Wt(c,c,o.En);r=f instanceof Ns?r.dt(h,f):r.remove(h)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},qh.prototype.mc=function(t,e,n){for(var r=Va(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Ro&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.uc.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof Ns&&(h=h.dt(t,e))})),h}))},qh),_h=(Uh.prototype.io=function(t){this.gc=t},Uh.prototype.Jo=function(t,e,n,r){var i=this;return Au(void 0!==this.gc,"setLocalDocumentsView() not called"),e.Jn()||n.isEqual(Li.MIN)?this.bc(t,e):this.gc.so(t,r).next((function(o){var s=i.pc(e,o);return(e.ii()||e.ei())&&i.yc(e.Fn,s,r,n)?i.bc(t,e):(wu()<=0&&Eu("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.gc.Jo(t,e,n).next((function(t){return s.forEach((function(e){t=t.dt(e.key,e)})),t})))}))},Uh.prototype.pc=function(t,e){var n=new eo((function(e,n){return t.Xn(e,n)}));return e.forEach((function(e,r){r instanceof Ns&&t.matches(r)&&(n=n.add(r))})),n},Uh.prototype.yc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.B(r))},Uh.prototype.bc=function(t,e){return wu()<=0&&Eu("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.gc.Jo(t,e,Li.MIN)},Uh);function Uh(){}function qh(t,e,n){this.uc=t,this.Hs=e,this.sc=n}function Mh(){this.ic=[]}function Vh(){this.tc=new Th,this.nc={},this.dh=null,this.vh=null,this.Kr=null}function Fh(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Gh(e)),e=jh(t.get(n),e);return Gh(e)}function jh(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Gh(t){return t+""}function Bh(t){var e=t.length;if(Au(2<=e,"Invalid path "+t),2===e)return Au(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),_i.rt;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Nu('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Nu('Invalid encoded resource path: "'+t+'"')}o=s+2}return new _i(r)}var zh=(Yh.prototype.Ic=function(t,e){return this._c.add(e),ju.resolve()},Yh.prototype.vc=function(t,e){return ju.resolve(this._c.getEntries(e))},Yh),Hh=(Jh.prototype.add=function(t){Au(t.length%2==1,"Expected a collection path.");var e=t.$(),n=t.J(),r=this.index[e]||new eo(_i.W),i=!r.has(n);return this.index[e]=r.add(n),i},Jh.prototype.has=function(t){var e=t.$(),n=t.J(),r=this.index[e];return r&&r.has(n)},Jh.prototype.getEntries=function(t){return(this.index[t]||new eo(_i.W)).nt()},Jh),Kh=(Wh.prototype.Dc=function(t){return ju.resolve(0===this.Hs.length)},Wh.prototype.vo=function(t,e,n){var r=e.batchId,i=this.Rc(r,"acknowledged");Au(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Hs[i];return Au(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,ju.resolve()},Wh.prototype.Eo=function(t){return ju.resolve(this.lastStreamToken)},Wh.prototype.Do=function(t,e){return this.lastStreamToken=e,ju.resolve()},Wh.prototype.fo=function(t,e,n,r){Au(0!==r.length,"Mutation batches should not be empty");var i=this.Tc;this.Tc++,0<this.Hs.length&&Au(this.Hs[this.Hs.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Pu(i,e,n,r);this.Hs.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.Ec=this.Ec.add(new ih(u.key,i)),this.sc.Ic(t,u.key.path.J())}return ju.resolve(o)},Wh.prototype._o=function(t,e){return ju.resolve(this.Sc(e))},Wh.prototype.do=function(t,e){var n=this.Sc(e);return Au(null!=n,"Failed to find local mutation batch."),ju.resolve(n.keys())},Wh.prototype.Lo=function(t,e){var n=e+1,r=this.Ac(n),i=r<0?0:r;return ju.resolve(this.Hs.length>i?this.Hs[i]:null)},Wh.prototype.To=function(){return ju.resolve(0===this.Hs.length?-1:this.Tc-1)},Wh.prototype.uo=function(t){return ju.resolve(this.Hs.slice())},Wh.prototype.oc=function(t,e){var n=this,r=new ih(e,0),i=new ih(e,Number.POSITIVE_INFINITY),o=[];return this.Ec.qt([r,i],(function(t){Au(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.Sc(t.Ps);Au(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),ju.resolve(o)},Wh.prototype.ac=function(t,e){var n=this,r=new eo(Du);return e.forEach((function(t){var e=new ih(t,0),i=new ih(t,Number.POSITIVE_INFINITY);n.Ec.qt([e,i],(function(e){Au(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.Ps)}))})),ju.resolve(this.Cc(r))},Wh.prototype.wc=function(t,e){Au(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Mi.ct(i)||(i=i.child(""));var o=new ih(new Mi(i),0),s=new eo(Du);return this.Ec.Bt((function(t){var e=t.key.path;return!!n.Z(e)&&(e.length===r&&(s=s.add(t.Ps)),!0)}),o),ju.resolve(this.Cc(s))},Wh.prototype.Cc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Sc(t);null!==r&&n.push(r)})),n},Wh.prototype.Io=function(t,e){var n=this;Au(0===this.Rc(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Hs.shift();var r=this.Ec;return ju.forEach(e.mutations,(function(i){var o=new ih(i.key,e.batchId);return r=r.delete(o),n.Ks.Pc(t,i.key)})).next((function(){n.Ec=r}))},Wh.prototype.th=function(t){},Wh.prototype.Cs=function(t,e){var n=new ih(e,0),r=this.Ec.Mt(n);return ju.resolve(e.isEqual(r&&r.key))},Wh.prototype.po=function(t){return 0===this.Hs.length&&Au(this.Ec.Y(),"Document leak -- detected dangling mutation references when queue is empty."),ju.resolve()},Wh.prototype.Rc=function(t,e){var n=this.Ac(t);return Au(0<=n&&n<this.Hs.length,"Batches must exist to be "+e),n},Wh.prototype.Ac=function(t){return 0===this.Hs.length?0:t-this.Hs[0].batchId},Wh.prototype.Sc=function(t){var e=this.Ac(t);if(e<0||e>=this.Hs.length)return null;var n=this.Hs[e];return Au(n.batchId===t,"If found batch must match"),n},Wh);function Wh(t,e){this.sc=t,this.Ks=e,this.Hs=[],this.Tc=1,this.lastStreamToken=Ei.k,this.Ec=new eo(ih.Rn)}function Jh(){this.index={}}function Yh(){this._c=new Hh}var Qh,Xh,$h,Zh,tc=(kc.prototype.Fs=function(t,e,n){Au(!n.isEqual(Li.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.kc(e);return this.docs=this.docs.dt(r,{Nc:e,size:s,readTime:n}),this.size+=s-o,this.sc.Ic(t,r.path.J())},kc.prototype.Us=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},kc.prototype.xs=function(t,e){var n=this.docs.get(e);return ju.resolve(n?n.Nc:null)},kc.prototype.getEntries=function(t,e){var n=this,r=La();return e.forEach((function(t){var e=n.docs.get(t);r=r.dt(t,e?e.Nc:null)})),ju.resolve(r)},kc.prototype.Jo=function(t,e,n){Au(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=_a(),i=new Mi(e.path.child("")),o=this.docs._t(i);o.St();){var s=o.Rt(),a=s.key,u=s.value,h=u.Nc,c=u.readTime;if(!e.path.Z(a.path))break;c.B(n)<=0||h instanceof Ns&&e.matches(h)&&(r=r.dt(h.key,h))}return ju.resolve(r)},kc.prototype.Oc=function(t,e){return ju.forEach(this.docs,(function(t){return e(t)}))},kc.prototype.eh=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},kc.prototype.uh=function(t){return ju.resolve(Li.MIN)},kc.prototype.wo=function(t){return new kc.Fc(this)},kc.prototype.Vc=function(t){return ju.resolve(this.size)},kc.Fc=(r(Dc,Zh=oh),Dc.prototype.qs=function(t){var e=this,n=[];return this.ks.forEach((function(r,i){i?n.push(e.Uc.Fs(t,i,e.readTime)):e.Uc.Us(r)})),ju.Vu(n)},Dc.prototype.js=function(t,e){return this.Uc.xs(t,e)},Dc.prototype.Ls=function(t,e){return this.Uc.getEntries(t,e)},Dc),kc),ec=(Sc.prototype.next=function(){var t=this.Lc;return this.Lc+=2,t},Sc.prototype.after=function(t){return this.jc(t+2),this.next()},Sc.prototype.jc=function(t){Au((1&t)===this.xc,"Cannot supply target ID from different generator ID"),this.Lc=t},Sc.qc=function(){return new Sc(0,2)},Sc.Bc=function(){return new Sc(1)},Sc),nc=(Ac.prototype.oe=function(t,e){return this.Mc.forEach((function(t,n){return e(n)})),ju.resolve()},Ac.prototype.Ro=function(t){return ju.resolve(this.lastRemoteSnapshotVersion)},Ac.prototype.zc=function(t){return ju.resolve(this.Qc)},Ac.prototype.Go=function(t){var e=this.Wc.after(this.highestTargetId);return this.highestTargetId=e,ju.resolve(e)},Ac.prototype.Fo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Qc&&(this.Qc=e),ju.resolve()},Ac.prototype.Kc=function(t){this.Mc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Qc&&(this.Qc=t.sequenceNumber)},Ac.prototype.Wo=function(t,e){return Au(!this.Mc.has(e.target),"Adding a target that already exists"),this.Kc(e),this.targetCount+=1,ju.resolve()},Ac.prototype.No=function(t,e){return Au(this.Mc.has(e.target),"Updating a non-existent target"),this.Kc(e),ju.resolve()},Ac.prototype.Hc=function(t,e){return Au(0<this.targetCount,"Removing a target from an empty cache"),Au(this.Mc.has(e.target),"Removing a non-existent target from the cache"),this.Mc.delete(e.target),this.Gc.Rs(e.targetId),this.targetCount-=1,ju.resolve()},Ac.prototype.ds=function(t,e,n){var r=this,i=0,o=[];return this.Mc.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.Mc.delete(s),o.push(r.Jc(t,a.targetId)),i++)})),ju.Vu(o).next((function(){return i}))},Ac.prototype.Yc=function(t){return ju.resolve(this.targetCount)},Ac.prototype.Qo=function(t,e){var n=this.Mc.get(e)||null;return ju.resolve(n)},Ac.prototype.be=function(t,e){return Nu("Not yet implemented.")},Ac.prototype.Co=function(t,e,n){this.Gc.Is(e,n);var r=this.persistence.Ks,i=[];return r&&e.forEach((function(e){i.push(r._s(t,e))})),ju.Vu(i)},Ac.prototype.Ao=function(t,e,n){this.Gc.Ds(e,n);var r=this.persistence.Ks,i=[];return r&&e.forEach((function(e){i.push(r.Ts(t,e))})),ju.Vu(i)},Ac.prototype.Jc=function(t,e){return this.Gc.Rs(e),ju.resolve()},Ac.prototype.Ho=function(t,e){var n=this.Gc.As(e);return ju.resolve(n)},Ac.prototype.Cs=function(t,e){return ju.resolve(this.Gc.Cs(e))},Ac),rc="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",ic=(Nc.prototype.shutdown=function(){return this.Zc=!1,Promise.resolve()},Object.defineProperty(Nc.prototype,"ss",{get:function(){return this.Zc},enumerable:!0,configurable:!0}),Nc.prototype.$o=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){return[2,[this.clientId]]}))}))},Nc.prototype.na=function(t){return t(!0)},Nc.prototype.ia=function(){},Nc.prototype.nh=function(t){},Nc.prototype.no=function(){return this.sc},Nc.prototype.Js=function(t){var e=this.Xc[t.i()];return e||(e=new Kh(this.sc,this.Ks),this.Xc[t.i()]=e),e},Nc.prototype.Zs=function(){return this.$s},Nc.prototype.Xs=function(){return this.uc},Nc.prototype.runTransaction=function(t,e,n){var r=this;Eu("MemoryPersistence","Starting transaction:",t);var i=new oc(this.$c.next());return this.Ks.ea(),n(i).next((function(t){return r.Ks.ra(i).next((function(){return t}))})).Ou().then((function(t){return i.rc(),t}))},Nc.prototype.ua=function(t,e){return ju.Uu((n=this.Xc,r=[],ei(n,(function(t,e){return r.push(e)})),r).map((function(n){return function(){return n.Cs(t,e)}})));var n,r},Nc),oc=(r(Tc,$h=Lh),Tc),sc=(Object.defineProperty(Ic.prototype,"ha",{get:function(){if(this.oa)return this.oa;throw Nu("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Ic.prototype.zs=function(t){this.sa=t},Ic.prototype._s=function(t,e){return this.ha.delete(e),ju.resolve()},Ic.prototype.Ts=function(t,e){return this.ha.add(e),ju.resolve()},Ic.prototype.Pc=function(t,e){return this.ha.add(e),ju.resolve()},Ic.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Zs();return r.Ho(t,e.targetId).next((function(t){t.forEach((function(t){return n.ha.add(t)}))})).next((function(){return r.Hc(t,e)}))},Ic.prototype.ea=function(){this.oa=new Set},Ic.prototype.ra=function(t){var e=this,n=this.persistence.Xs().wo();return ju.forEach(this.ha,(function(r){return e.ca(t,r).next((function(t){t||n.Us(r)}))})).next((function(){return e.oa=null,n.apply(t)}))},Ic.prototype.Oo=function(t,e){var n=this;return this.ca(t,e).next((function(t){t?n.ha.delete(e):n.ha.add(e)}))},Ic.prototype.ta=function(t){return 0},Ic.prototype.ca=function(t,e){var n=this;return ju.Uu([function(){return n.persistence.Zs().Cs(t,e)},function(){return n.persistence.ua(t,e)},function(){return ju.resolve(n.sa.Cs(e))}])},Ic),ac=(Ec.prototype.initialize=function(t,e,n,r,i,o){if(o.aa)throw new Fr(Vr.FAILED_PRECONDITION,rc);return this.clientId=r,Promise.resolve()},Ec.prototype.fa=function(){var t=!1;return{ss:t,start:function(){return t=!0},stop:function(){return t=!1}}},Ec.prototype.la=function(){return Au(!!this.clientId,"initialize() not called"),new ic(this.clientId,(function(t){return new sc(t)}))},Ec.prototype.da=function(){return new Oh},Ec.prototype.clearPersistence=function(){throw new Fr(Vr.FAILED_PRECONDITION,rc)},Ec),uc=(bc.prototype.reset=function(){this.ga=0},bc.prototype.ya=function(){this.ga=this.ma},bc.prototype._a=function(t){var e=this;this.cancel();var n=Math.floor(this.ga+this.Ia()),r=Math.max(0,Date.now()-this.pa),i=Math.max(0,n-r);0<this.ga&&Eu("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.ga+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.ba=this.fh.yu(this.Zr,i,(function(){return e.pa=Date.now(),t()})),this.ga*=this.wa,this.ga<this.va&&(this.ga=this.va),this.ga>this.ma&&(this.ga=this.ma)},bc.prototype.cancel=function(){null!==this.ba&&(this.ba.cancel(),this.ba=null)},bc.prototype.Ia=function(){return(Math.random()-.5)*this.ga},bc),hc=(wc.prototype.Aa=function(){return 1===this.state||2===this.state||4===this.state},wc.prototype.Ca=function(){return 2===this.state},wc.prototype.start=function(){3!==this.state?(Au(0===this.state,"Already started"),this.auth()):this.Pa()},wc.prototype.stop=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.Aa()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},wc.prototype.ka=function(){Au(!this.Aa(),"Can only inhibit backoff in a stopped state"),this.state=0,this.Sa.reset()},wc.prototype.Na=function(){var t=this;this.Ca()&&null===this.Ra&&(this.Ra=this.fh.yu(this.Ta,6e4,(function(){return t.Oa()})))},wc.prototype.Fa=function(t){this.Va(),this.stream.send(t)},wc.prototype.Oa=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){return this.Ca()?[2,this.close(0)]:[2]}))}))},wc.prototype.Va=function(){this.Ra&&(this.Ra.cancel(),this.Ra=null)},wc.prototype.close=function(t,e){return u(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return Au(this.Aa(),"Only started streams should be closed."),Au(3===t||Gs(e),"Can't provide an error when not in an error state."),this.Va(),this.Sa.cancel(),this.Da++,3!==t?this.Sa.reset():e&&e.code===Vr.RESOURCE_EXHAUSTED?(Iu(e.toString()),Iu("Using maximum backoff delay to prevent overloading the backend."),this.Sa.ya()):e&&e.code===Vr.UNAUTHENTICATED&&this.Ea.l(),null!==this.stream&&(this.Ua(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.xa(e)];case 1:return n.sent(),[2]}}))}))},wc.prototype.Ua=function(){},wc.prototype.auth=function(){var t=this;Au(0===this.state,"Must be in initial state to auth"),this.state=1;var e=this.ja(this.Da),n=this.Da;this.Ea.getToken().then((function(e){t.Da===n&&t.La(e)}),(function(n){e((function(){var e=new Fr(Vr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.qa(e)}))}))},wc.prototype.La=function(t){var e=this;Au(1===this.state,"Trying to start stream in a non-starting state");var n=this.ja(this.Da);this.stream=this.Ba(t),this.stream.Ma((function(){n((function(){return Au(1===e.state,"Expected stream to be in state Starting, but was "+e.state),e.state=2,e.listener.Ma()}))})),this.stream.xa((function(t){n((function(){return e.qa(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},wc.prototype.Pa=function(){var t=this;Au(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.Sa._a((function(){return u(t,void 0,void 0,(function(){return h(this,(function(t){return Au(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Au(this.Aa(),"PersistentStream should have started"),[2]}))}))}))},wc.prototype.qa=function(t){return Au(this.Aa(),"Can't handle server close on non-started stream"),Eu("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},wc.prototype.ja=function(t){var e=this;return function(n){e.fh.ou((function(){return e.Da===t?n():(Eu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},wc),cc=(r(gc,Xh=hc),gc.prototype.Ba=function(t){return this.connection.Qa("Listen",t)},gc.prototype.onMessage=function(t){this.Sa.reset();var e=this.serializer.Xe(t),n=this.serializer.Ze(t);return this.listener.Ga(e,n)},gc.prototype.watch=function(t){var e={};e.database=this.serializer.Ue,e.addTarget=this.serializer.Yn(t);var n=this.serializer._r(t);n&&(e.labels=n),this.Fa(e)},gc.prototype.Wa=function(t){var e={};e.database=this.serializer.Ue,e.removeTarget=t,this.Fa(e)},gc),fc=(r(mc,Qh=hc),Object.defineProperty(mc.prototype,"Ka",{get:function(){return this.za},enumerable:!0,configurable:!0}),mc.prototype.start=function(){this.za=!1,Qh.prototype.start.call(this)},mc.prototype.Ua=function(){this.za&&this.Ha([])},mc.prototype.Ba=function(t){return this.connection.Qa("Write",t)},mc.prototype.onMessage=function(t){if(Au(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.De(t.streamToken),this.za){this.Sa.reset();var e=this.serializer.cr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Ja(n,e)}return Au(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.za=!0,this.listener.Ya()},mc.prototype.Xa=function(){Au(this.Ca(),"Writing handshake requires an opened stream"),Au(!this.za,"Handshake already completed");var t={};t.database=this.serializer.Ue,this.Fa(t)},mc.prototype.Ha=function(t){var e=this;Au(this.Ca(),"Writing mutations requires an opened stream"),Au(this.za,"Handshake must be complete before writing mutations"),Au(0<this.lastStreamToken.P(),"Trying to write mutation without a token");var n={streamToken:this.serializer.Ee(this.lastStreamToken),writes:t.map((function(t){return e.serializer.tr(t)}))};this.Fa(n)},mc),lc=(yc.prototype.$a=function(t){return new fc(this.fh,this.connection,this.credentials,this.serializer,t)},yc.prototype.Za=function(t){return new cc(this.fh,this.connection,this.credentials,this.serializer,t)},yc.prototype.commit=function(t){var e=this,n={database:this.serializer.Ue,writes:t.map((function(t){return e.serializer.tr(t)}))};return this.tf("Commit",n).then((function(t){return e.serializer.cr(t.writeResults,t.commitTime)}))},yc.prototype.lookup=function(t){var e=this,n={database:this.serializer.Ue,documents:t.map((function(t){return e.serializer.ke(t)}))};return this.nf("BatchGetDocuments",n).then((function(n){var r=xa();n.forEach((function(t){var n=e.serializer.He(t);r=r.dt(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);Au(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},yc.prototype.tf=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.tf(t,e,r)})).catch((function(t){throw t.code===Vr.UNAUTHENTICATED&&n.credentials.l(),t}))},yc.prototype.nf=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.nf(t,e,r)})).catch((function(t){throw t.code===Vr.UNAUTHENTICATED&&n.credentials.l(),t}))},yc),pc=(vc.documentId=function(){return vc.ef},vc.prototype.isEqual=function(t){if(!(t instanceof vc))throw mi("isEqual","FieldPath",1,t);return this.if.isEqual(t.if)},vc.ef=new vc(qi.ot().it()),vc),dc=new RegExp("[~\\*/\\[\\]]");function vc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Fr(Vr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+bi(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(ai("FieldPath","string",n,t[n]),0===t[n].length)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.if=new qi(t)}function yc(t,e,n,r){this.fh=t,this.connection=e,this.credentials=n,this.serializer=r}function mc(t,e,n,r,i){var o=Qh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this;return o.serializer=r,o.za=!1,o.lastStreamToken=Ei.k,o}function gc(t,e,n,r,i){var o=Xh.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this;return o.serializer=r,o}function wc(t,e,n,r,i,o){this.fh=t,this.Ta=n,this.connection=r,this.Ea=i,this.listener=o,this.state=0,this.Da=0,this.Ra=null,this.stream=null,this.Sa=new uc(t,e)}function bc(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fh=t,this.Zr=e,this.va=n,this.wa=r,this.ma=i,this.ga=0,this.ba=null,this.pa=Date.now(),this.reset()}function Ec(){}function Ic(t){this.persistence=t,this.sa=null,this.oa=null}function Tc(t){var e=$h.call(this)||this;return e.Po=t,e}function Nc(t,e){var n=this;this.clientId=t,this.Xc={},this.$c=new Mu(0),this.Zc=!1,this.Zc=!0,this.Ks=e(this),this.$s=new nc(this),this.sc=new zh,this.uc=new tc(this.sc,(function(t){return n.Ks.ta(t)}))}function Ac(t){this.persistence=t,this.Mc=new Uu((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=Li.MIN,this.highestTargetId=0,this.Qc=0,this.Gc=new rh,this.targetCount=0,this.Wc=ec.qc()}function Sc(t,e){Au((1&(this.xc=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.jc(void 0!==e?e:this.xc)}function kc(t,e){this.sc=t,this.kc=e,this.docs=new Vi(Mi.W),this.size=0}function Dc(t){var e=Zh.call(this)||this;return e.Uc=t,e}var Rc,Cc,Oc,xc,Lc,Pc=(Xc.delete=function(){return ri("FieldValue.delete",arguments),_c.instance},Xc.serverTimestamp=function(){return ri("FieldValue.serverTimestamp",arguments),Uc.instance},Xc.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oi("FieldValue.arrayUnion",arguments,1),new qc(t)},Xc.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oi("FieldValue.arrayRemove",arguments,1),new Mc(t)},Xc.increment=function(t){return ai("FieldValue.increment","number",1,t),ii("FieldValue.increment",arguments,1),new Vc(t)},Xc.prototype.isEqual=function(t){return this===t},Xc),_c=(r(Qc,Lc=Pc),Qc.instance=new Qc,Qc),Uc=(r(Yc,xc=Pc),Yc.instance=new Yc,Yc),qc=(r(Jc,Oc=Pc),Jc),Mc=(r(Wc,Cc=Pc),Wc),Vc=(r(Kc,Rc=Pc),Kc),Fc=Xr(Pc,"Use FieldValue.<field>() instead."),jc=/^__.*__$/,Gc=(Hc.prototype.hf=function(t,e){var n=[];return null!==this.sn?n.push(new Ro(t,this.data,this.sn,e)):n.push(new Do(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Co(t,this.fieldTransforms)),n},Hc),Bc=(zc.prototype.hf=function(t,e){var n=[new Ro(t,this.data,this.sn,e)];return 0<this.fieldTransforms.length&&n.push(new Co(t,this.fieldTransforms)),n},zc);function zc(t,e,n){this.data=t,this.sn=e,this.fieldTransforms=n}function Hc(t,e,n){this.data=t,this.sn=e,this.fieldTransforms=n}function Kc(t){var e=Rc.call(this,"FieldValue.increment")||this;return e.sf=t,e}function Wc(t){var e=Cc.call(this,"FieldValue.arrayRemove")||this;return e.uf=t,e}function Jc(t){var e=Oc.call(this,"FieldValue.arrayUnion")||this;return e.uf=t,e}function Yc(){return xc.call(this,"FieldValue.serverTimestamp")||this}function Qc(){return Lc.call(this,"FieldValue.delete")||this}function Xc(t){this.rf=t}function $c(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Nu("Unexpected case for UserDataSource: "+t)}}var Zc=(rf.prototype.lf=function(t){var e=null==this.path?null:this.path.child(t),n=new rf(this.cf,this.methodName,e,!1,this.fieldTransforms,this.sn);return n.df(t),n},rf.prototype.vf=function(t){var e=null==this.path?null:this.path.child(t),n=new rf(this.cf,this.methodName,e,!1,this.fieldTransforms,this.sn);return n.ff(),n},rf.prototype.wf=function(t){return new rf(this.cf,this.methodName,null,!0,this.fieldTransforms,this.sn)},rf.prototype.mf=function(t){var e=null===this.path||this.path.Y()?"":" (found in field "+this.path.toString()+")";return new Fr(Vr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},rf.prototype.contains=function(t){return void 0!==this.sn.find((function(e){return t.Z(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.Z(e.field)}))},rf.prototype.ff=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.df(this.path.get(t))},rf.prototype.df=function(t){if(0===t.length)throw this.mf("Document fields must not be empty");if($c(this.cf)&&jc.test(t))throw this.mf('Document fields cannot begin and end with "__"')},rf),tf=function(t,e){this.Dn=t,this.key=e},ef=(nf.prototype.bf=function(t,e){var n=new Zc(0,t,qi.rt);sf("Data must be an object, but it was:",n,e);var r=this.pf(e,n);return new Gc(r,null,n.fieldTransforms)},nf.prototype.yf=function(t,e,n){var r=new Zc(2,t,qi.rt);sf("Data must be an object, but it was:",r,e);var i,o,s=this.pf(e,r);if(n){for(var a=new eo(qi.W),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof pc)f=c.if;else{if("string"!=typeof c)throw Nu("Expected stringOrFieldPath to be a string or a FieldPath");f=uf(t,c)}if(!r.contains(f))throw new Fr(Vr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=No.Yt(a),o=r.fieldTransforms.filter((function(t){return i.$t(t.field)}))}else i=No.Xt(r.sn),o=r.fieldTransforms;return new Gc(s,i,o)},nf.prototype._f=function(t,e){var n=this,r=new Zc(1,t,qi.rt);sf("Data must be an object, but it was:",r,e);var i=new eo(qi.W),o=bs.wn();ei(e,(function(e,s){var a=uf(t,e),u=r.vf(a);if((s=n.If(s,u))instanceof _c)i=i.add(a);else{var h=n.pf(s,u);null!=h&&(i=i.add(a),o.set(a,h))}}));var s=No.Yt(i);return new Bc(o.an(),s,r.fieldTransforms)},nf.prototype.Tf=function(t,e,n,r){var i=new Zc(1,t,qi.rt),o=[af(t,e)],s=[n];if(r.length%2!=0)throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(af(t,r[a])),s.push(r[a+1]);var u=new eo(qi.W),h=bs.wn();for(a=0;a<o.length;++a){var c=o[a],f=i.vf(c),l=this.If(s[a],f);if(l instanceof _c)u=u.add(c);else{var p=this.pf(l,f);null!=p&&(u=u.add(c),h.set(c,p))}}var d=No.Yt(u);return new Bc(h.an(),d,i.fieldTransforms)},nf.prototype.Ef=function(t,e,n){void 0===n&&(n=!1);var r=new Zc(n?4:3,t,qi.rt),i=this.pf(e,r);return Au(null!=i,"Parsed data should not be null."),Au(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},nf.prototype.If=function(t,e){try{return this.gf(t)}catch(t){var n=hf(t);throw e.mf(n)}},nf.prototype.pf=function(t,e){if(of(t=this.If(t,e)))return sf("Unsupported field value:",e,t),this.Df(t,e);if(t instanceof Pc)return this.Rf(t,e),null;if(e.path&&e.sn.push(e.path),t instanceof Array){if(e.af&&4!==e.cf)throw e.mf("Nested arrays are not supported");return this.Sf(t,e)}return this.Af(t,e)},nf.prototype.Df=function(t,e){var n=this,r=new Vi(Du);return ni(t)?e.path&&0<e.path.length&&e.sn.push(e.path):ei(t,(function(t,i){var o=n.pf(i,e.lf(t));null!=o&&(r=r.dt(t,o))})),new bs(r)},nf.prototype.Sf=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.pf(s,e.wf(r));null==a&&(a=_o.yn),n.push(a),r++}return new Is(n)},nf.prototype.Rf=function(t,e){if(!$c(e.cf))throw e.mf(t.rf+"() can only be used with update() and set()");if(null===e.path)throw e.mf(t.rf+"() is not currently supported inside arrays");if(t instanceof _c){if(2!==e.cf)throw 1===e.cf?(Au(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.mf("FieldValue.delete() can only appear at the top level of your update data")):e.mf("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.sn.push(e.path)}else if(t instanceof Uc)e.fieldTransforms.push(new Ao(e.path,ro.instance));else if(t instanceof qc){var n=this.Cf(t.rf,t.uf),r=new io(n);e.fieldTransforms.push(new Ao(e.path,r))}else if(t instanceof Mc){n=this.Cf(t.rf,t.uf);var i=new oo(n);e.fieldTransforms.push(new Ao(e.path,i))}else if(t instanceof Vc){var o=this.Ef("FieldValue.increment",t.sf),s=new so(o);e.fieldTransforms.push(new Ao(e.path,s))}else Nu("Unknown FieldValue type: "+t)},nf.prototype.Af=function(t,e){if(null===t)return _o.yn;if("number"==typeof t)return zs(t)?new ls(t):new ps(t);if("boolean"==typeof t)return Uo.of(t);if("string"==typeof t)return new ds(t);if(t instanceof Date)return new vs(xi.fromDate(t));if(t instanceof xi)return new vs(new xi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Oi)return new ws(t);if(t instanceof Ri)return new ms(t);if(t instanceof tf)return new gs(t.Dn,t.key);throw e.mf("Unsupported field value: "+di(t))},nf.prototype.Cf=function(t,e){var n=this;return e.map((function(e,r){var i=new Zc(3,t,qi.rt);return n.pf(e,i.wf(r))}))},nf);function nf(t){this.gf=t}function rf(t,e,n,r,i,o){this.cf=t,this.methodName=e,this.path=n,this.af=r,void 0===i&&this.ff(),this.af=void 0!==r&&r,this.fieldTransforms=i||[],this.sn=o||[]}function of(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof xi||t instanceof Oi||t instanceof Ri||t instanceof tf||t instanceof Pc)}function sf(t,e,n){if(!of(n)||!pi(n)){var r=di(n);throw"an object"===r?e.mf(t+" a custom object"):e.mf(t+" "+r)}}function af(t,e){if(e instanceof pc)return e.if;if("string"==typeof e)return uf(t,e);throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function uf(t,e){try{return function(t){if(0<=t.search(dc))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(pc.bind.apply(pc,c([void 0],t.split("."))))}catch(e){throw new Fr(Vr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).if}catch(e){var n=hf(e);throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function hf(t){return t instanceof Error?t.message:t.toString()}function cf(t){this.key=t}function ff(t){this.key=t}var lf=(wf.prototype.lookup=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return h(this,(function(r){switch(r.label){case 0:if(this.Vf(),0<this.mutations.length)throw new Fr(Vr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.Pf.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof As||t instanceof Ns?n.Uf(t):Nu("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},wf.prototype.set=function(t,e){this.write(e.hf(t,this.en(t))),this.Ff.add(t)},wf.prototype.update=function(t,e){try{this.write(e.hf(t,this.xf(t)))}catch(t){this.Of=t}this.Ff.add(t)},wf.prototype.delete=function(t){this.write([new Oo(t,this.en(t))]),this.Ff.add(t)},wf.prototype.commit=function(){return u(this,void 0,void 0,(function(){var t,e=this;return h(this,(function(n){switch(n.label){case 0:if(this.Vf(),this.Of)throw this.Of;return t=this.kf,this.mutations.forEach((function(e){t=t.remove(e.key)})),t.forEach((function(t,n){e.mutations.push(new xo(t,e.en(t)))})),[4,this.Pf.commit(this.mutations)];case 1:return n.sent(),this.Nf=!0,[2]}}))}))},wf.prototype.Uf=function(t){var e;if(t instanceof Ns)e=t.version;else{if(!(t instanceof As))throw Nu("Document in a transaction was a "+t.constructor.name);e=Li.q()}var n=this.kf.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Fr(Vr.ABORTED,"Document version changed between two reads.")}else this.kf=this.kf.dt(t.key,e)},wf.prototype.en=function(t){var e=this.kf.get(t);return!this.Ff.has(t)&&e?So.updateTime(e):So.NONE},wf.prototype.xf=function(t){var e=this.kf.get(t);if(this.Ff.has(t)||!e)return So.exists(!0);if(e.isEqual(Li.q()))throw new Fr(Vr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return So.updateTime(e)},wf.prototype.write=function(t){this.Vf(),this.mutations=this.mutations.concat(t)},wf.prototype.Vf=function(){Au(!this.Nf,"A transaction object cannot be used after its update callback has been invoked.")},wf),pf=(gf.prototype.Bf=function(){var t=this;0===this.jf&&(this.Mf("Unknown"),Au(null===this.Lf,"onlineStateTimer shouldn't be started yet"),this.Lf=this.$r.yu("online_state_timeout",1e4,(function(){return t.Lf=null,Au("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.Qf("Backend didn't respond within 10 seconds."),t.Mf("Offline"),Promise.resolve()})))},gf.prototype.Gf=function(t){"Online"===this.state?(this.Mf("Unknown"),Au(0===this.jf,"watchStreamFailures must be 0"),Au(null===this.Lf,"onlineStateTimer must be null")):(this.jf++,1<=this.jf&&(this.Wf(),this.Qf("Connection failed 1 times. Most recent error: "+t.toString()),this.Mf("Offline")))},gf.prototype.set=function(t){this.Wf(),this.jf=0,"Online"===t&&(this.qf=!1),this.Mf(t)},gf.prototype.Mf=function(t){t!==this.state&&(this.state=t,this.vh(t))},gf.prototype.Qf=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.qf?(Iu(e),this.qf=!1):Eu("OnlineStateTracker",e)},gf.prototype.Wf=function(){null!==this.Lf&&(this.Lf.cancel(),this.Lf=null)},gf),df=(mf.prototype.start=function(){return this.enableNetwork()},mf.prototype.enableNetwork=function(){return u(this,void 0,void 0,(function(){var t;return h(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.$f()?(t=this.ul,[4,this.zf.Eo()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.cl()?this.al():this.tl.set("Unknown"),[4,this.fl()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},mf.prototype.disableNetwork=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.ll()];case 1:return t.sent(),this.tl.set("Offline"),[2]}}))}))},mf.prototype.ll=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.ul.stop()];case 1:return t.sent(),[4,this.nl.stop()];case 2:return t.sent(),0<this.Kf.length&&(Eu("RemoteStore","Stopping write stream with "+this.Kf.length+" pending writes"),this.Kf=[]),this.dl(),[2]}}))}))},mf.prototype.shutdown=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return Eu("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.ll()];case 1:return t.sent(),this.Yf.shutdown(),this.tl.set("Unknown"),[2]}}))}))},mf.prototype.listen=function(t){$r(this.Hf,t.targetId)||(this.Hf[t.targetId]=t,this.cl()?this.al():this.nl.Ca()&&this.vl(t))},mf.prototype.wl=function(t){Au($r(this.Hf,t),"unlisten called on target no currently watched: "+t),delete this.Hf[t],this.nl.Ca()&&this.ml(t),ni(this.Hf)&&(this.nl.Ca()?this.nl.Na():this.$f()&&this.tl.set("Unknown"))},mf.prototype.be=function(t){return this.Hf[t]||null},mf.prototype.ge=function(t){return this.dh.ge(t)},mf.prototype.vl=function(t){this.Jf.Ji(t.targetId),this.nl.watch(t)},mf.prototype.ml=function(t){this.Jf.Ji(t),this.nl.Wa(t)},mf.prototype.al=function(){Au(this.cl(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Jf=new Xa(this),this.nl.start(),this.tl.Bf()},mf.prototype.cl=function(){return this.$f()&&!this.nl.Aa()&&!ni(this.Hf)},mf.prototype.$f=function(){return this.isPrimary&&this.networkEnabled},mf.prototype.dl=function(){this.Jf=null},mf.prototype.il=function(){return u(this,void 0,void 0,(function(){var t=this;return h(this,(function(e){return ti(this.Hf,(function(e,n){t.vl(n)})),[2]}))}))},mf.prototype.el=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){return void 0===t&&Au(!this.cl(),"Watch stream was stopped gracefully while still needed."),this.dl(),this.cl()?(this.tl.Gf(t),this.al()):this.tl.set("Unknown"),[2]}))}))},mf.prototype.rl=function(t,e){return u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return this.tl.set("Online"),t instanceof za&&2===t.state&&t.cause?[2,this.gl(t)]:(t instanceof Ga?this.Jf.ee(t):t instanceof Ba?this.Jf.fe(t):(Au(t instanceof za,"Expected watchChange to be an instance of WatchTargetChange"),this.Jf.se(t)),e.isEqual(Li.MIN)?[3,3]:[4,this.zf.Ro()]);case 1:return n=r.sent(),0<=e.B(n)?[4,this.bl(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},mf.prototype.bl=function(t){var e=this;Au(!t.isEqual(Li.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.Jf.ve(t);return ti(n.Ei,(function(n,r){if(0<r.resumeToken.P()){var i=e.Hf[n];i&&(e.Hf[n]=i.li(r.resumeToken,t))}})),n.Di.forEach((function(t){var n=e.Hf[t];if(n){e.Hf[t]=n.li(Ei.k,n.ai),e.ml(t);var r=new pa(n.target,t,1,n.sequenceNumber);e.vl(r)}})),this.dh.So(n)},mf.prototype.gl=function(t){var e=this;Au(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return u(e,void 0,void 0,(function(){return h(this,(function(e){return $r(this.Hf,t)?(delete this.Hf[t],this.Jf.removeTarget(t),[2,this.dh.pl(t,n)]):[2]}))}))}))})),r},mf.prototype.fl=function(){return u(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:return this.yl()?(t=0<this.Kf.length?this.Kf[this.Kf.length-1].batchId:-1,[4,this.zf.jo(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.Kf.length&&this.ul.Na(),[3,4]);case 2:return this._l(e),[4,this.fl()];case 3:n.sent(),n.label=4;case 4:return this.Il()&&this.Tl(),[2]}}))}))},mf.prototype.yl=function(){return this.$f()&&this.Kf.length<10},mf.prototype.El=function(){return this.Kf.length},mf.prototype._l=function(t){Au(this.yl(),"addToWritePipeline called when pipeline is full"),this.Kf.push(t),this.ul.Ca()&&this.ul.Ka&&this.ul.Ha(t.mutations)},mf.prototype.Il=function(){return this.$f()&&!this.ul.Aa()&&0<this.Kf.length},mf.prototype.Tl=function(){Au(this.Il(),"startWriteStream() called when shouldStartWriteStream() is false."),this.ul.start()},mf.prototype.sl=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){return this.ul.Xa(),[2]}))}))},mf.prototype.hl=function(){var t=this;return this.zf.Do(this.ul.lastStreamToken).then((function(){for(var e=0,n=t.Kf;e<n.length;e++){var r=n[e];t.ul.Ha(r.mutations)}})).catch(vh)},mf.prototype.Ja=function(t,e){var n=this;Au(0<this.Kf.length,"Got result for empty write pipeline");var r=this.Kf.shift(),i=_u.from(r,t,e,this.ul.lastStreamToken);return this.dh.Dl(i).then((function(){return n.fl()}))},mf.prototype.ol=function(t){return u(this,void 0,void 0,(function(){var e=this;return h(this,(function(n){return void 0===t&&Au(!this.Il(),"Write stream was stopped gracefully while still needed."),t&&0<this.Kf.length?[2,(this.ul.Ka?this.Rl(t):this.Sl(t)).then((function(){e.Il()&&e.Tl()}))]:[2]}))}))},mf.prototype.Sl=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){return Ra(t.code)?(Eu("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.ul.lastStreamToken),this.ul.lastStreamToken=Ei.k,[2,this.zf.Do(Ei.k).catch(vh)]):[2]}))}))},mf.prototype.Rl=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return h(this,(function(r){return Ra(i=t.code)&&i!==Vr.ABORTED?(e=this.Kf.shift(),this.ul.ka(),[2,this.dh.Al(e.batchId,t).then((function(){return n.fl()}))]):[2];var i}))}))},mf.prototype.Cl=function(){return new lf(this.Pf)},mf.prototype.Zf=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.ll()];case 1:return t.sent(),this.tl.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},mf.prototype.Pl=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.$f()?(Eu("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Zf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},mf.prototype.kl=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.ll()];case 3:e.sent(),this.tl.set("Unknown"),e.label=4;case 4:return[2]}}))}))},mf),vf=(Object.defineProperty(yf.prototype,"Ul",{get:function(){return this.Nl},enumerable:!0,configurable:!0}),yf.prototype.xl=function(t,e){var n=this,r=e?e.jl:new Ka,i=e?e.Vl:this.Vl,o=e?e.yi:this.yi,s=i,a=!1,u=this.query.ii()&&i.size===this.query.limit?i.last():null,h=this.query.ei()&&i.size===this.query.limit?i.first():null;if(t.bt((function(t,e){var c=i.get(t),f=e instanceof Ns?e:null;f&&(Au(t.isEqual(f.key),"Mismatching keys found in document changes: "+t+" != "+f.key),f=n.query.matches(f)?f:null);var l=!!c&&n.yi.has(c.key),p=!!f&&(f.rn||n.yi.has(f.key)&&f.hasCommittedMutations),d=!1;c&&f?c.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Ll(c,f)||(r.track({type:2,doc:f}),d=!0,(u&&0<n.query.Xn(f,u)||h&&n.query.Xn(f,h)<0)&&(a=!0)):!c&&f?(r.track({type:0,doc:f}),d=!0):c&&!f&&(r.track({type:1,doc:c}),d=!0,(u||h)&&(a=!0)),d&&(o=f?(s=s.add(f),p?o.add(t):o.delete(t)):(s=s.delete(t),o.delete(t)))})),this.query.ii()||this.query.ei())for(;s.size>this.query.limit;){var c=this.query.ii()?s.last():s.first();s=s.delete(c.key),o=o.delete(c.key),r.track({type:1,doc:c})}return Au(!a||!e,"View was refilled using docs that themselves needed refilling."),{Vl:s,jl:r,yc:a,yi:o}},yf.prototype.Ll=function(t,e){return t.rn&&e.hasCommittedMutations&&!e.rn},yf.prototype.qs=function(t,e,n){var r=this;Au(!t.yc,"Cannot apply changes that need a refill");var i=this.Vl;this.Vl=t.Vl,this.yi=t.yi;var o=t.jl.bi();o.sort((function(t,e){return i=t.type,o=e.type,n(i)-n(o)||r.query.Xn(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nu("Unknown ChangeType: "+t)}}var i,o})),this.ql(n);var s=e?this.Bl():[],a=0===this.Fl.size&&this.Pi?1:0,u=a!==this.Ol;return this.Ol=a,0!==o.length||u?{snapshot:new Wa(this.query,t.Vl,i,o,t.yi,0==a,u,!1),Ml:s}:{Ml:s}},yf.prototype.Ql=function(t){return this.Pi&&"Offline"===t?(this.Pi=!1,this.qs({Vl:this.Vl,jl:new Ka,yi:this.yi,yc:!1},!1)):{Ml:[]}},yf.prototype.Gl=function(t){return!this.Nl.has(t)&&!!this.Vl.has(t)&&!this.Vl.get(t).rn},yf.prototype.ql=function(t){var e=this;t&&(t.ki.forEach((function(t){return e.Nl=e.Nl.add(t)})),t.Ni.forEach((function(t){return Au(e.Nl.has(t),"Modified document "+t+" not found in view.")})),t.Oi.forEach((function(t){return e.Nl=e.Nl.delete(t)})),this.Pi=t.Pi)},yf.prototype.Bl=function(){var t=this;if(!this.Pi)return[];var e=this.Fl;this.Fl=Va(),this.Vl.forEach((function(e){t.Gl(e.key)&&(t.Fl=t.Fl.add(e.key))}));var n=[];return e.forEach((function(e){t.Fl.has(e)||n.push(new ff(e))})),this.Fl.forEach((function(t){e.has(t)||n.push(new cf(t))})),n},yf.prototype.Wl=function(t){this.Nl=t.Yo,this.Fl=Va();var e=this.xl(t.documents);return this.qs(e,!0)},yf.prototype.zl=function(){return Wa.Ti(this.query,this.Vl,this.yi,0===this.Ol)},yf);function yf(t,e){this.query=t,this.Nl=e,this.Ol=null,this.Pi=!1,this.Fl=Va(),this.yi=Va(),this.Vl=new Ha(t.Xn.bind(t))}function mf(t,e,n,r,i){var o=this;this.zf=t,this.Pf=e,this.Kf=[],this.Hf={},this.Jf=null,this.networkEnabled=!1,this.isPrimary=!1,this.Yf=i,this.Yf.Xf((function(t){n.ou((function(){return u(o,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.$f()?(Eu("RemoteStore","Restarting streams for network reachability change."),[4,this.Zf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.tl=new pf(n,r),this.nl=this.Pf.Za({Ma:this.il.bind(this),xa:this.el.bind(this),Ga:this.rl.bind(this)}),this.ul=this.Pf.$a({Ma:this.sl.bind(this),xa:this.ol.bind(this),Ya:this.hl.bind(this),Ja:this.Ja.bind(this)})}function gf(t,e){this.$r=t,this.vh=e,this.state="Unknown",this.jf=0,this.Lf=null,this.qf=!0}function wf(t){this.Pf=t,this.kf=qa(),this.mutations=[],this.Nf=!1,this.Of=null,this.Ff=new Set}function bf(t,e,n){this.query=t,this.targetId=e,this.view=n}function Ef(t){this.key=t,this.Zl=!1}function If(){this.Nd=null,this.targetId=0,this.listeners=[]}var Tf=(Pf.prototype.run=function(){this.Jl()},Pf.prototype.Jl=function(){var t=this;this.Sa._a((function(){return u(t,void 0,void 0,(function(){var t,e,n=this;return h(this,(function(r){return t=this.Kl.Cl(),(e=this.Yl(t))&&e.then((function(e){n.$r.ou((function(){return t.commit().then((function(){n.iu.resolve(e)})).catch((function(t){n.Xl(t)}))}))})).catch((function(t){n.Xl(t)})),[2]}))}))}))},Pf.prototype.Yl=function(t){try{var e=this.updateFunction(t);return!Gs(e)&&e.catch&&e.then?e:(this.iu.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.iu.reject(t),null}},Pf.prototype.Xl=function(t){var e=this;0<this.Hl&&this.$l(t)?(this.Hl-=1,this.$r.ou((function(){return e.Jl(),Promise.resolve()}))):this.iu.reject(t)},Pf.prototype.$l=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ra(e)},Pf),Nf=(Object.defineProperty(Lf.prototype,"ld",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Lf.prototype.subscribe=function(t){Au(null!==t,"SyncEngine listener cannot be null"),Au(null===this.nd,"SyncEngine already has a subscriber."),this.nd=t},Lf.prototype.listen=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:return this.dd("listen()"),(r=this.ed.get(t))?(e=r.targetId,this.td.Vh(e),n=r.view.zl(),[3,4]):[3,1];case 1:return[4,this.zf.Mo(t.Yn())];case 2:return i=s.sent(),o=this.td.Vh(i.targetId),e=i.targetId,[4,this.vd(t,e,"current"===o)];case 3:n=s.sent(),this.isPrimary&&this.Kl.listen(i),s.label=4;case 4:return this.nd.Ga([n]),[2,e]}}))}))},Lf.prototype.vd=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,a,u;return h(this,(function(h){switch(h.label){case 0:return[4,this.zf.Ko(t,!0)];case 1:return r=h.sent(),i=new vf(t,r.Yo),o=i.xl(r.documents),s=Ya.Ci(e,n&&"Offline"!==this.onlineState),Au(0===(a=i.qs(o,!0===this.isPrimary,s)).Ml.length,"View returned limbo docs before target ack from the server."),Au(!!a.snapshot,"applyChanges for new view should always return a snapshot"),u=new bf(t,e,i),this.ed.set(t,u),this.rd[e]||(this.rd[e]=[]),this.rd[e].push(t),[2,a.snapshot]}}))}))},Lf.prototype.wd=function(t){return u(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return[4,this.zf.Ko(t.query,!0)];case 1:return e=r.sent(),n=t.view.Wl(e),this.isPrimary&&this.md(t.targetId,n.Ml),[2,n]}}))}))},Lf.prototype.wl=function(t){return u(this,void 0,void 0,(function(){var e,n,r=this;return h(this,(function(i){switch(i.label){case 0:return this.dd("unlisten()"),Au(!!(e=this.ed.get(t)),"Trying to unlisten on query not found:"+t),1<(n=this.rd[e.targetId]).length?(this.rd[e.targetId]=n.filter((function(e){return!e.isEqual(t)})),this.ed.delete(t),[2]):this.isPrimary?(this.td.xh(e.targetId),this.td.Ph(e.targetId)?[3,2]:[4,this.zf.zo(e.targetId,!1).then((function(){r.td.Lh(e.targetId),r.Kl.wl(e.targetId),r.gd(e.targetId)})).catch(vh)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.gd(e.targetId),[4,this.zf.zo(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},Lf.prototype.write=function(t,e){return u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return this.dd("write()"),[4,this.zf.ao(t)];case 1:return n=r.sent(),this.td.kh(n.batchId),this.bd(n.batchId,e),[4,this.pd(n.ks)];case 2:return r.sent(),[4,this.Kl.fl()];case 3:return r.sent(),[2]}}))}))},Lf.prototype.runTransaction=function(t,e,n){new Tf(t,this.Kl,e,n).run()},Lf.prototype.So=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return h(this,(function(r){switch(r.label){case 0:this.dd("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zf.So(t)];case 2:return e=r.sent(),ei(t.Ei,(function(t,e){var r=n.sd[Number(t)];r&&(Au(e.ki.size+e.Ni.size+e.Oi.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.ki.size?r.Zl=!0:0<e.Ni.size?Au(r.Zl,"Received change for limbo target document without add."):0<e.Oi.size&&(Au(r.Zl,"Received remove for limbo target document without add."),r.Zl=!1))})),[4,this.pd(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,vh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Lf.prototype.Ql=function(t,e){if(this.isPrimary&&0===e||!this.isPrimary&&1===e){this.dd("applyOnlineStateChange()");var n=[];this.ed.forEach((function(e,r){var i=r.view.Ql(t);Au(0===i.Ml.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.nd.yd(t),this.nd.Ga(n),this.onlineState=t,this.isPrimary&&this.td.Mh(t)}},Lf.prototype.pl=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,a=this;return h(this,(function(u){switch(u.label){case 0:return this.dd("rejectListens()"),this.td.qh(t,"rejected",e),n=this.sd[t],(r=n&&n.key)?(this.ud=this.ud.remove(r),delete this.sd[t],i=(i=new Vi(Mi.W)).dt(r,new As(r,Li.q())),o=Va().add(r),s=new Ja(Li.MIN,{},new eo(Du),i,o),[2,this.So(s)]):[3,1];case 1:return[4,this.zf.zo(t,!1).then((function(){return a.gd(t,e)})).catch(vh)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},Lf.prototype.Xh=function(t,e,n){return u(this,void 0,void 0,(function(){var r;return h(this,(function(i){switch(i.label){case 0:return this.dd("applyBatchState()"),[4,this.zf.lo(t)];case 1:return null===(r=i.sent())?(Eu("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.Kl.fl()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this._d(t,n||null),this.zf.Zo(t)):Nu("Unknown batchState: "+e),i.label=4;case 4:return[4,this.pd(r)];case 5:return i.sent(),[2]}}))}))},Lf.prototype.Dl=function(t){return u(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:this.dd("applySuccessfulWrite()"),e=t.batch.batchId,this._d(e,null),this.Id(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zf.vo(t)];case 2:return n=r.sent(),this.td.Oh(e,"acknowledged"),[4,this.pd(n)];case 3:return r.sent(),[3,6];case 4:return[4,vh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Lf.prototype.Al=function(t,e){return u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:this.dd("rejectFailedWrite()"),this._d(t,e),this.Id(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.zf.yo(t)];case 2:return n=r.sent(),this.td.Oh(t,"rejected",e),[4,this.pd(n)];case 3:return r.sent(),[3,6];case 4:return[4,vh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Lf.prototype.Td=function(t){return u(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return this.Kl.$f()||Eu("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.zf.To()];case 1:return-1===(e=r.sent())?t.resolve():((n=this.ad.get(e)||[]).push(t),this.ad.set(e,n)),[2]}}))}))},Lf.prototype.Id=function(t){(this.ad.get(t)||[]).forEach((function(t){t.resolve()})),this.ad.delete(t)},Lf.prototype.Ed=function(t){this.ad.forEach((function(e){e.forEach((function(e){e.reject(new Fr(Vr.CANCELLED,t))}))})),this.ad.clear()},Lf.prototype.bd=function(t,e){var n=this.hd[this.currentUser.i()];n=(n=n||new Vi(Du)).dt(t,e),this.hd[this.currentUser.i()]=n},Lf.prototype._d=function(t,e){var n=this.hd[this.currentUser.i()];if(n){var r=n.get(t);r&&(Au(t===n.wt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.hd[this.currentUser.i()]=n}},Lf.prototype.gd=function(t,e){var n=this;void 0===e&&(e=null),this.td.xh(t),Au(this.rd[t]&&0!==this.rd[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.rd[t];r<i.length;r++){var o=i[r];this.ed.delete(o),e&&this.nd.Dd(o,e)}if(delete this.rd[t],this.isPrimary){var s=this.od.As(t);this.od.Rs(t),s.forEach((function(t){n.od.Cs(t)||n.Rd(t)}))}},Lf.prototype.Rd=function(t){var e=this.ud.get(t);null!==e&&(this.Kl.wl(e),this.ud=this.ud.remove(t),delete this.sd[e])},Lf.prototype.md=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof cf?(this.od._s(i.key,t),this.Sd(i)):i instanceof ff?(Eu("SyncEngine","Document no longer in limbo: "+i.key),this.od.Ts(i.key,t),this.od.Cs(i.key)||this.Rd(i.key)):Nu("Unknown limbo change: "+JSON.stringify(i))}},Lf.prototype.Sd=function(t){var e=t.key;if(!this.ud.get(e)){Eu("SyncEngine","New document in limbo: "+e);var n=this.fd.next(),r=ta.jn(e.path);this.sd[n]=new Ef(e),this.Kl.listen(new pa(r.Yn(),n,2,Mu.Xr)),this.ud=this.ud.dt(e,n)}},Lf.prototype.Ad=function(){return this.ud},Lf.prototype.pd=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o=this;return h(this,(function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.ed.forEach((function(s,a){i.push(Promise.resolve().then((function(){var e=a.view.xl(t);return e.yc?o.zf.Ko(a.query,!1).then((function(t){var n=t.documents;return a.view.xl(n,e)})):e})).then((function(t){var i=e&&e.Ei[a.targetId],s=a.view.qs(t,!0===o.isPrimary,i);if(o.md(a.targetId,s.Ml),s.snapshot){o.isPrimary&&o.td.qh(a.targetId,s.snapshot.fromCache?"not-current":"current"),n.push(s.snapshot);var u=qu.zr(a.targetId,s.snapshot);r.push(u)}})))})),[4,Promise.all(i)];case 1:return s.sent(),this.nd.Ga(n),[4,this.zf.xo(r)];case 2:return s.sent(),[2]}}))}))},Lf.prototype.dd=function(t){Au(null!==this.nd,"Trying to call "+t+" before calling subscribe().")},Lf.prototype.Pl=function(t){return u(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.Ed("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.zf.ro(t)]):[3,3];case 1:return n=r.sent(),this.td.ro(t,n.ho,n.co),[4,this.pd(n.oo)];case 2:r.sent(),r.label=3;case 3:return[4,this.Kl.Pl()];case 4:return r.sent(),[2]}}))}))},Lf.prototype.kl=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s,a=this;return h(this,(function(u){switch(u.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Kl.kl(!0)]);case 1:return u.sent(),o=this.td.Ch(),[4,this.Cd(o.nt())];case 2:for(e=u.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Kl.listen(i);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),ti(this.rd,(function(t,e){a.td.jh(t)?o.push(t):s=s.then((function(){return a.gd(t),a.zf.zo(t,!0)})),a.Kl.wl(t)})),[4,s]);case 4:return u.sent(),[4,this.Cd(o)];case 5:return u.sent(),this.Pd(),[4,this.Kl.kl(!1)];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))},Lf.prototype.Pd=function(){var t=this;ti(this.sd,(function(e){t.Kl.wl(e)})),this.od.Ss(),this.sd=[],this.ud=new Vi(Mi.W)},Lf.prototype.Cd=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s,a,u,c,f,l,p,d;return h(this,(function(h){switch(h.label){case 0:e=[],n=[],r=0,i=t,h.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.rd[o])&&0!==a.length?[4,this.zf.zo(o,!0)]:[3,8]):[3,14];case 2:return h.sent(),[4,this.zf.Mo(a[0].Yn())];case 3:s=h.sent(),u=0,c=a,h.label=4;case 4:return u<c.length?(f=c[u],Au(!!(l=this.ed.get(f)),"No query view found for "+f),[4,this.wd(l)]):[3,7];case 5:(p=h.sent()).snapshot&&n.push(p.snapshot),h.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Au(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.zf.ih(o)];case 9:return Au(!!(d=h.sent()),"Target for id "+o+" not found"),[4,this.zf.Mo(d)];case 10:return s=h.sent(),[4,this.vd(this.kd(d),o,!1)];case 11:h.sent(),h.label=12;case 12:e.push(s),h.label=13;case 13:return r++,[3,1];case 14:return this.nd.Ga(n),[2,e]}}))}))},Lf.prototype.kd=function(t){return new ta(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Lf.prototype.$o=function(){return this.zf.$o()},Lf.prototype.$h=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:if(this.isPrimary)return Eu("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.rd[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.zf.eh()];case 2:return r=o.sent(),i=Ja.Ai(t,"current"===e),[4,this.pd(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.zf.zo(t,!0)];case 5:return o.sent(),this.gd(t,n),[3,7];case 6:Nu("Unexpected target state: "+e),o.label=7;case 7:return[2]}}))}))},Lf.prototype.Zh=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,f,l=this;return h(this,(function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(f=r[n],Au(!this.rd[f],"Trying to add an already active target"),[4,this.zf.ih(f)]):[3,6];case 2:return Au(!!(i=p.sent()),"Query data for active target "+f+" not found"),[4,this.zf.Mo(i)];case 3:return o=p.sent(),[4,this.vd(this.kd(i),o.targetId,!1)];case 4:p.sent(),this.Kl.listen(o),p.label=5;case 5:return n++,[3,1];case 6:s=function(t){return h(this,(function(e){switch(e.label){case 0:return a.rd[t]?[4,a.zf.zo(t,!1).then((function(){l.Kl.wl(t),l.gd(t)})).catch(vh)]:[2,"continue"];case 1:return e.sent(),[2]}}))},a=this,u=0,c=e,p.label=7;case 7:return u<c.length?(f=c[u],[5,s(f)]):[3,10];case 8:p.sent(),p.label=9;case 9:return u++,[3,7];case 10:return[2]}}))}))},Lf.prototype.enableNetwork=function(){return this.zf.nh(!0),this.Kl.enableNetwork()},Lf.prototype.disableNetwork=function(){return this.zf.nh(!1),this.Kl.disableNetwork()},Lf.prototype.ge=function(t){var e=this.sd[t];if(e&&e.Zl)return Va().add(e.key);var n=Va(),r=this.rd[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.ed.get(s);Au(!!a,"No query view found for "+s),n=n.Qt(a.view.Ul)}return n},Lf),Af=(xf.prototype.listen=function(t){var e=t.query,n=!1,r=this.Od.get(e);return r||(n=!0,r=new If,this.Od.set(e,r)),r.listeners.push(t),Au(!t.Ql(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.Nd&&t.Vd(r.Nd)&&this.Ud(),n?this.dh.listen(e).then((function(t){return r.targetId=t})):Promise.resolve(r.targetId)},xf.prototype.wl=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return h(this,(function(o){return e=t.query,n=!1,(r=this.Od.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.Od.delete(e),[2,this.dh.wl(e)]):[2]}))}))},xf.prototype.Ga=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Od.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].Vd(i)&&(e=!0);s.Nd=i}}e&&this.Ud()},xf.prototype.Dd=function(t,e){var n=this.Od.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.Od.delete(t)},xf.prototype.yd=function(t){this.onlineState=t;var e=!1;this.Od.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].Ql(t)&&(e=!0)})),e&&this.Ud()},xf.prototype.xd=function(t){this.Fd.add(t),t.next()},xf.prototype.jd=function(t){this.Fd.delete(t)},xf.prototype.Ud=function(){this.Fd.forEach((function(t){t.next()}))},xf),Sf=(Of.prototype.Vd=function(t){if(Au(0<t.docChanges.length||t._i,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Wa(t.query,t.docs,t.pi,e,t.yi,t.fromCache,t._i,!0)}var o=!1;return this.qd?this.Md(t)&&(this.Ld.next(t),o=!0):this.Qd(t,this.onlineState)&&(this.Gd(t),o=!0),this.Bd=t,o},Of.prototype.onError=function(t){this.Ld.error(t)},Of.prototype.Ql=function(t){this.onlineState=t;var e=!1;return this.Bd&&!this.qd&&this.Qd(this.Bd,t)&&(this.Gd(this.Bd),e=!0),e},Of.prototype.Qd=function(t,e){if(Au(!this.qd,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.Wd&&n?(Au(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.Y()||"Offline"===e},Of.prototype.Md=function(t){if(0<t.docChanges.length)return!0;var e=this.Bd&&this.Bd.hasPendingWrites!==t.hasPendingWrites;return!(!t._i&&!e)&&!0===this.options.includeMetadataChanges},Of.prototype.Gd=function(t){Au(!this.qd,"Trying to raise initial events for second time"),t=Wa.Ti(t.query,t.docs,t.yi,t.fromCache),this.qd=!0,this.Ld.next(t)},Of),kf=(Cf.prototype.start=function(t,e){var n=this;this.Kd();var r=new xu,i=new xu,o=!1;return this.credentials.v((function(s){o?n.$r.ou((function(){return n.Pl(s)})):(o=!0,n.Hd(t,e,s,i).then((function(){return n.Jd(s)})).then(r.resolve,r.reject))})),this.$r.ou((function(){return r.promise})),i.promise},Cf.prototype.enableNetwork=function(){var t=this;return this.Kd(),this.$r.enqueue((function(){return t.dh.enableNetwork()}))},Cf.prototype.Hd=function(t,e,n,r){return u(this,void 0,void 0,(function(){var i;return h(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t.initialize(this.$r,this.zd,this.platform,this.clientId,n,e)];case 1:return o.sent(),this.persistence=t.la(),this.Yd=t.fa(),this.td=t.da(),r.resolve(),[3,3];case 2:if(i=o.sent(),r.reject(i),!this.Xd(i))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),[2,this.Hd(new ac,{aa:!1},n,r)];case 3:return[2]}}))}))},Cf.prototype.Xd=function(t){return"FirebaseError"===t.name?t.code===Vr.FAILED_PRECONDITION||t.code===Vr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Cf.prototype.Kd=function(){if(this.$r.vu)throw new Fr(Vr.FAILED_PRECONDITION,"The client has already been terminated.")},Cf.prototype.Jd=function(t){var e=this;return Eu("FirestoreClient","Initializing. user=",t.uid),this.platform.$d(this.zd).then((function(n){return u(e,void 0,void 0,(function(){var e,r,i,o,s,a,c=this;return h(this,(function(f){switch(f.label){case 0:return e=new _h,this.zf=new sh(this.persistence,e,t),[4,this.zf.start()];case 1:return f.sent(),r=this.platform.Zd(),i=this.platform.tv(this.zd.Dn),o=new lc(this.$r,n,this.credentials,i),s=function(t){return c.dh.Ql(t,0)},a=function(t){return c.dh.Ql(t,1)},this.Kl=new df(this.zf,o,this.$r,s,r),this.dh=new Nf(this.zf,this.Kl,this.td,t),this.td.vh=a,this.Kl.dh=this.dh,this.td.dh=this.dh,this.nv=new Af(this.dh),[4,this.td.start()];case 2:return f.sent(),[4,this.Kl.start()];case 3:return f.sent(),[4,this.persistence.na((function(t){return u(c,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.dh.kl(t)];case 1:return e.sent(),t&&!this.Yd.ss?this.Yd.start(this.zf):t||this.Yd.stop(),[2]}}))}))}))];case 4:return f.sent(),[4,this.persistence.ia((function(){return u(c,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return f.sent(),[2]}}))}))}))},Cf.prototype.Pl=function(t){return this.$r.Iu(),Eu("FirestoreClient","Credential Changed. Current user: "+t.uid),this.dh.Pl(t)},Cf.prototype.disableNetwork=function(){var t=this;return this.Kd(),this.$r.enqueue((function(){return t.dh.disableNetwork()}))},Cf.prototype.terminate=function(){var t=this;return this.$r.pu((function(){return u(t,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.Yd.stop(),[4,this.Kl.shutdown()];case 1:return t.sent(),[4,this.td.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.m(),[2]}}))}))}))},Cf.prototype.waitForPendingWrites=function(){var t=this;this.Kd();var e=new xu;return this.$r.ou((function(){return t.dh.Td(e)})),e.promise},Cf.prototype.listen=function(t,e,n){var r=this;this.Kd();var i=new Sf(t,e,n);return this.$r.ou((function(){return r.nv.listen(i)})),i},Cf.prototype.wl=function(t){var e=this;this.iv||this.$r.ou((function(){return e.nv.wl(t)}))},Cf.prototype.ev=function(t){var e=this;return this.Kd(),this.$r.enqueue((function(){return e.zf.qo(t)})).then((function(t){if(t instanceof Ns)return t;if(t instanceof As)return null;throw new Fr(Vr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},Cf.prototype.rv=function(t){var e=this;return this.Kd(),this.$r.enqueue((function(){return u(e,void 0,void 0,(function(){var e,n,r;return h(this,(function(i){switch(i.label){case 0:return[4,this.zf.Ko(t,!0)];case 1:return e=i.sent(),n=new vf(t,e.Yo),r=n.xl(e.documents),[2,n.qs(r,!1).snapshot]}}))}))}))},Cf.prototype.write=function(t){var e=this;this.Kd();var n=new xu;return this.$r.ou((function(){return e.dh.write(t,n)})),n.promise},Cf.prototype.Dn=function(){return this.zd.Dn},Cf.prototype.xd=function(t){var e=this;this.Kd(),this.$r.ou((function(){return e.nv.xd(t),Promise.resolve()}))},Cf.prototype.jd=function(t){this.iv||this.nv.jd(t)},Object.defineProperty(Cf.prototype,"iv",{get:function(){return this.$r.vu},enumerable:!0,configurable:!0}),Cf.prototype.transaction=function(t){var e=this;this.Kd();var n=new xu;return this.$r.ou((function(){return e.dh.runTransaction(e.$r,t,n),Promise.resolve()})),n.promise},Cf),Df=(Rf.prototype.next=function(t){this.uv(this.observer.next,t)},Rf.prototype.error=function(t){this.uv(this.observer.error,t)},Rf.prototype.sv=function(){this.muted=!0},Rf.prototype.uv=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Rf);function Rf(t){this.observer=t,this.muted=!1}function Cf(t,e,n,r){this.platform=t,this.zd=e,this.credentials=n,this.$r=r,this.clientId=Su.Ur()}function Of(t,e,n){this.query=t,this.Ld=e,this.qd=!1,this.Bd=null,this.onlineState="Unknown",this.options=n||{}}function xf(t){this.dh=t,this.Od=new Uu((function(t){return t.canonicalId()})),this.onlineState="Unknown",this.Fd=new Set,this.dh.subscribe(this)}function Lf(t,e,n,r){this.zf=t,this.Kl=e,this.td=n,this.currentUser=r,this.nd=null,this.ed=new Uu((function(t){return t.canonicalId()})),this.rd={},this.ud=new Vi(Mi.W),this.sd={},this.od=new rh,this.hd={},this.ad=new Map,this.fd=ec.Bc(),this.isPrimary=void 0,this.onlineState="Unknown"}function Pf(t,e,n,r){this.$r=t,this.Kl=e,this.updateFunction=n,this.iu=r,this.Hl=5,this.Sa=new uc(this.$r,"retry_transaction")}function _f(t){return function(){if("object"!=typeof t||null===t)return!1;for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}()}var Uf,qf=th.Xu,Mf=(rl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},rl),Vf=(nl.prototype.settings=function(t){if(ii("Firestore.settings",arguments,1),ai("Firestore.settings","object",1,t),$r(t,"persistence"))throw new Fr(Vr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Mf(t);if(this.av&&!this.mv.isEqual(e))throw new Fr(Vr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.mv=e).credentials&&(this.vv=function(t){if(!t)return new jr;switch(t.type){case"gapi":var e=t.S;return Au(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new zr(e,t.D||"0");case"provider":return t.S;default:throw new Fr(Vr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},nl.prototype.enableNetwork=function(){return this.cv(),this.av.enableNetwork()},nl.prototype.disableNetwork=function(){return this.cv(),this.av.disableNetwork()},nl.prototype.enablePersistence=function(t){if(this.av)throw new Fr(Vr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Iu("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Zr(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.pv(this.wv,{aa:!0,cacheSizeBytes:this.mv.cacheSizeBytes,synchronizeTabs:e})},nl.prototype.clearPersistence=function(){return u(this,void 0,void 0,(function(){var t,e=this;return h(this,(function(n){if(void 0!==this.av&&!this.av.iv)throw new Fr(Vr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return t=new xu,this.hv.wu((function(){return u(e,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.yv(),[4,this.wv.clearPersistence(e)];case 1:return r.sent(),t.resolve(),[3,3];case 2:return n=r.sent(),t.reject(n),[3,3];case 3:return[2]}}))}))})),[2,t.promise]}))}))},nl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(nl.prototype,"_v",{get:function(){return this.cv(),this.av.iv},enumerable:!0,configurable:!0}),nl.prototype.waitForPendingWrites=function(){return this.cv(),this.av.waitForPendingWrites()},nl.prototype.onSnapshotsInSync=function(t){if(this.cv(),_f(t))return this.Iv(t);ai("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Iv(e)},nl.prototype.Iv=function(t){var e=this,n=new Df({next:function(){t.next&&t.next()},error:function(t){throw Nu("Uncaught Error in onSnapshotsInSync")}});return this.av.xd(n),function(){n.sv(),e.av.jd(n)}},nl.prototype.cv=function(){return this.av||this.pv(new ac,{aa:!1}),this.av},nl.prototype.yv=function(){return new Ou(this.fv,this.dv,this.mv.host,this.mv.ssl,this.mv.forceLongPolling)},nl.prototype.pv=function(t,e){Au(!!this.mv.host,"FirestoreSettings.host is not set"),Au(!this.av,"configureClient() called multiple times");var n=this.yv();return this.av=new kf(vu.C(),n,this.vv,this.hv),this.av.start(t,e)},nl.prototype.bv=function(t){return new ef((function(e){if(e instanceof Gf){var n=t,r=e.firestore.fv;if(!r.isEqual(n))throw new Fr(Vr.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new tf(t,e.Tv)}return e}))},nl.lv=function(t){var e=t.options;if(!$r(e,"projectId"))throw new Fr(Vr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Fr(Vr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Lu(n)},Object.defineProperty(nl.prototype,"app",{get:function(){if(!this.ov)throw new Fr(Vr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ov},enumerable:!0,configurable:!0}),nl.prototype.collection=function(t){return ii("Firestore.collection",arguments,1),ai("Firestore.collection","non-empty string",1,t),this.cv(),new ol(_i.et(t),this)},nl.prototype.doc=function(t){return ii("Firestore.doc",arguments,1),ai("Firestore.doc","non-empty string",1,t),this.cv(),Gf.Ev(_i.et(t),this)},nl.prototype.collectionGroup=function(t){if(ii("Firestore.collectionGroup",arguments,1),ai("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.cv(),new Kf(new ta(_i.rt,t),this)},nl.prototype.runTransaction=function(t){var e=this;return ii("Firestore.runTransaction",arguments,1),ai("Firestore.runTransaction","function",1,t),this.cv().transaction((function(n){return t(new Ff(e,n))}))},nl.prototype.batch=function(){return this.cv(),new jf(this)},Object.defineProperty(nl,"logLevel",{get:function(){switch(wu()){case 0:return"debug";case 1:return"error";case 2:return"silent";default:return Nu("Unknown log level: "+wu())}},enumerable:!0,configurable:!0}),nl.setLogLevel=function(t){switch(ii("Firestore.setLogLevel",arguments,1),ai("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":bu(0);break;case"error":bu(1);break;case"silent":bu(2);break;default:throw new Fr(Vr.INVALID_ARGUMENT,"Invalid log level: "+t)}},nl.prototype.Dv=function(){return this.mv.timestampsInSnapshots},nl),Ff=(el.prototype.get=function(t){var e=this;ii("Transaction.get",arguments,1);var n=cl("Transaction.get",t,this.Rv);return this.Sv.lookup([n.Tv]).then((function(t){if(!t||1!==t.length)return Nu("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof As)return new zf(e.Rv,n.Tv,null,!1,!1,n.Av);if(r instanceof Ns)return new zf(e.Rv,n.Tv,r,!1,!1,n.Av);throw Nu("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},el.prototype.set=function(t,e,n){si("Transaction.set",arguments,2,3);var r=cl("Transaction.set",t,this.Rv);n=al("Transaction.set",n);var i=fl(r.Av,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.Rv.gv.yf(s,o,n.mergeFields):this.Rv.gv.bf(s,o);return this.Sv.set(r.Tv,a),this},el.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof pc?(oi("Transaction.update",arguments,3),r=cl("Transaction.update",t,this.Rv),this.Rv.gv.Tf("Transaction.update",e,n,o)):(ii("Transaction.update",arguments,2),r=cl("Transaction.update",t,this.Rv),this.Rv.gv._f("Transaction.update",e)),this.Sv.update(r.Tv,i),this},el.prototype.delete=function(t){ii("Transaction.delete",arguments,1);var e=cl("Transaction.delete",t,this.Rv);return this.Sv.delete(e.Tv),this},el),jf=(tl.prototype.set=function(t,e,n){si("WriteBatch.set",arguments,2,3),this.kv();var r=cl("WriteBatch.set",t,this.Rv);n=al("WriteBatch.set",n);var i=fl(r.Av,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.Rv.gv.yf(s,o,n.mergeFields):this.Rv.gv.bf(s,o);return this.Cv=this.Cv.concat(a.hf(r.Tv,So.NONE)),this},tl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.kv(),i="string"==typeof e||e instanceof pc?(oi("WriteBatch.update",arguments,3),r=cl("WriteBatch.update",t,this.Rv),this.Rv.gv.Tf("WriteBatch.update",e,n,o)):(ii("WriteBatch.update",arguments,2),r=cl("WriteBatch.update",t,this.Rv),this.Rv.gv._f("WriteBatch.update",e)),this.Cv=this.Cv.concat(i.hf(r.Tv,So.exists(!0))),this},tl.prototype.delete=function(t){ii("WriteBatch.delete",arguments,1),this.kv();var e=cl("WriteBatch.delete",t,this.Rv);return this.Cv=this.Cv.concat(new Oo(e.Tv,So.NONE)),this},tl.prototype.commit=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){return this.kv(),this.Pv=!0,0<this.Cv.length?[2,this.Rv.cv().write(this.Cv)]:[2]}))}))},tl.prototype.kv=function(){if(this.Pv)throw new Fr(Vr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},tl),Gf=(Zf.Ev=function(t,e,n){if(t.length%2!=0)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.it()+" has "+t.length);return new Zf(new Mi(t),e,n)},Object.defineProperty(Zf.prototype,"id",{get:function(){return this.Tv.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(Zf.prototype,"parent",{get:function(){return new ol(this.Tv.path.J(),this.firestore,this.Av)},enumerable:!0,configurable:!0}),Object.defineProperty(Zf.prototype,"path",{get:function(){return this.Tv.path.it()},enumerable:!0,configurable:!0}),Zf.prototype.collection=function(t){if(ii("DocumentReference.collection",arguments,1),ai("DocumentReference.collection","non-empty string",1,t),!t)throw new Fr(Vr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=_i.et(t);return new ol(this.Tv.path.child(e),this.firestore)},Zf.prototype.isEqual=function(t){if(!(t instanceof Zf))throw mi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Tv.isEqual(t.Tv)&&this.Av===t.Av},Zf.prototype.set=function(t,e){si("DocumentReference.set",arguments,1,2),e=al("DocumentReference.set",e);var n=fl(this.Av,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.gv.yf(i,r,e.mergeFields):this.firestore.gv.bf(i,r);return this.av.write(o.hf(this.Tv,So.NONE))},Zf.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof pc?(oi("DocumentReference.update",arguments,2),this.firestore.gv.Tf("DocumentReference.update",t,e,r)):(ii("DocumentReference.update",arguments,1),this.firestore.gv._f("DocumentReference.update",t)),this.av.write(n.hf(this.Tv,So.exists(!0)))},Zf.prototype.delete=function(){return ii("DocumentReference.delete",arguments,0),this.av.write([new Oo(this.Tv,So.NONE)])},Zf.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];si("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||_f(t[i])||(yi("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ci("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=_f(t[i])?t[i]:(ai("DocumentReference.onSnapshot","function",i,t[i]),ui("DocumentReference.onSnapshot","function",i+1,t[i+1]),ui("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Nv(o,n)},Zf.prototype.Nv=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Df({next:function(t){if(e.next){Au(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n.Tv);e.next(new zf(n.firestore,n.Tv,r,t.fromCache,t.hasPendingWrites,n.Av))}},error:r}),o=this.av.listen(ta.jn(this.Tv.path),i,t);return function(){i.sv(),n.av.wl(o)}},Zf.prototype.get=function(t){var e=this;return si("DocumentReference.get",arguments,0,1),hl("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.cv().ev(e.Tv).then((function(t){n(new zf(e.firestore,e.Tv,t,!0,t instanceof Ns&&t.rn,e.Av))}),r):e.Ov(n,r,t)}))},Zf.prototype.Ov=function(t,e,n){var r=this.Nv({includeMetadataChanges:!0,Wd:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Fr(Vr.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Fr(Vr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},Zf.prototype.withConverter=function(t){return new Zf(this.Tv,this.firestore,t)},Zf),Bf=($f.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},$f),zf=(Xf.prototype.data=function(t){if(si("DocumentSnapshot.data",arguments,0,1),t=ul("DocumentSnapshot.data",t),this.Fv){if(this.Av){var e=new Hf(this.Rv,this.Tv,this.Fv,this.Vv,this.Uv);return this.Av.fromFirestore(e,t)}return this.xv(this.Fv.data(),Lo.gn(t,this.Rv.Dv()))}},Xf.prototype.get=function(t,e){if(si("DocumentSnapshot.get",arguments,1,2),e=ul("DocumentSnapshot.get",e),this.Fv){var n=this.Fv.data().field(af("DocumentSnapshot.get",t));if(null!==n)return this.jv(n,Lo.gn(e,this.Rv.Dv()))}},Object.defineProperty(Xf.prototype,"id",{get:function(){return this.Tv.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(Xf.prototype,"ref",{get:function(){return new Gf(this.Tv,this.Rv,this.Av)},enumerable:!0,configurable:!0}),Object.defineProperty(Xf.prototype,"exists",{get:function(){return null!==this.Fv},enumerable:!0,configurable:!0}),Object.defineProperty(Xf.prototype,"metadata",{get:function(){return new Bf(this.Uv,this.Vv)},enumerable:!0,configurable:!0}),Xf.prototype.isEqual=function(t){if(!(t instanceof Xf))throw mi("isEqual","DocumentSnapshot",1,t);return this.Rv===t.Rv&&this.Vv===t.Vv&&this.Tv.isEqual(t.Tv)&&(null===this.Fv?null===t.Fv:this.Fv.isEqual(t.Fv))&&this.Av===t.Av},Xf.prototype.xv=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.jv(i,e)})),r},Xf.prototype.jv=function(t,e){if(t instanceof bs)return this.xv(t,e);if(t instanceof Is)return this.Lv(t,e);if(t instanceof gs){var n=t.value(e),r=this.Rv.cv().Dn();return t.Dn.isEqual(r)||Iu("Document "+this.Tv.path+" contains a document reference within a different database ("+t.Dn.projectId+"/"+t.Dn.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Gf(n,this.Rv,this.Av)}return t.value(e)},Xf.prototype.Lv=function(t,e){var n=this;return t.Jt.map((function(t){return n.jv(t,e)}))},Xf),Hf=(r(Qf,Uf=zf),Qf.prototype.data=function(t){var e=Uf.prototype.data.call(this,t);return Au(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},Qf),Kf=(Yf.prototype.where=function(t,e,n){var r;ii("Query.where",arguments,3),vi("Query.where",3,n),function(t,e,n,r){if(!e.some((function(t){return t===r})))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid value "+di(r)+" provided to function Query.where() for its "+wi(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains","in","array-contains-any"],0,e);var i=af("Query.where",t),o=ea.et(e);if(i.st()){if(o===ea.ARRAY_CONTAINS||o===ea.ARRAY_CONTAINS_ANY)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ea.IN){this.Bv(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.Mv(h))}r=new Is(s)}else r=this.Mv(n)}else o!==ea.IN&&o!==ea.ARRAY_CONTAINS_ANY||this.Bv(n,o),r=this.firestore.gv.Ef("Query.where",n,o===ea.IN);var c=na.create(i,o,r);return this.Qv(c),new Yf(this.qv.Bn(c),this.firestore,this.Av)},Yf.prototype.orderBy=function(t,e){var n;if(si("Query.orderBy",arguments,1,2),ui("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=ua.ASCENDING;else{if("desc"!==e)throw new Fr(Vr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=ua.DESCENDING}if(null!==this.qv.startAt)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.qv.endAt)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=af("Query.orderBy",t),i=new ca(r,n);return this.Gv(i),new Yf(this.qv.Qn(i),this.firestore,this.Av)},Yf.prototype.limit=function(t){return ii("Query.limit",arguments,1),ai("Query.limit","number",1,t),gi("Query.limit",1,t),new Yf(this.qv.Gn(t),this.firestore,this.Av)},Yf.prototype.limitToLast=function(t){return ii("Query.limitToLast",arguments,1),ai("Query.limitToLast","number",1,t),gi("Query.limitToLast",1,t),new Yf(this.qv.Wn(t),this.firestore,this.Av)},Yf.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.startAt",arguments,1);var r=this.Wv("Query.startAt",t,e,!0);return new Yf(this.qv.zn(r),this.firestore,this.Av)},Yf.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.startAfter",arguments,1);var r=this.Wv("Query.startAfter",t,e,!1);return new Yf(this.qv.zn(r),this.firestore,this.Av)},Yf.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.endBefore",arguments,1);var r=this.Wv("Query.endBefore",t,e,!0);return new Yf(this.qv.Kn(r),this.firestore,this.Av)},Yf.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.endAt",arguments,1);var r=this.Wv("Query.endAt",t,e,!1);return new Yf(this.qv.Kn(r),this.firestore,this.Av)},Yf.prototype.isEqual=function(t){if(!(t instanceof Yf))throw mi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.qv.isEqual(t.qv)},Yf.prototype.withConverter=function(t){return new Yf(this.qv,this.firestore,t)},Yf.prototype.Wv=function(t,e,n,r){if(vi(t,1,e),e instanceof zf){if(0<n.length)throw new Fr(Vr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Fr(Vr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.zv(t,i.Fv,r)}var o=[e].concat(n);return this.Kv(t,o,r)},Yf.prototype.zv=function(t,e,n){for(var r=[],i=0,o=this.qv.orderBy;i<o.length;i++){var s=o[i];if(s.field.st())r.push(new gs(this.firestore.fv,e.key));else{var a=e.field(s.field);if(a instanceof ys)throw new Fr(Vr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.it();throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new ha(r,n)},Yf.prototype.Kv=function(t,e,n){var r=this.qv.On;if(e.length>r.length)throw new Fr(Vr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.st()){if("string"!=typeof s)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.qv.ui()&&-1!==s.indexOf("/"))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.qv.path.child(_i.et(s));if(!Mi.ct(a))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new Mi(a);i.push(new gs(this.firestore.fv,u))}else{var h=this.firestore.gv.Ef(t,s);i.push(h)}}return new ha(i,n)},Yf.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];si("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||_f(t[i])||(yi("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ci("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=_f(t[i])?t[i]:(ai("Query.onSnapshot","function",i,t[i]),ui("Query.onSnapshot","function",i+1,t[i+1]),ui("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Hv(this.qv),this.Nv(r,n)},Yf.prototype.Nv=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Df({next:function(t){e.next&&e.next(new Wf(n.firestore,n.qv,t,n.Av))},error:r}),o=this.firestore.cv(),s=o.listen(this.qv,i,t);return function(){i.sv(),o.wl(s)}},Yf.prototype.Hv=function(t){if(t.ei()&&0===t.On.length)throw new Fr(Vr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Yf.prototype.get=function(t){var e=this;return si("Query.get",arguments,0,1),hl("Query.get",t),this.Hv(this.qv),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.cv().rv(e.qv).then((function(t){n(new Wf(e.firestore,e.qv,t,e.Av))}),r):e.Ov(n,r,t)}))},Yf.prototype.Ov=function(t,e,n){var r=this.Nv({includeMetadataChanges:!0,Wd:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Fr(Vr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},Yf.prototype.Mv=function(t){if("string"==typeof t){if(""===t)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.qv.ui()&&-1!==t.indexOf("/"))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.qv.path.child(_i.et(t));if(!Mi.ct(e))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new gs(this.firestore.fv,new Mi(e))}if(t instanceof Gf){var n=t;return new gs(this.firestore.fv,n.Tv)}throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+di(t)+".")},Yf.prototype.Bv=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},Yf.prototype.Qv=function(t){if(t instanceof na){var e=[ea.ARRAY_CONTAINS,ea.ARRAY_CONTAINS_ANY],n=[ea.IN,ea.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.Mn()){var o=this.qv.Ln();if(null!==o&&!o.isEqual(t.field))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.qv.qn();null!==s&&this.Jv(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.qv.ri(n)),null===a&&r&&(a=this.qv.ri(e)),null!=a)throw a===t.op?new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},Yf.prototype.Gv=function(t){if(null===this.qv.qn()){var e=this.qv.Ln();null!==e&&this.Jv(e,t.field)}},Yf.prototype.Jv=function(t,e){if(!e.isEqual(t))throw new Fr(Vr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},Yf),Wf=(Object.defineProperty(Jf.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(Jf.prototype,"empty",{get:function(){return this.Xv.docs.Y()},enumerable:!0,configurable:!0}),Object.defineProperty(Jf.prototype,"size",{get:function(){return this.Xv.docs.size},enumerable:!0,configurable:!0}),Jf.prototype.forEach=function(t,e){var n=this;si("QuerySnapshot.forEach",arguments,1,2),ai("QuerySnapshot.forEach","function",1,t),this.Xv.docs.forEach((function(r){t.call(e,n.tw(r))}))},Object.defineProperty(Jf.prototype,"query",{get:function(){return new Kf(this.Yv,this.Rv,this.Av)},enumerable:!0,configurable:!0}),Jf.prototype.docChanges=function(t){t&&(yi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ci("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Xv.Ii)throw new Fr(Vr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.$v&&this.Zv===e||(this.$v=function(t,e,n,r){if(n.pi.Y()){var i,o=0;return n.docChanges.map((function(e){var s=new Hf(t,e.doc.key,e.doc,n.fromCache,n.yi.has(e.doc.key),r);return Au(0===e.type,"Invalid event type for first snapshot"),Au(!i||n.query.Xn(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:s,oldIndex:-1,newIndex:o++}}))}var s=n.pi;return n.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var i=new Hf(t,e.doc.key,e.doc,n.fromCache,n.yi.has(e.doc.key),r),o=-1,a=-1;return 0!==e.type&&(Au(0<=(o=s.indexOf(e.doc.key)),"Index for document not found"),s=s.delete(e.doc.key)),1!==e.type&&(a=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nu("Unknown change type: "+t)}}(e.type),doc:i,oldIndex:o,newIndex:a}}))}(this.Rv,e,this.Xv,this.Av),this.Zv=e),this.$v},Jf.prototype.isEqual=function(t){if(!(t instanceof Jf))throw mi("isEqual","QuerySnapshot",1,t);return this.Rv===t.Rv&&this.Yv.isEqual(t.Yv)&&this.Xv.isEqual(t.Xv)&&this.Av===t.Av},Jf.prototype.tw=function(t){return new Hf(this.Rv,t.key,t,this.metadata.fromCache,this.Xv.yi.has(t.key),this.Av)},Jf);function Jf(t,e,n,r){this.Rv=t,this.Yv=e,this.Xv=n,this.Av=r,this.$v=null,this.Zv=null,this.metadata=new Bf(n.hasPendingWrites,n.fromCache)}function Yf(t,e,n){this.qv=t,this.firestore=e,this.Av=n}function Qf(){return null!==Uf&&Uf.apply(this,arguments)||this}function Xf(t,e,n,r,i,o){this.Rv=t,this.Tv=e,this.Fv=n,this.Vv=r,this.Uv=i,this.Av=o}function $f(t,e){this.hasPendingWrites=t,this.fromCache=e}function Zf(t,e,n){this.Tv=t,this.firestore=e,this.Av=n,this.av=this.firestore.cv()}function tl(t){this.Rv=t,this.Cv=[],this.Pv=!1}function el(t,e){this.Rv=t,this.Sv=e}function nl(t,e,n){var r=this;if(void 0===n&&(n=new ac),this.ov=null,this.hv=new Fu,this.INTERNAL={delete:function(){return u(r,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.cv(),[4,this.av.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var i=t;this.ov=i,this.fv=nl.lv(i),this.dv=i.name,this.vv=new Gr(e)}else{var o=t;if(!o.projectId)throw new Fr(Vr.INVALID_ARGUMENT,"Must provide projectId");this.fv=new Lu(o.projectId,o.database),this.dv="[DEFAULT]",this.vv=new jr}this.wv=n,this.mv=new Mf({}),this.gv=this.bv(this.fv)}function rl(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Fr(Vr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else hi("settings","non-empty string","host",t.host),this.host=t.host,ci("settings","boolean","ssl",t.ssl),this.ssl=Zr(t.ssl,!0);if(yi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ci("settings","object","credentials",t.credentials),this.credentials=t.credentials,ci("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Iu("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Iu("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Zr(t.timestampsInSnapshots,!0),ci("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=th.Zu;else{if(t.cacheSizeBytes!==qf&&t.cacheSizeBytes<th.$u)throw new Fr(Vr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+th.$u);this.cacheSizeBytes=t.cacheSizeBytes}ci("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}c(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(Wf.prototype.docChanges,t,{get:function(){return function(){throw new Fr(Vr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var il,ol=(r(sl,il=Kf),Object.defineProperty(sl.prototype,"id",{get:function(){return this.qv.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(sl.prototype,"parent",{get:function(){var t=this.qv.path.J();return t.Y()?null:new Gf(new Mi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(sl.prototype,"path",{get:function(){return this.qv.path.it()},enumerable:!0,configurable:!0}),sl.prototype.doc=function(t){if(si("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Su.Ur()),ai("CollectionReference.doc","non-empty string",1,t),""===t)throw new Fr(Vr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=_i.et(t);return Gf.Ev(this.qv.path.child(e),this.firestore,this.Av)},sl.prototype.add=function(t){ii("CollectionReference.add",arguments,1),ai("CollectionReference.add","object",1,this.Av?this.Av.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},sl.prototype.withConverter=function(t){return new sl(this.nw,this.firestore,t)},sl);function sl(t,e,n){var r=il.call(this,ta.jn(t),e,n)||this;if((r.nw=t).length%2!=1)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.it()+" has "+t.length);return r}function al(t,e){if(void 0===e)return{merge:!1};if(yi(t,e,["merge","mergeFields"]),ci(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+di(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Fr(Vr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+o+" was: "+di(r[o]))}(t,"mergeFields",0,r,(function(t){return"string"==typeof t||t instanceof pc}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new Fr(Vr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ul(t,e){return void 0===e?{}:(yi(t,e,["serverTimestamps"]),fi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function hl(t,e){ui(t,"object",1,e),e&&(yi(t,e,["source"]),fi(t,0,"source",e.source,["default","server","cache"]))}function cl(t,e,n){if(e instanceof Gf){if(e.firestore!==n)throw new Fr(Vr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw mi(t,"DocumentReference",1,e)}function fl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var ll=Xr(Vf,"Use firebase.firestore() instead."),pl=Xr(Ff,"Use firebase.firestore().runTransaction() instead."),dl=Xr(jf,"Use firebase.firestore().batch() instead."),vl=Xr(Gf,"Use firebase.firestore().doc() instead."),yl=Xr(zf),ml=Xr(Hf),gl=Xr(Kf),wl=Xr(Wf),bl=Xr(ol,"Use firebase.firestore().collection() instead."),El=(Dl.ew=function(t,e,n){return Au(Dl.ph(),"IndexedDB not supported in current environment."),Eu("SimpleDb","Opening database:",t),new ju((function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new Dl(e))},o.onblocked=function(){i(new Fr(Vr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new Fr(Vr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){Eu("SimpleDb",'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result;n.createOrUpgrade(r,o.transaction,e.oldVersion,Zl).next((function(){Eu("SimpleDb","Database upgrade to version "+Zl+" complete")}))}})).Ou()},Dl.delete=function(t){return Eu("SimpleDb","Removing database:",t),Rl(window.indexedDB.deleteDatabase(t)).Ou()},Dl.ph=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Dl.rw())return!0;if(void 0===window.navigator)return!1;var t=m(),e=Dl.iw(t),n=0<e&&e<10,r=Dl.uw(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Dl.rw=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.sw)},Dl.ow=function(t,e){return t.store(e)},Dl.iw=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Dl.uw=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Dl.prototype.hw=function(t){this.db.onversionchange=function(e){return t(e)}},Dl.prototype.runTransaction=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:r="readonly"===t,i=0,o=function(){var t,o,a,u;return h(this,(function(h){switch(h.label){case 0:++i,t=Tl.open(s.db,r?"readonly":"readwrite",e),h.label=1;case 1:return h.trys.push([1,3,,4]),(o=n(t).catch((function(e){return t.abort(e),ju.reject(e)})).Ou()).catch((function(){})),[4,t.cw];case 2:return h.sent(),[2,{value:o}];case 3:return a=h.sent(),u="FirebaseError"!==a.name&&i<3,Eu("SimpleDb","Transaction failed with error: %s. Retrying: %s.",a.message,u),u?[3,4]:[2,{value:Promise.reject(a)}];case 4:return[2]}}))},s=this,u.label=1;case 1:return[5,o()];case 2:return"object"==typeof(a=u.sent())?[2,a.value]:[3,1];case 3:return[2]}}))}))},Dl.prototype.close=function(){this.db.close()},Dl),Il=(Object.defineProperty(kl.prototype,"Cu",{get:function(){return this.fw},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"dw",{get:function(){return this.lw},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"cursor",{set:function(t){this.aw=t},enumerable:!0,configurable:!0}),kl.prototype.done=function(){this.fw=!0},kl.prototype.vw=function(t){this.lw=t},kl.prototype.delete=function(){return Rl(this.aw.delete())},kl),Tl=(Sl.open=function(t,e,n){return new Sl(t.transaction(n,e))},Object.defineProperty(Sl.prototype,"cw",{get:function(){return this.ww.promise},enumerable:!0,configurable:!0}),Sl.prototype.abort=function(t){t&&this.ww.reject(t),this.aborted||(Eu("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Sl.prototype.store=function(t){var e=this.transaction.objectStore(t);return Au(!!e,"Object store not part of transaction: "+t),new Nl(e)},Sl),Nl=(Al.prototype.put=function(t,e){return Rl(void 0!==e?(Eu("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Eu("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Al.prototype.add=function(t){return Eu("SimpleDb","ADD",this.store.name,t,t),Rl(this.store.add(t))},Al.prototype.get=function(t){var e=this;return Rl(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Eu("SimpleDb","GET",e.store.name,t,n),n}))},Al.prototype.delete=function(t){return Eu("SimpleDb","DELETE",this.store.name,t),Rl(this.store.delete(t))},Al.prototype.count=function(){return Eu("SimpleDb","COUNT",this.store.name),Rl(this.store.count())},Al.prototype.mw=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.gw(n,(function(t,e){r.push(e)})).next((function(){return r}))},Al.prototype.bw=function(t,e){Eu("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.pw=!1;var r=this.cursor(n);return this.gw(r,(function(t,e,n){return n.delete()}))},Al.prototype.yw=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.gw(r,e)},Al.prototype._w=function(t){var e=this.cursor({});return new ju((function(n,r){e.onerror=function(t){var e=Ol(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Al.prototype.gw=function(t,e){var n=[];return new ju((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Il(i),s=e(i.primaryKey,i.value,o);if(s instanceof ju){var a=s.catch((function(t){return o.done(),ju.reject(t)}));n.push(a)}o.Cu?r():null===o.dw?i.continue():i.continue(o.dw)}else r()}})).next((function(){return ju.Vu(n)}))},Al.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Au(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Al.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.pw?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Al);function Al(t){this.store=t}function Sl(t){var e=this;this.transaction=t,this.aborted=!1,this.ww=new xu,this.transaction.oncomplete=function(){e.ww.resolve()},this.transaction.onabort=function(){t.error?e.ww.reject(t.error):e.ww.resolve()},this.transaction.onerror=function(t){var n=Ol(t.target.error);e.ww.reject(n)}}function kl(t){this.aw=t,this.fw=!1,this.lw=null}function Dl(t){this.db=t,12.2===Dl.iw(m())&&Iu("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Rl(t){return new ju((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Ol(t.target.error);n(e)}}))}var Cl=!1;function Ol(t){var e=El.iw(m());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Fr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Cl||(Cl=!0,setTimeout((function(){throw r}),0)),r}}return t}var xl=(Ll.Tw=function(t,e,n,r){return Au(""!==t.uid,"UserID must not be an empty string."),new Ll(t.t()?t.uid:"",e,n,r)},Ll.prototype.Dc=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ul(t).yw({index:sp.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},Ll.prototype.vo=function(t,e,n){return this.Ew(t).next((function(e){return e.lastStreamToken=n.toBase64(),Ml(t).put(e)}))},Ll.prototype.Eo=function(t){return this.Ew(t).next((function(t){return Ei.fromBase64String(t.lastStreamToken)}))},Ll.prototype.Do=function(t,e){return this.Ew(t).next((function(n){return n.lastStreamToken=e.toBase64(),Ml(t).put(n)}))},Ll.prototype.fo=function(t,e,n,r){var i=this,o=ql(t),s=Ul(t);return s.add({}).next((function(a){Au("number"==typeof a,"Auto-generated key is not a number");for(var u=new Pu(a,e,n,r),h=i.serializer.Dw(i.userId,u),c=[],f=new eo((function(t,e){return Du(t.it(),e.it())})),l=0,p=r;l<p.length;l++){var d=p[l],v=hp.key(i.userId,d.key.path,a);f=f.add(d.key.path.J()),c.push(s.put(h)),c.push(o.put(v,hp.PLACEHOLDER))}return f.forEach((function(e){c.push(i.sc.Ic(t,e))})),t.ec((function(){i.Iw[a]=u.keys()})),ju.Vu(c).next((function(){return u}))}))},Ll.prototype._o=function(t,e){var n=this;return Ul(t).get(e).next((function(t){return t?(Au(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Rw(t)):null}))},Ll.prototype.do=function(t,e){var n=this;return this.Iw[e]?ju.resolve(this.Iw[e]):this._o(t,e).next((function(t){if(t){var r=t.keys();return n.Iw[e]=r}return null}))},Ll.prototype.Lo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ul(t).yw({index:sp.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Au(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.Rw(e)),i.done()})).next((function(){return o}))},Ll.prototype.To=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ul(t).yw({index:sp.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},Ll.prototype.uo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ul(t).mw(sp.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.Rw(t)}))}))},Ll.prototype.oc=function(t,e){var n=this,r=hp.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ql(t).yw({range:i},(function(r,i,s){var a=r[0],u=r[1],h=r[2],c=Bh(u);if(a===n.userId&&e.path.isEqual(c))return Ul(t).get(h).next((function(t){if(!t)throw Nu("Dangling document-mutation reference found: "+r+" which points to "+h);Au(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+h),o.push(n.serializer.Rw(t))}));s.done()})).next((function(){return o}))},Ll.prototype.ac=function(t,e){var n=this,r=new eo(Du),i=[];return e.forEach((function(e){var o=hp.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=ql(t).yw({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],h=Bh(a);s===n.userId&&e.path.isEqual(h)?r=r.add(u):o.done()}));i.push(a)})),ju.Vu(i).next((function(){return n.Sw(t,r)}))},Ll.prototype.wc=function(t,e){var n=this;Au(!e.Nn(),"Document queries shouldn't go down this path"),Au(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=hp.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new eo(Du);return ql(t).yw({range:s},(function(t,e,o){var s=t[0],u=t[1],h=t[2],c=Bh(u);s===n.userId&&r.Z(c)?c.length===i&&(a=a.add(h)):o.done()})).next((function(){return n.Sw(t,a)}))},Ll.prototype.Sw=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ul(t).get(e).next((function(t){if(null===t)throw Nu("Dangling document-mutation reference found, which points to "+e);Au(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Rw(t))})))})),ju.Vu(i).next((function(){return r}))},Ll.prototype.Io=function(t,e){var n=this;return _l(t.Aw,this.userId,e).next((function(r){return t.ec((function(){n.th(e.batchId)})),ju.forEach(r,(function(e){return n.Ks.Pc(t,e)}))}))},Ll.prototype.th=function(t){delete this.Iw[t]},Ll.prototype.po=function(t){var e=this;return this.Dc(t).next((function(n){if(!n)return ju.resolve();var r=IDBKeyRange.lowerBound(hp.prefixForUser(e.userId)),i=[];return ql(t).yw({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Bh(t[1]);i.push(o)}else r.done()})).next((function(){Au(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.it()})))}))}))},Ll.prototype.Cs=function(t,e){return Pl(t,this.userId,e)},Ll.prototype.Ew=function(t){var e=this;return Ml(t).get(this.userId).next((function(t){return t||new op(e.userId,-1,"")}))},Ll);function Ll(t,e,n,r){this.userId=t,this.serializer=e,this.sc=n,this.Ks=r,this.Iw={}}function Pl(t,e,n){var r=hp.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ql(t).yw({range:o,pw:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function _l(t,e,n){var r=t.store(sp.store),i=t.store(hp.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.yw({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Au(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=hp.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return ju.Vu(o).next((function(){return h}))}function Ul(t){return qp.ow(t,sp.store)}function ql(t){return qp.ow(t,hp.store)}function Ml(t){return qp.ow(t,op.store)}var Vl=(Fl.prototype.Go=function(t){var e=this;return this.Cw(t).next((function(n){return n.highestTargetId=e.Wc.after(n.highestTargetId),e.Pw(t,n).next((function(){return n.highestTargetId}))}))},Fl.prototype.Ro=function(t){return this.Cw(t).next((function(t){return Li.L(new xi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},Fl.prototype.zc=function(t){return Bl(t.Aw)},Fl.prototype.Fo=function(t,e,n){var r=this;return this.Cw(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.G()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Pw(t,i)}))},Fl.prototype.Wo=function(t,e){var n=this;return this.Kc(t,e).next((function(){return n.Cw(t).next((function(r){return r.targetCount+=1,n.kw(e,r),n.Pw(t,r)}))}))},Fl.prototype.No=function(t,e){return this.Kc(t,e)},Fl.prototype.Hc=function(t,e){var n=this;return this.Jc(t,e.targetId).next((function(){return jl(t).delete(e.targetId)})).next((function(){return n.Cw(t)})).next((function(e){return Au(0<e.targetCount,"Removing from an empty target cache"),e.targetCount-=1,n.Pw(t,e)}))},Fl.prototype.ds=function(t,e,n){var r=this,i=0,o=[];return jl(t).yw((function(s,a){var u=r.serializer.Nw(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.Hc(t,u)))})).next((function(){return ju.Vu(o)})).next((function(){return i}))},Fl.prototype.oe=function(t,e){var n=this;return jl(t).yw((function(t,r){var i=n.serializer.Nw(r);e(i)}))},Fl.prototype.Cw=function(t){return Gl(t.Aw)},Fl.prototype.Pw=function(t,e){return(n=t,qp.ow(n,wp.store)).put(wp.key,e);var n},Fl.prototype.Kc=function(t,e){return jl(t).put(this.serializer.Ow(e))},Fl.prototype.kw=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Fl.prototype.Yc=function(t){return this.Cw(t).next((function(t){return t.targetCount}))},Fl.prototype.Qo=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return jl(t).yw({range:i,index:mp.queryTargetsIndexName},(function(t,r,i){var s=n.serializer.Nw(r);e.isEqual(s.target)&&(o=s,i.done())})).next((function(){return o}))},Fl.prototype.Co=function(t,e,n){var r=this,i=[],o=zl(t);return e.forEach((function(e){var s=Fh(e.path);i.push(o.put(new gp(n,s))),i.push(r.Ks._s(t,e))})),ju.Vu(i)},Fl.prototype.Ao=function(t,e,n){var r=this,i=zl(t);return ju.forEach(e,(function(e){var o=Fh(e.path);return ju.Vu([i.delete([n,o]),r.Ks.Ts(t,e)])}))},Fl.prototype.Jc=function(t,e){var n=zl(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Fl.prototype.Ho=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=zl(t),i=Va();return r.yw({range:n,pw:!0},(function(t,e,n){var r=Bh(t[1]),o=new Mi(r);i=i.add(o)})).next((function(){return i}))},Fl.prototype.Cs=function(t,e){var n=Fh(e.path),r=IDBKeyRange.bound([n],[Cu(n)],!1,!0),i=0;return zl(t).yw({index:gp.documentTargetsIndex,pw:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},Fl.prototype.be=function(t,e){var n=this;return jl(t).get(e).next((function(t){return t?n.serializer.Nw(t):null}))},Fl);function Fl(t,e){this.Ks=t,this.serializer=e,this.Wc=ec.qc()}function jl(t){return qp.ow(t,mp.store)}function Gl(t){return El.ow(t,wp.store).get(wp.key).next((function(t){return Au(null!==t,"Missing metadata row."),t}))}function Bl(t){return Gl(t).next((function(t){return t.highestListenSequenceNumber}))}function zl(t){return qp.ow(t,gp.store)}var Hl,Kl=(Wl.prototype.Fs=function(t,e,n){return Ql(t).put(Xl(e),n)},Wl.prototype.Us=function(t,e){var n=Ql(t),r=Xl(e);return n.delete(r)},Wl.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Fw(t,r)}))},Wl.prototype.xs=function(t,e){var n=this;return Ql(t).get(Xl(e)).next((function(t){return n.Vw(t)}))},Wl.prototype.Uw=function(t,e){var n=this;return Ql(t).get(Xl(e)).next((function(t){var e=n.Vw(t);return e?{Nc:e,size:$l(t)}:null}))},Wl.prototype.getEntries=function(t,e){var n=this,r=La();return this.xw(t,e,(function(t,e){var i=n.Vw(e);r=r.dt(t,i)})).next((function(){return r}))},Wl.prototype.jw=function(t,e){var n=this,r=La(),i=new Vi(Mi.W);return this.xw(t,e,(function(t,e){var o=n.Vw(e);i=o?(r=r.dt(t,o),i.dt(t,$l(e))):(r=r.dt(t,null),i.dt(t,0))})).next((function(){return{Lw:r,qw:i}}))},Wl.prototype.xw=function(t,e,n){if(e.Y())return ju.resolve();var r=IDBKeyRange.bound(e.first().path.nt(),e.last().path.nt()),i=e.yt(),o=i.Rt();return Ql(t).yw({range:r},(function(t,e,r){for(var s=Mi.ft(t);o&&Mi.W(o,s)<0;)n(o,null),o=i.Rt();o&&o.isEqual(s)&&(n(o,e),o=i.St()?i.Rt():null),o?r.vw(o.path.nt()):r.done()})).next((function(){for(;o;)n(o,null),o=i.St()?i.Rt():null}))},Wl.prototype.Jo=function(t,e,n){var r=this;Au(!e.ui(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=_a(),o=e.path.length+1,s={};if(n.isEqual(Li.MIN)){var a=e.path.nt();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.nt(),h=this.serializer.Bw(n);s.range=IDBKeyRange.lowerBound([u,h],!0),s.index=pp.collectionReadTimeIndex}return Ql(t).yw(s,(function(t,n,s){if(t.length===o){var a=r.serializer.Mw(n);e.path.Z(a.key.path)?a instanceof Ns&&e.matches(a)&&(i=i.dt(a.key,a)):s.done()}})).next((function(){return i}))},Wl.prototype.eh=function(t,e){var n=this,r=xa(),i=this.serializer.Bw(e),o=Ql(t),s=IDBKeyRange.lowerBound(i,!0);return o.yw({index:pp.readTimeIndex,range:s},(function(t,e){var o=n.serializer.Mw(e);r=r.dt(o.key,o),i=e.readTime})).next((function(){return{rh:r,readTime:n.serializer.Qw(i)}}))},Wl.prototype.uh=function(t){var e=this,n=Ql(t),r=Li.MIN;return n.yw({index:pp.readTimeIndex,reverse:!0},(function(t,n,i){n.readTime&&(r=e.serializer.Qw(n.readTime)),i.done()})).next((function(){return r}))},Wl.prototype.wo=function(t){return new Wl.Fc(this,!!t&&t.mo)},Wl.prototype.Vc=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Wl.prototype.getMetadata=function(t){return Yl(t).get(dp.key).next((function(t){return Au(!!t,"Missing document cache metadata"),t}))},Wl.prototype.Fw=function(t,e){return Yl(t).put(dp.key,e)},Wl.prototype.Vw=function(t){if(t){var e=this.serializer.Mw(t);return e instanceof As&&e.version.isEqual(Li.q())?null:e}return null},Wl.Fc=(r(Jl,Hl=oh),Jl.prototype.qs=function(t){var e=this,n=[],r=0,i=new eo((function(t,e){return Du(t.it(),e.it())}));return this.ks.forEach((function(o,s){var a=e.Gw.get(o);if(Au(void 0!==a,"Cannot modify a document that wasn't read (for "+o+")"),s){Au(!e.readTime.isEqual(Li.MIN),"Cannot add a document with a read time of zero");var u=e.Uc.serializer.Ww(s,e.readTime);i=i.add(o.path.J());var h=$l(u);r+=h-a,n.push(e.Uc.Fs(t,o,u))}else if(r-=a,e.mo){var c=e.Uc.serializer.Ww(new As(o,Li.q()),e.readTime);n.push(e.Uc.Fs(t,o,c))}else n.push(e.Uc.Us(t,o))})),i.forEach((function(r){n.push(e.Uc.sc.Ic(t,r))})),n.push(this.Uc.updateMetadata(t,r)),ju.Vu(n)},Jl.prototype.js=function(t,e){var n=this;return this.Uc.Uw(t,e).next((function(t){return null===t?(n.Gw.set(e,0),null):(n.Gw.set(e,t.size),t.Nc)}))},Jl.prototype.Ls=function(t,e){var n=this;return this.Uc.jw(t,e).next((function(t){var e=t.Lw;return t.qw.forEach((function(t,e){n.Gw.set(t,e)})),e}))},Jl),Wl);function Wl(t,e){this.serializer=t,this.sc=e}function Jl(t,e){var n=Hl.call(this)||this;return n.Uc=t,n.mo=e,n.Gw=new Uu((function(t){return t.toString()})),n}function Yl(t){return qp.ow(t,dp.store)}function Ql(t){return qp.ow(t,pp.store)}function Xl(t){return t.path.nt()}function $l(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Nu("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Zl=9,tp=(ep.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Au(n<r&&0<=n&&r<=Zl,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o,s=new Tl(e);n<1&&1<=r&&(t.createObjectStore(rp.store),(o=t).createObjectStore(op.store,{keyPath:op.keyPath}),o.createObjectStore(sp.store,{keyPath:sp.keyPath,autoIncrement:!0}).createIndex(sp.userMutationsIndex,sp.userMutationsKeyPath,{unique:!0}),o.createObjectStore(hp.store),Ap(t),t.createObjectStore(pp.store));var a,u=ju.resolve();return n<3&&3<=r&&(0!==n&&((a=t).deleteObjectStore(gp.store),a.deleteObjectStore(mp.store),a.deleteObjectStore(wp.store),Ap(t)),u=u.next((function(){return t=s.store(wp.store),e=new wp(0,0,Li.MIN.G(),0),t.put(wp.key,e);var t,e}))),n<4&&4<=r&&(0!==n&&(u=u.next((function(){return e=t,(n=s).store(sp.store).mw().next((function(t){e.deleteObjectStore(sp.store),e.createObjectStore(sp.store,{keyPath:sp.keyPath,autoIncrement:!0}).createIndex(sp.userMutationsIndex,sp.userMutationsKeyPath,{unique:!0});var r=n.store(sp.store),i=t.map((function(t){return r.put(t)}));return ju.Vu(i)}));var e,n}))),u=u.next((function(){t.createObjectStore(Sp.store,{keyPath:Sp.keyPath})}))),n<5&&5<=r&&(u=u.next((function(){return i.removeAcknowledgedMutations(s)}))),n<6&&6<=r&&(u=u.next((function(){return t.createObjectStore(dp.store),i.addDocumentGlobal(s)}))),n<7&&7<=r&&(u=u.next((function(){return i.ensureSequenceNumbers(s)}))),n<8&&8<=r&&(u=u.next((function(){return i.createCollectionParentIndex(t,s)}))),n<9&&9<=r&&(u=u.next((function(){var n,r;(r=t).objectStoreNames.contains("remoteDocumentChanges")&&r.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(pp.store)).createIndex(pp.readTimeIndex,pp.readTimeIndexPath,{unique:!1}),n.createIndex(pp.collectionReadTimeIndex,pp.collectionReadTimeIndexPath,{unique:!1})}))),u},ep.prototype.addDocumentGlobal=function(t){var e=0;return t.store(pp.store).yw((function(t,n){e+=$l(n)})).next((function(){var n=new dp(e);return t.store(dp.store).put(dp.key,n)}))},ep.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(op.store),r=t.store(sp.store);return n.mw().next((function(n){return ju.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.mw(sp.userMutationsIndex,i).next((function(r){return ju.forEach(r,(function(r){Au(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.Rw(r);return _l(t,n.userId,i).next((function(){}))}))}))}))}))},ep.prototype.ensureSequenceNumbers=function(t){var e=t.store(gp.store),n=t.store(pp.store);return Bl(t).next((function(t){var r=[];return n.yw((function(n,i){var o=new _i(n),s=[0,Fh(o)];r.push(e.get(s).next((function(n){return n?ju.resolve():(r=o,e.put(new gp(0,Fh(r),t)));var r})))})).next((function(){return ju.Vu(r)}))}))},ep.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.$(),n=t.J();return r.put({collectionId:e,parent:Fh(n)})}}t.createObjectStore(bp.store,{keyPath:bp.keyPath});var r=e.store(bp.store),i=new Hh;return e.store(pp.store).yw({pw:!0},(function(t,e){return n(new _i(t).J())})).next((function(){return e.store(hp.store).yw({pw:!0},(function(t,e){t[0];var r=t[1];return n((t[2],Bh(r)).J())}))}))},ep);function ep(t){this.serializer=t}function np(t,e){this.seconds=t,this.nanoseconds=e}var rp=(ip.store="owner",ip.key="owner",ip);function ip(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var op=(up.store="mutationQueues",up.keyPath="userId",up),sp=(ap.store="mutations",ap.keyPath="batchId",ap.userMutationsIndex="userMutationsIndex",ap.userMutationsKeyPath=["userId","batchId"],ap);function ap(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function up(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var hp=(cp.prefixForUser=function(t){return[t]},cp.prefixForPath=function(t,e){return[t,Fh(e)]},cp.key=function(t,e,n){return[t,Fh(e),n]},cp.store="documentMutations",cp.PLACEHOLDER=new cp,cp);function cp(){}function fp(t,e){this.path=t,this.readTime=e}function lp(t,e){this.path=t,this.version=e}var pp=(yp.store="remoteDocuments",yp.readTimeIndex="readTimeIndex",yp.readTimeIndexPath="readTime",yp.collectionReadTimeIndex="collectionReadTimeIndex",yp.collectionReadTimeIndexPath=["parentPath","readTime"],yp),dp=(vp.store="remoteDocumentGlobal",vp.key="remoteDocumentGlobalKey",vp);function vp(t){this.byteSize=t}function yp(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var mp=(Np.store="targets",Np.keyPath="targetId",Np.queryTargetsIndexName="queryTargetsIndex",Np.queryTargetsKeyPath=["canonicalId","targetId"],Np),gp=(Tp.store="targetDocuments",Tp.keyPath=["targetId","path"],Tp.documentTargetsIndex="documentTargetsIndex",Tp.documentTargetsKeyPath=["path","targetId"],Tp),wp=(Ip.key="targetGlobalKey",Ip.store="targetGlobal",Ip),bp=(Ep.store="collectionParents",Ep.keyPath=["collectionId","parent"],Ep);function Ep(t,e){this.collectionId=t,this.parent=e}function Ip(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function Tp(t,e,n){this.targetId=t,this.path=e,Au(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function Np(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function Ap(t){t.createObjectStore(gp.store,{keyPath:gp.keyPath}).createIndex(gp.documentTargetsIndex,gp.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(mp.store,{keyPath:mp.keyPath}).createIndex(mp.queryTargetsIndexName,mp.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(wp.store)}var Sp=(kp.store="clientMetadata",kp.keyPath="clientId",kp);function kp(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var Dp=c(c(c([op.store,sp.store,hp.store,pp.store,mp.store,rp.store,wp.store,gp.store],[Sp.store]),[dp.store]),[bp.store]),Rp=(Cp.prototype.Ic=function(t,e){var n=this;if(Au(e.length%2==1,"Expected a collection path."),this.zw.has(e))return ju.resolve();var r=e.$(),i=e.J();t.ec((function(){n.zw.add(e)}));var o={collectionId:r,parent:Fh(i)};return Op(t).put(o)},Cp.prototype.vc=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Cu(e),""],!1,!0);return Op(t).mw(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Bh(o.parent))}return n}))},Cp);function Cp(){this.zw=new Hh}function Op(t){return qp.ow(t,bp.store)}var xp=(Lp.prototype.Mw=function(t){if(t.document)return this.Kw.We(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Mi.ft(t.noDocument.path),n=this.Hw(t.noDocument.readTime);return new As(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Mi.ft(t.unknownDocument.path),n=this.Hw(t.unknownDocument.version),new Ss(e,n)):Nu("Unexpected DbRemoteDocument")},Lp.prototype.Ww=function(t,e){var n=this.Bw(e),r=t.key.path.J().nt();if(t instanceof Ns){var i=t.proto?t.proto:this.Kw.Ge(t),o=t.hasCommittedMutations;return new pp(null,null,i,o,n,r)}if(t instanceof As){var s=t.key.path.nt(),a=this.Jw(t.version);return o=t.hasCommittedMutations,new pp(null,new fp(s,a),null,o,n,r)}if(t instanceof Ss){s=t.key.path.nt();var u=this.Jw(t.version);return new pp(new lp(s,u),null,null,!0,n,r)}return Nu("Unexpected MaybeDocument")},Lp.prototype.Bw=function(t){var e=t.G();return[e.seconds,e.nanoseconds]},Lp.prototype.Qw=function(t){var e=new xi(t[0],t[1]);return Li.L(e)},Lp.prototype.Jw=function(t){var e=t.G();return new np(e.seconds,e.nanoseconds)},Lp.prototype.Hw=function(t){var e=new xi(t.seconds,t.nanoseconds);return Li.L(e)},Lp.prototype.Dw=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.Kw.tr(t)})),i=e.mutations.map((function(t){return n.Kw.tr(t)}));return new sp(t,e.batchId,e.En.toMillis(),r,i)},Lp.prototype.Rw=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.Kw.rr(t)})),r=t.mutations.map((function(t){return e.Kw.rr(t)})),i=xi.fromMillis(t.localWriteTimeMs);return new Pu(t.batchId,i,n,r)},Lp.prototype.Yw=function(t){var e=[];return t.forEach((function(t){e.push(Fh(t.path))})),e},Lp.prototype.Xw=function(t){for(var e=Va(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Mi(Bh(i)))}return e},Lp.prototype.Nw=function(t){var e,n=this.Hw(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Hw(t.lastLimboFreeSnapshotVersion):Li.MIN;return e=void 0!==t.query.documents?this.Kw.lr(t.query):this.Kw.gr(t.query),new pa(e,t.targetId,0,t.lastListenSequenceNumber,n,r,Ei.fromBase64String(t.resumeToken))},Lp.prototype.Ow=function(t){Au(0===t.ci,"Only queries with purpose 0 may be stored, got "+t.ci);var e,n=this.Jw(t.ai),r=this.Jw(t.lastLimboFreeSnapshotVersion);e=t.target.Nn()?this.Kw.ar(t.target):this.Kw.dr(t.target);var i=t.resumeToken.toBase64();return new mp(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},Lp);function Lp(t){this.Kw=t}var Pp,_p="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Up=(r(Vp,Pp=Lh),Vp),qp=(Mp.ow=function(t,e){if(t instanceof Up)return El.ow(t.Aw,e);throw Nu("IndexedDbPersistence must use instances of IndexedDbTransaction")},Mp.om=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:if(!Mp.ph())throw new Fr(Vr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Mp(t.allowTabSynchronization,t.persistenceKey,t.clientId,t.platform,t.hm,t.fh,t.serializer,t.$w)).start()];case 1:return n.sent(),[2,e]}}))}))},Mp.prototype.start=function(){var t=this;return Au(!this.ss,"IndexedDbPersistence double-started!"),Au(null!==this.window,"Expected 'window' to be defined"),El.ew(this.rm,Zl,new tp(this.serializer)).then((function(e){return t.cm=e,t.am()})).then((function(){return t.fm(),t.lm(),t.dm(),t.cm.runTransaction("readonly",[wp.store],(function(t){return Bl(t)}))})).then((function(e){t.$c=new Mu(e,t.$w)})).then((function(){t.Zc=!0})).catch((function(e){return t.cm&&t.cm.close(),Promise.reject(e)}))},Mp.prototype.na=function(t){var e=this;return this.em=function(n){return u(e,void 0,void 0,(function(){return h(this,(function(e){return this.ss?[2,t(n)]:[2]}))}))},t(this.isPrimary)},Mp.prototype.ia=function(t){var e=this;this.cm.hw((function(n){return u(e,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},Mp.prototype.nh=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fh.ou((function(){return u(e,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.ss?[4,this.am()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},Mp.prototype.am=function(){var t=this;return this.cm.runTransaction("readwrite",Dp,(function(e){return jp(e).put(new Sp(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.vm(e).next((function(e){e||(t.isPrimary=!1,t.fh.ou((function(){return t.em(!1)})))}))})).next((function(){return t.wm(e)})).next((function(n){return t.isPrimary&&!n?t.mm(e).next((function(){return!1})):!!n&&t.gm(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return Eu("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.fh.ou((function(){return t.em(e)})),t.isPrimary=e}))},Mp.prototype.vm=function(t){var e=this;return Fp(t).get(rp.key).next((function(t){return ju.resolve(e.bm(t))}))},Mp.prototype.pm=function(t){return jp(t).delete(this.clientId)},Mp.prototype.ym=function(){return u(this,void 0,void 0,(function(){var t=this;return h(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this._m(this.im,18e5)?[3,2]:(this.im=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=Mp.ow(e,Sp.store);return n.mw().next((function(e){var r=t.Im(e,18e5),i=e.filter((function(t){return-1===r.indexOf(t)}));return ju.forEach(i,(function(t){return n.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:e.sent().forEach((function(e){t.window.localStorage.removeItem(t.Tm(e.clientId))})),e.label=2;case 2:return[2]}}))}))},Mp.prototype.dm=function(){var t=this;this.nm=this.fh.yu("client_metadata_refresh",4e3,(function(){return t.am().then((function(){return t.ym()})).then((function(){return t.dm()}))}))},Mp.prototype.bm=function(t){return!!t&&t.ownerId===this.clientId},Mp.prototype.wm=function(t){var e=this;return Fp(t).get(rp.key).next((function(n){if(null!==n&&e._m(n.leaseTimestampMs,5e3)&&!e.Em(n.ownerId)){if(e.bm(n)&&e.networkEnabled)return!0;if(!e.bm(n)){if(!n.allowTabSynchronization)throw new Fr(Vr.FAILED_PRECONDITION,_p);return!1}}return!(!e.networkEnabled||!e.inForeground)||jp(t).mw().next((function(t){return void 0===e.Im(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Eu("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},Mp.prototype.shutdown=function(){return u(this,void 0,void 0,(function(){var t=this;return h(this,(function(e){switch(e.label){case 0:return this.Zc=!1,this.Dm(),this.nm&&(this.nm.cancel(),this.nm=null),this.Rm(),this.Sm(),[4,this.cm.runTransaction("readwrite",[rp.store,Sp.store],(function(e){return t.mm(e).next((function(){return t.pm(e)}))}))];case 1:return e.sent(),this.cm.close(),this.Am(),[2]}}))}))},Mp.prototype.Im=function(t,e){var n=this;return t.filter((function(t){return n._m(t.updateTimeMs,e)&&!n.Em(t.clientId)}))},Mp.prototype.$o=function(){var t=this;return this.cm.runTransaction("readonly",[Sp.store],(function(e){return jp(e).mw().next((function(e){return t.Im(e,18e5).map((function(t){return t.clientId}))}))}))},Mp.clearPersistence=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return Mp.ph()?(e=t+Mp.um,[4,El.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(Mp.prototype,"ss",{get:function(){return this.Zc},enumerable:!0,configurable:!0}),Mp.prototype.Js=function(t){return Au(this.ss,"Cannot initialize MutationQueue before persistence is started."),xl.Tw(t,this.serializer,this.sc,this.Ks)},Mp.prototype.Zs=function(){return Au(this.ss,"Cannot initialize TargetCache before persistence is started."),this.$s},Mp.prototype.Xs=function(){return Au(this.ss,"Cannot initialize RemoteDocumentCache before persistence is started."),this.uc},Mp.prototype.no=function(){return Au(this.ss,"Cannot initialize IndexManager before persistence is started."),this.sc},Mp.prototype.runTransaction=function(t,e,n){var r=this;Eu("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.cm.runTransaction(o,Dp,(function(o){return i=new Up(o,r.$c.next()),"readwrite-primary"===e?r.vm(o).next((function(t){return!!t||r.wm(o)})).next((function(e){if(!e)throw Iu("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.fh.ou((function(){return r.em(!1)})),new Fr(Vr.FAILED_PRECONDITION,xh);return n(i)})).next((function(t){return r.gm(o).next((function(){return t}))})):r.Cm(o).next((function(){return n(i)}))})).then((function(t){return i.rc(),t}))},Mp.prototype.Cm=function(t){var e=this;return Fp(t).get(rp.key).next((function(t){if(null!==t&&e._m(t.leaseTimestampMs,5e3)&&!e.Em(t.ownerId)&&!e.bm(t)&&!t.allowTabSynchronization)throw new Fr(Vr.FAILED_PRECONDITION,_p)}))},Mp.prototype.gm=function(t){var e=new rp(this.clientId,this.allowTabSynchronization,Date.now());return Fp(t).put(rp.key,e)},Mp.ph=function(){return El.ph()},Mp.Pm=function(t){var e=t.Dn.projectId;return t.Dn.xr||(e+="."+t.Dn.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Mp.prototype.mm=function(t){var e=this,n=Fp(t);return n.get(rp.key).next((function(t){return e.bm(t)?(Eu("IndexedDbPersistence","Releasing primary lease."),n.delete(rp.key)):ju.resolve()}))},Mp.prototype._m=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Iu("Detected an update time that is in the future: "+t+" > "+n),1))},Mp.prototype.fm=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.tm=function(){t.fh.ou((function(){return t.inForeground="visible"===t.document.visibilityState,t.am()}))},this.document.addEventListener("visibilitychange",this.tm),this.inForeground="visible"===this.document.visibilityState)},Mp.prototype.Rm=function(){this.tm&&(Au(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.tm),this.tm=null)},Mp.prototype.lm=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Zw=function(){t.Dm(),t.fh.ou((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.Zw))},Mp.prototype.Sm=function(){this.Zw&&(Au("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Zw),this.Zw=null)},Mp.prototype.Em=function(t){try{var e=null!==this.sm.getItem(this.Tm(t));return Eu("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Iu("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Mp.prototype.Dm=function(){try{this.sm.setItem(this.Tm(this.clientId),String(Date.now()))}catch(t){Iu("Failed to set zombie client id.",t)}},Mp.prototype.Am=function(){try{this.sm.removeItem(this.Tm(this.clientId))}catch(t){}},Mp.prototype.Tm=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Mp.um="main",Mp);function Mp(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.fh=o,this.$w=a,this.Zc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zw=null,this.inForeground=!1,this.tm=null,this.nm=null,this.im=Number.NEGATIVE_INFINITY,this.em=function(t){return Promise.resolve()},this.Ks=new Gp(this,i),this.rm=e+Mp.um,this.serializer=new xp(s),this.document=r.document,this.$s=new Vl(this.Ks,this.serializer),this.sc=new Rp,this.uc=new Kl(this.serializer,this.sc),!r.window||!r.window.localStorage)throw new Fr(Vr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.sm=this.window.localStorage}function Vp(t,e){var n=Pp.call(this)||this;return n.Aw=t,n.Po=e,n}function Fp(t){return t.store(rp.store)}function jp(t){return t.store(Sp.store)}var Gp=(Bp.prototype.as=function(t){var e=this.km(t);return this.db.Zs().Yc(t).next((function(t){return e.next((function(e){return t+e}))}))},Bp.prototype.km=function(t){var e=0;return this.ls(t,(function(t){e++})).next((function(){return e}))},Bp.prototype.oe=function(t,e){return this.db.Zs().oe(t,e)},Bp.prototype.ls=function(t,e){return this.Nm(t,(function(t,n){return e(n)}))},Bp.prototype.zs=function(t){this.sa=t},Bp.prototype._s=function(t,e){return zp(t,e)},Bp.prototype.Ts=function(t,e){return zp(t,e)},Bp.prototype.ds=function(t,e,n){return this.db.Zs().ds(t,e,n)},Bp.prototype.Pc=function(t,e){return zp(t,e)},Bp.prototype.Om=function(t,e){return this.sa.Cs(e)?ju.resolve(!0):(r=e,i=!1,Ml(n=t)._w((function(t){return Pl(n,t,r).next((function(t){return t&&(i=!0),ju.resolve(!t)}))})).next((function(){return i})));var n,r,i},Bp.prototype.vs=function(t,e){var n=this,r=this.db.Xs().wo(),i=[],o=0;return this.Nm(t,(function(s,a){if(a<=e){var u=n.Om(t,s).next((function(e){if(!e)return o++,r.xs(t,s).next((function(){return r.Us(s),zl(t).delete([0,Fh(s.path)])}))}));i.push(u)}})).next((function(){return ju.Vu(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},Bp.prototype.removeTarget=function(t,e){var n=e.fi(t.Po);return this.db.Zs().No(t,n)},Bp.prototype.Oo=function(t,e){return zp(t,e)},Bp.prototype.Nm=function(t,e){var n,r=zl(t),i=Mu.Xr;return r.yw({index:gp.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==Mu.Xr&&e(new Mi(Bh(n)),i),i=a,n=s):i=Mu.Xr})).next((function(){i!==Mu.Xr&&e(new Mi(Bh(n)),i)}))},Bp.prototype.ms=function(t){return this.db.Xs().Vc(t)},Bp);function Bp(t,e){this.db=t,this.sa=null,this.ns=new nh(this,e)}function zp(t,e){return zl(t).put((n=e,r=t.Po,new gp(0,Fh(n.path),r)));var n,r}var Hp=(Wp.prototype.initialize=function(t,e,n,r,i,o){return u(this,void 0,void 0,(function(){var s,a,u,c;return h(this,(function(h){switch(h.label){case 0:if(Au(o.aa,"IndexedDbPersistenceProvider can only provide durable persistence"),Au(!this.persistence,"configure() already called"),s=qp.Pm(e),a=new du(e.Dn,{_e:!0}),!Nh.ph(n))throw new Fr(Vr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return this.td=o.synchronizeTabs?new Nh(t,n,s,r,i):new Oh,u=this,[4,qp.om({allowTabSynchronization:o.synchronizeTabs,persistenceKey:s,clientId:r,platform:n,fh:t,serializer:a,hm:th.Hu(o.cacheSizeBytes),$w:this.td})];case 1:return u.persistence=h.sent(),c=this.persistence.Ks.ns,this.Yd=new eh(c,t),[2]}}))}))},Wp.prototype.la=function(){return Au(!!this.persistence,"initialize() not called"),this.persistence},Wp.prototype.da=function(){return Au(!!this.td,"initialize() not called"),this.td},Wp.prototype.fa=function(){return Au(!!this.Yd,"initialize() not called"),this.Yd},Wp.prototype.clearPersistence=function(t){var e=qp.Pm(t);return qp.clearPersistence(e)},Wp),Kp={Firestore:ll,GeoPoint:Oi,Timestamp:xi,Blob:Ci,Transaction:pl,WriteBatch:dl,DocumentReference:vl,DocumentSnapshot:yl,Query:gl,QueryDocumentSnapshot:ml,QuerySnapshot:wl,CollectionReference:bl,FieldPath:pc,FieldValue:Fc,setLogLevel:Vf.setLogLevel,CACHE_SIZE_UNLIMITED:qf};function Wp(){}var Jp,Yp,Qp,Xp=(ud.prototype.Xf=function(t){},ud.prototype.shutdown=function(){},ud),$p=(ad.prototype.Xf=function(t){this.jm.push(t)},ad.prototype.shutdown=function(){window.removeEventListener("online",this.Fm),window.removeEventListener("offline",this.Um)},ad.prototype.Lm=function(){window.addEventListener("online",this.Fm),window.addEventListener("offline",this.Um)},ad.prototype.Vm=function(){Eu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.jm;t<e.length;t++)(0,e[t])(0)},ad.prototype.xm=function(){Eu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.jm;t<e.length;t++)(0,e[t])(1)},ad.ph=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ad),Zp=(sd.prototype.Ma=function(t){Au(!this.Mm,"Called onOpen on stream twice!"),this.Mm=t},sd.prototype.xa=function(t){Au(!this.Qm,"Called onClose on stream twice!"),this.Qm=t},sd.prototype.onMessage=function(t){Au(!this.Gm,"Called onMessage on stream twice!"),this.Gm=t},sd.prototype.close=function(){this.Bm()},sd.prototype.send=function(t){this.qm(t)},sd.prototype.Wm=function(){Au(void 0!==this.Mm,"Cannot call onOpen because no callback was set"),this.Mm()},sd.prototype.zm=function(t){Au(void 0!==this.Qm,"Cannot call onClose because no callback was set"),this.Qm(t)},sd.prototype.Km=function(t){Au(void 0!==this.Gm,"Cannot call onMessage because no callback was set"),this.Gm(t)},sd),td={BatchGetDocuments:"batchGet",Commit:"commit"},ed="gl-js/ fire/"+qr,nd=(od.prototype.Jm=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=ed},od.prototype.tf=function(t,e,n){var r=this,i=this.Ym(t);return new Promise((function(o,s){var u=new Ur;u.listenOnce(Pr.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case Lr.NO_ERROR:var e=u.getResponseJson();Eu("Connection","XHR received:",JSON.stringify(e)),o(e);break;case Lr.TIMEOUT:Eu("Connection",'RPC "'+t+'" timed out'),s(new Fr(Vr.DEADLINE_EXCEEDED,"Request time out"));break;case Lr.HTTP_ERROR:var n=u.getStatus();if(Eu("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),0<n){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=(a=r.status.toLowerCase().replace("_","-"),0<=Object.values(Vr).indexOf(a)?a:Vr.UNKNOWN);s(new Fr(i,r.message))}else s(new Fr(Vr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Eu("Connection",'RPC "'+t+'" failed'),s(new Fr(Vr.UNAVAILABLE,"Connection failed."));break;default:Nu('RPC "'+t+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{Eu("Connection",'RPC "'+t+'" completed.')}var a}));var h=a({},e);delete h.database;var c=JSON.stringify(h);Eu("Connection","XHR sending: ",i+" "+c);var f={"Content-Type":"text/plain"};r.Jm(f,n),u.send(i,"POST",c,f,15)}))},od.prototype.nf=function(t,e,n){return this.tf(t,e,n)},od.prototype.Qa=function(t,e){var n=[this.Hm,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=xr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.Dn.projectId+"/databases/"+this.Dn.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Jm(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=m().indexOf("Electron/")||function(){var t=m();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=m().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){a.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}Eu("Connection","Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),u=!1,h=!1,c=new Zp({qm:function(t){h?Eu("Connection","Not sending because WebChannel is closed:",t):(u||(Eu("Connection","Opening WebChannel transport."),a.open(),u=!0),Eu("Connection","WebChannel sending:",t),a.send(t))},Bm:function(){return a.close()}});return s(_r.EventType.OPEN,(function(){h||Eu("Connection","WebChannel transport opened.")})),s(_r.EventType.CLOSE,(function(){h||(h=!0,Eu("Connection","WebChannel transport closed"),c.zm())})),s(_r.EventType.ERROR,(function(t){h||(h=!0,Eu("Connection","WebChannel transport errored:",t),c.zm(new Fr(Vr.UNAVAILABLE,"The operation could not be completed")))})),s(_r.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Au(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Eu("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Hs[o];if(void 0!==t)return Ca(t)}(),u=i.message;void 0===s&&(s=Vr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),h=!0,c.zm(new Fr(s,u)),a.close()}else Eu("Connection","WebChannel received:",n),c.Km(n)}})),setTimeout((function(){c.Wm()}),0),c},od.prototype.Ym=function(t){var e=td[t];return Au(void 0!==e,"Unknown REST mapping for: "+t),this.Hm+"/v1/projects/"+this.Dn.projectId+"/databases/"+this.Dn.database+"/documents:"+e},od),rd=(Object.defineProperty(id.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),id.prototype.$d=function(t){return Promise.resolve(new nd(t))},id.prototype.Zd=function(){return $p.ph()?new $p:new Xp},id.prototype.tv=function(t){return new du(t,{_e:!0})},id.prototype.Vr=function(t){return JSON.stringify(t)},id.prototype.atob=function(t){return atob(t)},id.prototype.btoa=function(t){return btoa(t)},id.prototype.randomBytes=function(t){if(t<=0)return new Uint8Array;var e=new Uint8Array(t);return crypto.getRandomValues(e),e},id);function id(){this.N="undefined"!=typeof atob}function od(t){this.Dn=t.Dn;var e=t.ssl?"https":"http";this.Hm=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function sd(t){this.qm=t.qm,this.Bm=t.Bm}function ad(){var t=this;this.Fm=function(){return t.Vm()},this.Um=function(){return t.xm()},this.jm=[],this.Lm()}function ud(){}vu.Fr(new rd),Jp=function(t,e){return new Vf(t,e,new Hp)},(Qp=t).INTERNAL.registerComponent(new N("firestore",(function(t){var e=t.getProvider("app").getImmediate();return Jp(e,t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps((Au((Yp=Kp)&&"object"==typeof Yp,"shallowCopy() expects object parameter."),a({},Yp)))),Qp.registerVersion("@firebase/firestore","1.13.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}(n)}));export default r;
//# sourceMappingURL=firebase-firestore.js.map
